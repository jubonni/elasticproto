{
    "meta": {
        "timestamp": "2024-11-01T02:49:25.895071",
        "size": 5292,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-parent-aggregation.html",
        "type": "documentation",
        "role": [],
        "has_code": true,
        "title": "search-aggregations-bucket-parent-aggregation",
        "version": "8.15"
    },
    "doc": "[[search-aggregations-bucket-parent-aggregation]]\n=== Parent aggregation\n++++\n<titleabbrev>Parent</titleabbrev>\n++++\n\nA special single bucket aggregation that selects parent documents that have the specified type, as defined in a <<parent-join,`join` field>>.\n\nThis aggregation has a single option:\n\n* `type` - The child type that should be selected.\n\nFor example, let's say we have an index of questions and answers. The answer type has the following `join` field in the mapping:\n\n[source,console,id=parent-aggregation-example]\n--------------------------------------------------\nPUT parent_example\n{\n  \"mappings\": {\n     \"properties\": {\n       \"join\": {\n         \"type\": \"join\",\n         \"relations\": {\n           \"question\": \"answer\"\n         }\n       }\n     }\n  }\n}\n--------------------------------------------------\n\nThe `question` document contain a tag field and the `answer` documents contain an owner field. With the `parent`\naggregation the owner buckets can be mapped to the tag buckets in a single request even though the two fields exist in\ntwo different kinds of documents.\n\nAn example of a question document:\n\n[source,console]\n--------------------------------------------------\nPUT parent_example/_doc/1\n{\n  \"join\": {\n    \"name\": \"question\"\n  },\n  \"body\": \"<p>I have Windows 2003 server and i bought a new Windows 2008 server...\",\n  \"title\": \"Whats the best way to file transfer my site from server to a newer one?\",\n  \"tags\": [\n    \"windows-server-2003\",\n    \"windows-server-2008\",\n    \"file-transfer\"\n  ]\n}\n--------------------------------------------------\n// TEST[continued]\n\nExamples of `answer` documents:\n\n[source,console]\n--------------------------------------------------\nPUT parent_example/_doc/2?routing=1\n{\n  \"join\": {\n    \"name\": \"answer\",\n    \"parent\": \"1\"\n  },\n  \"owner\": {\n    \"location\": \"Norfolk, United Kingdom\",\n    \"display_name\": \"Sam\",\n    \"id\": 48\n  },\n  \"body\": \"<p>Unfortunately you're pretty much limited to FTP...\",\n  \"creation_date\": \"2009-05-04T13:45:37.030\"\n}\n\nPUT parent_example/_doc/3?routing=1&refresh\n{\n  \"join\": {\n    \"name\": \"answer\",\n    \"parent\": \"1\"\n  },\n  \"owner\": {\n    \"location\": \"Norfolk, United Kingdom\",\n    \"display_name\": \"Troll\",\n    \"id\": 49\n  },\n  \"body\": \"<p>Use Linux...\",\n  \"creation_date\": \"2009-05-05T13:45:37.030\"\n}\n--------------------------------------------------\n// TEST[continued]\n\nThe following request can be built that connects the two together:\n\n[source,console]\n--------------------------------------------------\nPOST parent_example/_search?size=0\n{\n  \"aggs\": {\n    \"top-names\": {\n      \"terms\": {\n        \"field\": \"owner.display_name.keyword\",\n        \"size\": 10\n      },\n      \"aggs\": {\n        \"to-questions\": {\n          \"parent\": {\n            \"type\" : \"answer\" <1>\n          },\n          \"aggs\": {\n            \"top-tags\": {\n              \"terms\": {\n                \"field\": \"tags.keyword\",\n                \"size\": 10\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n--------------------------------------------------\n// TEST[continued]\n\n<1> The `type` points to type / mapping with the name `answer`.\n\nThe above example returns the top answer owners and per owner the top question tags.\n\nPossible response:\n\n[source,console-result]\n--------------------------------------------------\n{\n  \"took\": 9,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 1,\n    \"successful\": 1,\n    \"skipped\": 0,\n    \"failed\": 0\n  },\n  \"hits\": {\n    \"total\" : {\n      \"value\": 3,\n      \"relation\": \"eq\"\n    },\n    \"max_score\": null,\n    \"hits\": []\n  },\n  \"aggregations\": {\n    \"top-names\": {\n      \"doc_count_error_upper_bound\": 0,\n      \"sum_other_doc_count\": 0,\n      \"buckets\": [\n        {\n          \"key\": \"Sam\",\n          \"doc_count\": 1, <1>\n          \"to-questions\": {\n            \"doc_count\": 1, <2>\n            \"top-tags\": {\n              \"doc_count_error_upper_bound\": 0,\n              \"sum_other_doc_count\": 0,\n              \"buckets\": [\n                {\n                  \"key\": \"file-transfer\",\n                  \"doc_count\": 1\n                },\n                {\n                  \"key\": \"windows-server-2003\",\n                  \"doc_count\": 1\n                },\n                {\n                  \"key\": \"windows-server-2008\",\n                  \"doc_count\": 1\n                }\n              ]\n            }\n          }\n        },\n        {\n          \"key\": \"Troll\",\n          \"doc_count\": 1,\n          \"to-questions\": {\n            \"doc_count\": 1,\n            \"top-tags\": {\n              \"doc_count_error_upper_bound\": 0,\n              \"sum_other_doc_count\": 0,\n              \"buckets\": [\n                {\n                  \"key\": \"file-transfer\",\n                  \"doc_count\": 1\n                },\n                {\n                  \"key\": \"windows-server-2003\",\n                  \"doc_count\": 1\n                },\n                {\n                  \"key\": \"windows-server-2008\",\n                  \"doc_count\": 1\n                }\n              ]\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/\"took\": 9/\"took\": $body.took/]\n\n<1> The number of answer documents with the tag `Sam`, `Troll`, etc.\n<2> The number of question documents that are related to answer documents with the tag `Sam`, `Troll`, etc.\n"
}