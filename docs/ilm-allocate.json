{
    "meta": {
        "timestamp": "2024-11-01T03:02:52.732579",
        "size": 4475,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/ilm-allocate.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "ilm-allocate",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[ilm-allocate]]\n=== Allocate\n\nPhases allowed: warm, cold.\n\nUpdates the index settings to change which nodes are allowed to host the index shards\nand change the number of replicas.\n\nThe allocate action is not allowed in the hot phase.\nThe initial allocation for the index must be done manually or via\n<<index-templates, index templates>>.\n\nYou can configure this action to modify both the allocation rules and number of replicas,\nonly the allocation rules, or only the number of replicas.\nFor more information about how {es} uses replicas for scaling, see\n<<scalability>>. See <<shard-allocation-filtering>> for more information about\ncontrolling where {es} allocates shards of a particular index.\n\n\n[[ilm-allocate-options]]\n==== Options\n\nYou must specify the number of replicas or at least one\n`include`, `exclude`, or `require` option.\nAn empty allocate action is invalid.\n\nFor more information about using custom attributes for shard allocation,\nsee <<shard-allocation-filtering>>.\n\n`number_of_replicas`::\n(Optional, integer)\nNumber of replicas to assign to the index.\n\n`total_shards_per_node`::\n(Optional, integer)\nThe maximum number of shards for the index on a single {es} node. A value of `-1` is\ninterpreted as unlimited. See <<allocation-total-shards, total shards>>.\n\n`include`::\n(Optional, object)\nAssigns an index to nodes that have at least _one_ of the specified custom attributes.\n\n`exclude`::\n(Optional, object)\nAssigns an index to nodes that have _none_ of the specified custom attributes.\n\n`require`::\n(Optional, object)\nAssigns an index to nodes that have _all_ of the specified custom attributes.\n\n[[ilm-allocate-ex]]\n==== Example\n\nThe allocate action in the following policy changes the index's number of replicas to `2`.\nNo more than 200 shards for the index will be placed on any single node. Otherwise the index\nallocation rules are not changed.\n\n[source,console]\n--------------------------------------------------\nPUT _ilm/policy/my_policy\n{\n  \"policy\": {\n    \"phases\": {\n      \"warm\": {\n        \"actions\": {\n          \"allocate\" : {\n            \"number_of_replicas\" : 2,\n            \"total_shards_per_node\" : 200\n          }\n        }\n      }\n    }\n  }\n}\n--------------------------------------------------\n\n[[ilm-allocate-assign-index-attribute-ex]]\n===== Assign index to nodes using a custom attribute\n\nThe allocate action in the following policy assigns the index to nodes\nthat have a `box_type` of _hot_ or _warm_.\n\nTo designate a node's `box_type`, you set a custom attribute in the node configuration.\nFor example, set `node.attr.box_type: hot` in `elasticsearch.yml`.\nFor more information, see <<index-allocation-filters>>.\n\n[source,console]\n--------------------------------------------------\nPUT _ilm/policy/my_policy\n{\n  \"policy\": {\n    \"phases\": {\n      \"warm\": {\n        \"actions\": {\n          \"allocate\" : {\n            \"include\" : {\n              \"box_type\": \"hot,warm\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n--------------------------------------------------\n\n[[ilm-allocate-assign-index-multi-attribute-ex]]\n===== Assign index to nodes based on multiple attributes\n\nThe allocate action can also assign indices to nodes based on multiple node\nattributes. The following action assigns indices based on the `box_type` and\n`storage` node attributes.\n\n[source,console]\n----\nPUT _ilm/policy/my_policy\n{\n  \"policy\": {\n    \"phases\": {\n      \"cold\": {\n        \"actions\": {\n          \"allocate\" : {\n            \"require\" : {\n              \"box_type\": \"cold\",\n              \"storage\": \"high\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n----\n\n[[ilm-allocate-assign-index-node-ex]]\n===== Assign index to a specific node and update replica settings\n\nThe allocate action in the following policy updates the index to have one replica per shard\nand be allocated to nodes that have a `box_type` of _cold_.\n\nTo designate a node's `box_type`, you set a custom attribute in the node configuration.\nFor example, set `node.attr.box_type: cold` in `elasticsearch.yml`.\nFor more information, see <<index-allocation-filters>>.\n\n[source,console]\n--------------------------------------------------\nPUT _ilm/policy/my_policy\n{\n  \"policy\": {\n    \"phases\": {\n      \"warm\": {\n        \"actions\": {\n          \"allocate\" : {\n            \"number_of_replicas\": 1,\n            \"require\" : {\n              \"box_type\": \"cold\"\n            }\n        }\n        }\n      }\n    }\n  }\n}\n--------------------------------------------------\n"
}