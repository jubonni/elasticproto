{
    "meta": {
        "timestamp": "2024-11-01T03:02:53.581584",
        "size": 1890,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-span-field-masking-query.html",
        "type": "documentation",
        "role": [],
        "has_code": true,
        "title": "query-dsl-span-field-masking-query",
        "version": "8.15"
    },
    "doc": "[[query-dsl-span-field-masking-query]]\n=== Span field masking query\n++++\n<titleabbrev>Span field masking</titleabbrev>\n++++\n\nWrapper to allow span queries to participate in composite single-field span queries by 'lying' about their search field.\n\nThis can be used to support queries like `span-near` or `span-or` across different fields, which is not ordinarily permitted.\n\nSpan field masking query is invaluable in conjunction with *multi-fields* when same content is indexed with multiple analyzers. For instance, we could index a field with the standard analyzer which breaks text up into words, and again with the english analyzer which stems words into their root form.\n\nExample:\n\n[source,console]\n--------------------------------------------------\nGET /_search\n{\n  \"query\": {\n    \"span_near\": {\n      \"clauses\": [\n        {\n          \"span_term\": {\n            \"text\": \"quick brown\"\n          }\n        },\n        {\n          \"span_field_masking\": {\n            \"query\": {\n              \"span_term\": {\n                \"text.stems\": \"fox\" <1>\n              }\n            },\n            \"field\": \"text\" <2>\n          }\n        }\n      ],\n      \"slop\": 5,\n      \"in_order\": false\n    }\n  },\n  \"highlight\": {\n    \"require_field_match\" : false, <3>\n    \"fields\": {\n      \"*\": {}\n    }\n  }\n}\n--------------------------------------------------\n<1> Original field on which we do the search\n<2> Masked field, which we are masking with the original field\n<3> Use \"require_field_match\" : false to highlight the masked field\n\nNote: `span_field_masking` query may have unexpected scoring and highlighting\nbehaviour. This is because the query returns and highlights the masked field,\nbut scoring and highlighting are done using the terms statistics and offsets\nof the original field.\n\nNote: For highlighting to work the parameter: `require_field_match` should\nbe set to `false` on the highlighter.\n"
}