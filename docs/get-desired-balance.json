{
    "meta": {
        "size": 6728,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/get-desired-balance.html",
        "type": "documentation",
        "role": [],
        "has_code": true,
        "title": "get-desired-balance",
        "version": "8.15"
    },
    "doc": "[[get-desired-balance]]\n=== Get desired balance API\n++++\n<titleabbrev>Get desired balance</titleabbrev>\n++++\n\nNOTE: {cloud-only}\n\nExposes:\n\n* the <<shards-rebalancing-heuristics,desired balance>> computation and reconciliation stats\n* balancing stats such as distribution of shards, disk and ingest forecasts\n  across nodes and data tiers (based on the current cluster state)\n* routing table with each shard current and desired location\n* cluster info with nodes disk usages\n\n[[get-desired-balance-request]]\n==== {api-request-title}\n\n[source,console]\n--------------------------------------------------\nGET /_internal/desired_balance\n--------------------------------------------------\n// TEST[skip:Can't reliably test desired balance]\n\nThe API returns the following result:\n\n[source,console-result]\n--------------------------------------------------\n{\n  \"stats\": {\n    \"computation_active\": false,\n    \"computation_submitted\": 5,\n    \"computation_executed\": 5,\n    \"computation_converged\": 5,\n    \"computation_iterations\": 4,\n    \"computation_converged_index\": 4,\n    \"computation_time_in_millis\": 0,\n    \"reconciliation_time_in_millis\": 0\n  },\n  \"cluster_balance_stats\" : {\n    \"shard_count\": 37,\n    \"undesired_shard_allocation_count\": 0,\n    \"tiers\": {\n      \"data_hot\" : {\n        \"shard_count\" : {\n          \"total\" : 7.0,\n          \"min\" : 2.0,\n          \"max\" : 3.0,\n          \"average\" : 2.3333333333333335,\n          \"std_dev\" : 0.4714045207910317\n        },\n        \"undesired_shard_allocation_count\" : {\n          \"total\" : 0.0,\n          \"min\" : 0.0,\n          \"max\" : 0.0,\n          \"average\" : 0.0,\n          \"std_dev\" : 0.0\n        },\n        \"forecast_write_load\" : {\n          \"total\" : 21.0,\n          \"min\" : 6.0,\n          \"max\" : 8.5,\n          \"average\" : 7.0,\n          \"std_dev\" : 1.0801234497346435\n        },\n        \"forecast_disk_usage\" : {\n          \"total\" : 36.0,\n          \"min\" : 10.0,\n          \"max\" : 16.0,\n          \"average\" : 12.0,\n          \"std_dev\" : 2.8284271247461903\n        },\n        \"actual_disk_usage\" : {\n          \"total\" : 36.0,\n          \"min\" : 10.0,\n          \"max\" : 16.0,\n          \"average\" : 12.0,\n          \"std_dev\" : 2.8284271247461903\n        }\n      },\n      \"data_warm\" : {\n        \"shard_count\" : {\n          \"total\" : 3.0,\n          \"min\" : 1.0,\n          \"max\" : 1.0,\n          \"average\" : 1.0,\n          \"std_dev\" : 0.0\n        },\n        \"undesired_shard_allocation_count\" : {\n          \"total\" : 0.0,\n          \"min\" : 0.0,\n          \"max\" : 0.0,\n          \"average\" : 0.0,\n          \"std_dev\" : 0.0\n        },\n        \"forecast_write_load\" : {\n          \"total\" : 0.0,\n          \"min\" : 0.0,\n          \"max\" : 0.0,\n          \"average\" : 0.0,\n          \"std_dev\" : 0.0\n        },\n        \"forecast_disk_usage\" : {\n          \"total\" : 42.0,\n          \"min\" : 12.0,\n          \"max\" : 18.0,\n          \"average\" : 14.0,\n          \"std_dev\" : 2.8284271247461903\n        },\n        \"actual_disk_usage\" : {\n          \"total\" : 42.0,\n          \"min\" : 12.0,\n          \"max\" : 18.0,\n          \"average\" : 14.0,\n          \"std_dev\" : 2.8284271247461903\n        }\n      }\n    },\n    \"nodes\": {\n      \"node-1\": {\n        \"node_id\": \"UPYt8VwWTt-IADAEbqpLxA\",\n        \"roles\": [\"data_content\"],\n        \"shard_count\": 10,\n        \"undesired_shard_allocation_count\": 0,\n        \"forecast_write_load\": 8.5,\n        \"forecast_disk_usage_bytes\": 498435,\n        \"actual_disk_usage_bytes\": 498435\n      },\n      \"node-2\": {\n        \"node_id\": \"bgC66tboTIeFQ0VgRGI4Gg\",\n        \"roles\": [\"data_content\"],\n        \"shard_count\": 15,\n        \"undesired_shard_allocation_count\": 0,\n        \"forecast_write_load\": 3.25,\n        \"forecast_disk_usage_bytes\": 384935,\n        \"actual_disk_usage_bytes\": 384935\n      },\n      \"node-3\": {\n        \"node_id\": \"2x1VTuSOQdeguXPdN73yRw\",\n        \"roles\": [\"data_content\"],\n        \"shard_count\": 12,\n        \"undesired_shard_allocation_count\": 0,\n        \"forecast_write_load\": 6.0,\n        \"forecast_disk_usage_bytes\": 648766,\n        \"actual_disk_usage_bytes\": 648766\n      }\n    }\n  },\n  \"routing_table\": {\n    \"test\": {\n      \"0\": {\n        \"current\": [\n          {\n            \"state\": \"STARTED\",\n            \"primary\": true,\n            \"node\": \"UPYt8VwWTt-IADAEbqpLxA\",\n            \"node_is_desired\": true,\n            \"relocating_node\": null,\n            \"relocating_node_is_desired\": null,\n            \"shard_id\": 0,\n            \"index\": \"test\",\n            \"forecast_write_load\": 8.0,\n            \"forecast_shard_size_in_bytes\": 1024,\n            \"tier_preference\": [\"data_content\"]\n          }\n        ],\n        \"desired\": {\n          \"node_ids\": [\n            \"UPYt8VwWTt-IADAEbqpLxA\"\n          ],\n          \"total\": 1,\n          \"unassigned\": 0,\n          \"ignored\": 0\n        }\n      },\n      \"1\": {\n        \"current\": [\n          {\n            \"state\": \"STARTED\",\n            \"primary\": true,\n            \"node\": \"2x1VTuSOQdeguXPdN73yRw\",\n            \"node_is_desired\": true,\n            \"relocating_node\": null,\n            \"relocating_node_is_desired\": false,\n            \"shard_id\": 1,\n            \"index\": \"test\",\n            \"forecast_write_load\": null,\n            \"forecast_shard_size_in_bytes\": null,\n            \"tier_preference\": [\"data_content\"]\n          }\n        ],\n        \"desired\": {\n          \"node_ids\": [\n            \"2x1VTuSOQdeguXPdN73yRw\"\n          ],\n          \"total\": 1,\n          \"unassigned\": 0,\n          \"ignored\": 0\n        }\n      }\n    }\n  },\n  \"cluster_info\" : {\n      \"nodes\" : {\n        \"UPYt8VwWTt-IADAEbqpLxA\" : {\n          \"node_name\" : \"node-1\",\n          \"least_available\" : {\n            \"path\" : \"/data\",\n            \"total_bytes\" : 1440713945,\n            \"used_bytes\" : 1222486407,\n            \"free_bytes\" : 218227538,\n            \"free_disk_percent\" : 15.1,\n            \"used_disk_percent\" : 84.9\n          },\n          \"most_available\" : {\n            \"path\" : \"/data\",\n            \"total_bytes\" : 1440713945,\n            \"used_bytes\" : 1222486407,\n            \"free_bytes\" : 218227538,\n            \"free_disk_percent\" : 15.1,\n            \"used_disk_percent\" : 84.9\n          }\n        }\n      },\n      \"shard_sizes\" : {\n        \"[test][0][p]_bytes\" : 1720826288,\n        \"[test][1][p]_bytes\" : 1720826288\n      },\n      \"shard_data_set_sizes\" : {\n        \"[test][0][p]_bytes\" : 1720826288,\n        \"[test][1][p]_bytes\" : 1720826288\n      },\n      \"shard_paths\" : {\n        \"NodeAndShard[nodeId=UPYt8VwWTt-IADAEbqpLxA, shardId=[test][0]]\" : \"/data\",\n        \"NodeAndShard[nodeId=bgC66tboTIeFQ0VgRGI4Gg, shardId=[test][0]]\" : \"/data\"\n      },\n      \"reserved_sizes\" : []\n  }\n}\n--------------------------------------------------\n// TEST[skip:Can't reliably test desired balance]\n"
}