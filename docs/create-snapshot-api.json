{
    "meta": {
        "timestamp": "2024-11-01T02:49:24.792065",
        "size": 6584,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/create-snapshot-api.html",
        "type": "documentation",
        "role": [
            "child_attributes"
        ],
        "has_code": false,
        "title": "create-snapshot-api",
        "version": "8.15"
    },
    "doc": "[[create-snapshot-api]]\n=== Create snapshot API\n++++\n<titleabbrev>Create snapshot</titleabbrev>\n++++\n\n<<snapshots-take-snapshot,Takes a snapshot>> of a cluster or specified data\nstreams and indices.\n\n////\n[source,console]\n-----------------------------------\nPUT /_snapshot/my_repository\n{\n  \"type\": \"fs\",\n  \"settings\": {\n    \"location\": \"my_backup_location\"\n  }\n}\n-----------------------------------\n// TESTSETUP\n////\n\n[source,console]\n-----------------------------------\nPUT /_snapshot/my_repository/my_snapshot\n-----------------------------------\n// TEST[s/my_snapshot/my_snapshot?wait_for_completion=true/]\n\n[[create-snapshot-api-request]]\n==== {api-request-title}\n\n`PUT /_snapshot/<repository>/<snapshot>`\n\n`POST /_snapshot/<repository>/<snapshot>`\n\n[[create-snapshot-api-prereqs]]\n==== {api-prereq-title}\n\n* If the {es} {security-features} are enabled, you must have the\n`create_snapshot` or `manage` <<privileges-list-cluster,cluster privilege>> to\nuse this API.\n\n[[create-snapshot-api-path-params]]\n==== {api-path-parms-title}\n\n`<repository>`::\n(Required, string)\nName of the snapshot repository.\n\n`<snapshot>`::\n(Required, string)\nName of the snapshot. Supports <<api-date-math-index-names,date math>>. Must be\nunique within the snapshot repository.\n\n[[create-snapshot-api-query-params]]\n==== {api-query-parms-title}\n\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=master-timeout]\n\n`wait_for_completion`::\n(Optional, Boolean) If `true`, the request returns a response when the snapshot\nis complete. If `false`, the request returns a response when the snapshot\ninitializes. Defaults to `false`.\n\n[role=\"child_attributes\"]\n[[create-snapshot-api-request-body]]\n==== {api-request-body-title}\n\n// Set an attribute so we can reuse these params with anchors\n:page-id: create-snapshot-api\n// tag::snapshot-config[]\n`expand_wildcards`::\n+\n--\n(Optional, string) Determines how wildcard patterns in the `indices` parameter\nmatch data streams and indices. Supports comma-separated values, such as\n`open,hidden`. Defaults to `all`. Valid values are:\n\n`all`:::\nMatch any data stream or index, including closed and <<multi-hidden,hidden>> ones.\n\n`open`:::\nMatch open indices and data streams.\n\n`closed`:::\nMatch closed indices and data streams.\n\n`hidden`:::\nMatch hidden data streams and indices. Must be combined with `open`, `closed`,\nor both.\n\n`none`:::\nDon't expand wildcard patterns.\n--\n\n`ignore_unavailable`::\n(Optional, Boolean)\nIf `false`, the snapshot fails if any data stream or index in `indices` is\nmissing. If `true`, the snapshot ignores missing data\nstreams and indices. Defaults to `false`.\n\n`include_global_state`::\n+\n--\n(Optional, Boolean)\nIf `true`, include the cluster state in the snapshot. Defaults to `true`.\nThe cluster state includes:\n\ninclude::restore-snapshot-api.asciidoc[tag=cluster-state-contents]\n--\n\n`indices`::\n(Optional, string or array of strings)\nComma-separated list of data streams and indices to include in the snapshot.\nSupports <<api-multi-index,multi-target syntax>>. Defaults to an empty array\n(`[]`), which includes all regular data streams and regular indices. To exclude\nall data streams and indices, use `-*`.\n+\nYou can't use this parameter to include or exclude <<system-indices,system\nindices or system data streams>> from a snapshot. Use\n<<{page-id}-feature-states,`feature_states`>> instead.\n\n[id=\"{page-id}-feature-states\"]\n`feature_states`::\n(Optional, array of strings)\n<<feature-state,Feature states>> to include in the snapshot. To get a list of\npossible values and their descriptions, use the <<get-features-api,get features\nAPI>>.\n+\nIf `include_global_state` is `true`, the snapshot includes all feature states by\ndefault. If `include_global_state` is `false`, the snapshot includes no feature\nstates by default.\n+\nNote that specifying an empty array will result in the default behavior. To\nexclude all feature states, regardless of the `include_global_state` value,\nspecify an array with only the value `none` (`[\"none\"]`).\n\n`metadata`::\n(Optional, object)\nAttaches arbitrary metadata to the snapshot, such as a record of who took the snapshot, why it was taken, or any other useful data. Metadata must be less than 1024 bytes.\n\n[id=\"{page-id}-partial\"]\n`partial`::\n(Optional, Boolean)\nIf `false`, the entire snapshot will fail if one or more indices included in the snapshot do not have all primary shards available. Defaults to `false`.\n+\nIf `true`, allows taking a partial snapshot of indices with unavailable shards.\n// end::snapshot-config[]\n\n// Unset the attribute\n:!page-id:\n\n[[create-snapshot-api-example]]\n==== {api-examples-title}\n\nThe following request takes a snapshot of `index_1` and `index_2`.\n\n[source,console]\n-----------------------------------\nPUT /_snapshot/my_repository/snapshot_2?wait_for_completion=true\n{\n  \"indices\": \"index_1,index_2\",\n  \"ignore_unavailable\": true,\n  \"include_global_state\": false,\n  \"metadata\": {\n    \"taken_by\": \"user123\",\n    \"taken_because\": \"backup before upgrading\"\n  }\n}\n-----------------------------------\n\nThe API returns the following response:\n\n[source,console-result]\n----\n{\n  \"snapshot\": {\n    \"snapshot\": \"snapshot_2\",\n    \"uuid\": \"vdRctLCxSketdKb54xw67g\",\n    \"repository\": \"my_repository\",\n    \"version_id\": <version_id>,\n    \"version\": <version>,\n    \"indices\": [],\n    \"data_streams\": [],\n    \"feature_states\": [],\n    \"include_global_state\": false,\n    \"metadata\": {\n      \"taken_by\": \"user123\",\n      \"taken_because\": \"backup before upgrading\"\n    },\n    \"state\": \"SUCCESS\",\n    \"start_time\": \"2020-06-25T14:00:28.850Z\",\n    \"start_time_in_millis\": 1593093628850,\n    \"end_time\": \"2020-06-25T14:00:28.850Z\",\n    \"end_time_in_millis\": 1593094752018,\n    \"duration_in_millis\": 0,\n    \"failures\": [],\n    \"shards\": {\n      \"total\": 0,\n      \"failed\": 0,\n      \"successful\": 0\n    }\n  }\n}\n----\n// TESTRESPONSE[s/\"uuid\": \"vdRctLCxSketdKb54xw67g\"/\"uuid\": $body.snapshot.uuid/]\n// TESTRESPONSE[s/\"version_id\": <version_id>/\"version_id\": $body.snapshot.version_id/]\n// TESTRESPONSE[s/\"version\": <version>/\"version\": $body.snapshot.version/]\n// TESTRESPONSE[s/\"start_time\": \"2020-06-25T14:00:28.850Z\"/\"start_time\": $body.snapshot.start_time/]\n// TESTRESPONSE[s/\"start_time_in_millis\": 1593093628850/\"start_time_in_millis\": $body.snapshot.start_time_in_millis/]\n// TESTRESPONSE[s/\"end_time\": \"2020-06-25T14:00:28.850Z\"/\"end_time\": $body.snapshot.end_time/]\n// TESTRESPONSE[s/\"end_time_in_millis\": 1593094752018/\"end_time_in_millis\": $body.snapshot.end_time_in_millis/]\n// TESTRESPONSE[s/\"duration_in_millis\": 0/\"duration_in_millis\": $body.snapshot.duration_in_millis/]\n"
}