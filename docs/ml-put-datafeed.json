{
    "meta": {
        "timestamp": "2024-11-01T03:02:53.224579",
        "size": 5666,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-put-datafeed.html",
        "type": "documentation",
        "role": [
            "xpack",
            "child_attributes"
        ],
        "has_code": true,
        "title": "ml-put-datafeed",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[ml-put-datafeed]]\n= Create {dfeeds} API\n\n[subs=\"attributes\"]\n++++\n<titleabbrev>Create {dfeeds}</titleabbrev>\n++++\n\nInstantiates a {dfeed}.\n\n[[ml-put-datafeed-request]]\n== {api-request-title}\n\n`PUT _ml/datafeeds/<feed_id>`\n\n[[ml-put-datafeed-prereqs]]\n== {api-prereq-title}\n\n* You must create an {anomaly-job} before you create a {dfeed}.\n* Requires the following privileges:\n** cluster: `manage_ml` (the `machine_learning_admin` built-in role grants this \n  privilege)\n** source index configured in the {dfeed}: `read`\n\n[[ml-put-datafeed-desc]]\n== {api-description-title}\n\n{ml-docs}/ml-ad-run-jobs.html#ml-ad-datafeeds[{dfeeds-cap}] retrieve data from \n{es} for analysis by an {anomaly-job}. You can associate only one {dfeed} to \neach {anomaly-job}.\n\nThe {dfeed} contains a query that runs at a defined interval (`frequency`). If\nyou are concerned about delayed data, you can add a delay (`query_delay`) at\neach interval. See {ml-docs}/ml-delayed-data-detection.html[Handling delayed data].\n\n[IMPORTANT]\n====\n* You must use {kib}, this API, or the <<ml-put-job,create {anomaly-jobs} API>>\nto create a {dfeed}. Do not add a {dfeed} directly to the `.ml-config` index\nusing the {es} index API. If {es} {security-features} are enabled, do not give\nusers `write` privileges on the `.ml-config` index.\n* When {es} {security-features} are enabled, your {dfeed} remembers which roles\nthe user who created it had at the time of creation and runs the query using\nthose same roles. If you provide\n<<http-clients-secondary-authorization,secondary authorization headers>>, those\ncredentials are used instead.\n====\n\n[[ml-put-datafeed-path-parms]]\n== {api-path-parms-title}\n\n`<feed_id>`::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=datafeed-id]\n\n[[ml-put-datafeed-query-params]]\n== {api-query-parms-title}\n\n`allow_no_indices`::\n(Optional, Boolean) If `true`, wildcard indices expressions that resolve into no\nconcrete indices are ignored. This includes the `_all` string or when no indices\nare specified. Defaults to `true`.\n\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=expand-wildcards]\n+\nDefaults to `open`.\n\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=ignore_throttled]\n\n`ignore_unavailable`::\n(Optional, Boolean) If `true`, unavailable indices (missing or closed) are\nignored. Defaults to `false`.\n\n\n[role=\"child_attributes\"]\n[[ml-put-datafeed-request-body]]\n== {api-request-body-title}\n\n`aggregations`::\n(Optional, object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=aggregations]\n\n`chunking_config`::\n(Optional, object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=chunking-config]\n+\n.Properties of `chunking_config`\n[%collapsible%open]\n====\n`mode`:::\n(string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=mode]\n\n`time_span`:::\n(<<time-units,time units>>)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=time-span]\n====\n\n`delayed_data_check_config`::\n(Optional, object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=delayed-data-check-config]\n+\n.Properties of `delayed_data_check_config`\n[%collapsible%open]\n====\n`check_window`::\n(<<time-units,time units>>)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=delayed-data-check-config-check-window]\n\n`enabled`::\n(Boolean)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=delayed-data-check-config-enabled]\n====\n\n`frequency`::\n(Optional, <<time-units, time units>>)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=frequency]\n\n`indices`::\n(Required, array)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=indices]\n\n`indices_options`::\n(Optional, object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=indices-options]\n\n`job_id`::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=job-id-anomaly-detection]\n\n`max_empty_searches`::\n(Optional,integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=max-empty-searches]\n\n`query`::\n(Optional, object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=query]\n\n`query_delay`::\n(Optional, <<time-units, time units>>)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=query-delay]\n\n`runtime_mappings`::\n(Optional, object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=runtime-mappings]\n\n`script_fields`::\n(Optional, object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=script-fields]\n\n`scroll_size`::\n(Optional, unsigned integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=scroll-size]\n\n[[ml-put-datafeed-example]]\n== {api-examples-title}\n\nCreate a {dfeed} for an {anomaly-job} (`test-job`):\n\n[source,console]\n--------------------------------------------------\nPUT _ml/datafeeds/datafeed-test-job?pretty\n{\n  \"indices\": [\n    \"kibana_sample_data_logs\"\n  ],\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"match_all\": {}\n        }\n      ]\n    }\n  },\n  \"job_id\": \"test-job\"\n}\n--------------------------------------------------\n// TEST[skip:setup ecommerce job]\n\nWhen the {dfeed} is created, you receive the following results:\n\n[source,console-result]\n----\n{\n  \"datafeed_id\" : \"datafeed-test-job\",\n  \"job_id\" : \"test-job\",\n  \"authorization\" : {\n    \"roles\" : [\n      \"superuser\"\n    ]\n  },\n  \"query_delay\" : \"91820ms\",\n  \"chunking_config\" : {\n    \"mode\" : \"auto\"\n  },\n  \"indices_options\" : {\n    \"expand_wildcards\" : [\n      \"open\"\n    ],\n    \"ignore_unavailable\" : false,\n    \"allow_no_indices\" : true,\n    \"ignore_throttled\" : true\n  },\n  \"query\" : {\n    \"bool\" : {\n      \"must\" : [\n        {\n          \"match_all\" : { }\n        }\n      ]\n    }\n  },\n  \"indices\" : [\n    \"kibana_sample_data_logs\"\n  ],\n  \"scroll_size\" : 1000,\n  \"delayed_data_check_config\" : {\n    \"enabled\" : true\n  }\n}\n----\n// TESTRESPONSE[s/\"query_delay\": \"91820ms\"/\"query_delay\": $body.query_delay/]\n\n"
}