{
    "meta": {
        "timestamp": "2024-11-01T03:07:09.608284",
        "size": 4546,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-matrix-stats-aggregation.html",
        "type": "documentation",
        "role": [],
        "has_code": true,
        "title": "search-aggregations-matrix-stats-aggregation",
        "version": "8.15"
    },
    "doc": "[[search-aggregations-matrix-stats-aggregation]]\n=== Matrix stats aggregation\n++++\n<titleabbrev>Matrix stats</titleabbrev>\n++++\n\nThe `matrix_stats` aggregation is a numeric aggregation that computes the following statistics over a set of document fields:\n\n[horizontal]\n`count`:: Number of per field samples included in the calculation.\n`mean`:: The average value for each field.\n`variance`:: Per field Measurement for how spread out the samples are from the mean.\n`skewness`:: Per field measurement quantifying the asymmetric distribution around the mean.\n`kurtosis`:: Per field measurement quantifying the shape of the distribution.\n`covariance`:: A matrix that quantitatively describes how changes in one field are associated with another.\n`correlation`:: The covariance matrix scaled to a range of -1 to 1, inclusive. Describes the relationship between field\n            distributions.\n\nIMPORTANT: Unlike other metric aggregations, the `matrix_stats` aggregation does\nnot support scripting.\n\n//////////////////////////\n\n[source,js]\n--------------------------------------------------\nPUT /statistics/_doc/0\n{\"poverty\": 24.0, \"income\": 50000.0}\n\nPUT /statistics/_doc/1\n{\"poverty\": 13.0, \"income\": 95687.0}\n\nPUT /statistics/_doc/2\n{\"poverty\": 69.0, \"income\": 7890.0}\n\nPOST /_refresh\n--------------------------------------------------\n// NOTCONSOLE\n// TESTSETUP\n\n//////////////////////////\n\nThe following example demonstrates the use of matrix stats to describe the relationship between income and poverty.\n\n[source,console,id=stats-aggregation-example]\n--------------------------------------------------\nGET /_search\n{\n  \"aggs\": {\n    \"statistics\": {\n      \"matrix_stats\": {\n        \"fields\": [ \"poverty\", \"income\" ]\n      }\n    }\n  }\n}\n--------------------------------------------------\n// TEST[s/_search/_search\\?filter_path=aggregations/]\n\nThe aggregation type is `matrix_stats` and the `fields` setting defines the set of fields (as an array) for computing\nthe statistics. The above request returns the following response:\n\n[source,console-result]\n--------------------------------------------------\n{\n  ...\n  \"aggregations\": {\n    \"statistics\": {\n      \"doc_count\": 50,\n      \"fields\": [ {\n          \"name\": \"income\",\n          \"count\": 50,\n          \"mean\": 51985.1,\n          \"variance\": 7.383377037755103E7,\n          \"skewness\": 0.5595114003506483,\n          \"kurtosis\": 2.5692365287787124,\n          \"covariance\": {\n            \"income\": 7.383377037755103E7,\n            \"poverty\": -21093.65836734694\n          },\n          \"correlation\": {\n            \"income\": 1.0,\n            \"poverty\": -0.8352655256272504\n          }\n        }, {\n          \"name\": \"poverty\",\n          \"count\": 50,\n          \"mean\": 12.732000000000001,\n          \"variance\": 8.637730612244896,\n          \"skewness\": 0.4516049811903419,\n          \"kurtosis\": 2.8615929677997767,\n          \"covariance\": {\n            \"income\": -21093.65836734694,\n            \"poverty\": 8.637730612244896\n          },\n          \"correlation\": {\n            \"income\": -0.8352655256272504,\n            \"poverty\": 1.0\n          }\n        } ]\n    }\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/\\.\\.\\.//]\n// TESTRESPONSE[s/: (\\-)?[0-9\\.E]+/: $body.$_path/]\n\nThe `doc_count` field indicates the number of documents involved in the computation of the statistics.\n\n==== Multi Value Fields\n\nThe `matrix_stats` aggregation treats each document field as an independent sample. The `mode` parameter controls what\narray value the aggregation will use for array or multi-valued fields. This parameter can take one of the following:\n\n[horizontal]\n`avg`:: (default) Use the average of all values.\n`min`:: Pick the lowest value.\n`max`:: Pick the highest value.\n`sum`:: Use the sum of all values.\n`median`:: Use the median of all values.\n\n==== Missing Values\n\nThe `missing` parameter defines how documents that are missing a value should be treated.\nBy default they will be ignored but it is also possible to treat them as if they had a value.\nThis is done by adding a set of fieldname : value mappings to specify default values per field.\n\n[source,console,id=stats-aggregation-missing-example]\n--------------------------------------------------\nGET /_search\n{\n  \"aggs\": {\n    \"matrixstats\": {\n      \"matrix_stats\": {\n        \"fields\": [ \"poverty\", \"income\" ],\n        \"missing\": { \"income\": 50000 }      <1>\n      }\n    }\n  }\n}\n--------------------------------------------------\n\n<1> Documents without a value in the `income` field will have the default value `50000`.\n"
}