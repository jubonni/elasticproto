{
    "meta": {
        "timestamp": "2024-11-01T02:49:25.376066",
        "size": 4780,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/ilm-searchable-snapshot.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "ilm-searchable-snapshot",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[ilm-searchable-snapshot]]\n=== Searchable snapshot\n\nPhases allowed: hot, cold, frozen.\n\nTakes a snapshot of the managed index in the configured repository and mounts it\nas a <<searchable-snapshots,{search-snap}>>. If the index is part of a\n<<data-streams, data stream>>, the mounted index replaces the original index in\nthe stream.\n\nThe `searchable_snapshot` action requires <<data-tiers,data tiers>>. The action\nuses the\n<<tier-preference-allocation-filter,`index.routing.allocation.include._tier_preference`>>\nsetting to mount the index directly to the phase's corresponding data tier. In\nthe frozen phase, the action mounts a <<partially-mounted,partially mounted\nindex>> prefixed with `partial-` to the frozen tier. In other phases, the action mounts a\n<<fully-mounted,fully mounted index>> prefixed with `restored-` to the corresponding data tier.\n\nIn the frozen tier, the action will ignore the setting\n<<total-shards-per-node,`index.routing.allocation.total_shards_per_node`>>, if it was present in the original index,\nto account for the difference in the number of nodes between the frozen and the other tiers. To set <<total-shards-per-node,`index.routing.allocation.total_shards_per_node`>> for searchable snapshots, set the `total_shards_per_node` option in the frozen phase's `searchable_snapshot` action within the ILM policy.\n\n\nWARNING: Don't include the `searchable_snapshot` action in both the hot and cold\nphases. This can result in indices failing to automatically migrate to the cold\ntier during the cold phase.\n\nIf the `searchable_snapshot` action is used in the hot phase the subsequent\nphases cannot include the `shrink` or `forcemerge` actions.\n\nThis action cannot be performed on a data stream's write index. Attempts to do\nso will fail. To convert the index to a searchable snapshot, first\n<<manually-roll-over-a-data-stream,manually roll over>> the data stream. This\ncreates a new write index. Because the index is no longer the stream's write\nindex, the action can then convert it to a searchable snapshot.\nUsing a policy that makes use of the <<ilm-rollover, rollover>> action\nin the hot phase will avoid this situation and the need for a manual rollover for future\nmanaged indices.\n\nIMPORTANT: Mounting and relocating the shards of {search-snap} indices involves\ncopying the shard contents from the snapshot repository. This may incur\ndifferent costs from the copying between nodes that happens with regular\nindices. These costs are typically lower but, in some environments, may be\nhigher. See <<searchable-snapshots-costs>> for more details.\n\nBy default, this snapshot is deleted by the <<ilm-delete, delete action>> in the delete phase.\nTo keep the snapshot, set `delete_searchable_snapshot` to `false` in the delete action. This\nsnapshot retention runs off the index lifecycle management (ILM) policies and is not effected by snapshot lifecycle management (SLM) policies.\n\n[[ilm-searchable-snapshot-options]]\n==== Options\n\n`snapshot_repository`::\n(Required, string)\n<<snapshots-register-repository,Repository>> used to store the snapshot.\n\n`force_merge_index`::\n(Optional, Boolean)\nForce merges the managed index to one segment.\nDefaults to `true`.\nIf the managed index was already force merged using the\n<<ilm-forcemerge, force merge action>> in a previous action\nthe `searchable snapshot` action force merge step will be a no-op.\n\n[NOTE]\nShards that are relocating during a `forcemerge` will not be merged.\nThe `searchable_snapshot` action will continue executing even if not all shards\nare force merged.\n\nThis force merging occurs in the phase that the index is in *prior* to the `searchable_snapshot`\naction. For example, if using a `searchable_snapshot` action in the `hot` phase, the force merge\nwill be performed on the hot nodes. If using a `searchable_snapshot` action in the `cold` phase, the\nforce merge will be performed on whatever tier the index is *prior* to the `cold` phase (either\n`hot` or `warm`).\n\n`total_shards_per_node`::\nThe maximum number of shards (replicas and primaries) that will be allocated to a single node for the searchable snapshot index. Defaults to unbounded.\n\n[[ilm-searchable-snapshot-ex]]\n==== Examples\n////\n[source,console]\n--------------------------------------------------\nPUT /_snapshot/backing_repo\n{\n \"type\": \"fs\",\n  \"settings\": {\n    \"location\": \"my_backup_location\"\n  }\n}\n--------------------------------------------------\n// TESTSETUP\n////\n[source,console]\n--------------------------------------------------\nPUT _ilm/policy/my_policy\n{\n  \"policy\": {\n    \"phases\": {\n      \"cold\": {\n        \"actions\": {\n          \"searchable_snapshot\" : {\n            \"snapshot_repository\" : \"backing_repo\"\n          }\n        }\n      }\n    }\n  }\n}\n--------------------------------------------------\n"
}