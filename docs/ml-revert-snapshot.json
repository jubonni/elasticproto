{
    "meta": {
        "timestamp": "2024-11-01T02:49:26.253069",
        "size": 4085,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-revert-snapshot.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "ml-revert-snapshot",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[ml-revert-snapshot]]\n= Revert model snapshots API\n++++\n<titleabbrev>Revert model snapshots</titleabbrev>\n++++\n\nReverts to a specific snapshot.\n\n[[ml-revert-snapshot-request]]\n== {api-request-title}\n\n`POST _ml/anomaly_detectors/<job_id>/model_snapshots/<snapshot_id>/_revert`\n\n[[ml-revert-snapshot-prereqs]]\n== {api-prereq-title}\n\n* Before you revert to a saved snapshot, you must close the job.\n* Requires the `manage_ml` cluster privilege. This privilege is included in the \n`machine_learning_admin` built-in role.\n\n[[ml-revert-snapshot-desc]]\n== {api-description-title}\n\nThe {ml-features} react quickly to anomalous input, learning new\nbehaviors in data. Highly anomalous input increases the variance in the models\nwhilst the system learns whether this is a new step-change in behavior or a\none-off event. In the case where this anomalous input is known to be a one-off,\nthen it might be appropriate to reset the model state to a time before this\nevent. For example, you might consider reverting to a saved snapshot after Black\nFriday or a critical system failure.\n\nNOTE: Reverting to a snapshot does not change the `data_counts` values of the \n{anomaly-job}, these values are not reverted to the earlier state.\n\n\n[[ml-revert-snapshot-path-parms]]\n== {api-path-parms-title}\n\n`<job_id>`::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=job-id-anomaly-detection]\n\n`<snapshot_id>`::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=snapshot-id]\n+\n--\nYou can specify `empty` as the <snapshot_id>. Reverting to the `empty` snapshot \nmeans the {anomaly-job} starts learning a new model from scratch when it is \nstarted.\n--\n\n[[ml-revert-snapshot-query-parms]]\n== {api-query-parms-title}\n\n`delete_intervening_results`::\n(Optional, Boolean) If true, deletes the results in the time period between\nthe latest results and the time of the reverted snapshot. It also resets the\nmodel to accept records for this time period. The default value is false.\n+\n--\nNOTE: If you choose not to delete intervening results when reverting a snapshot,\nthe job will not accept input data that is older than the current time.\nIf you want to resend data, then delete the intervening results.\n--\n\n[[ml-revert-snapshot-request-body]]\n== {api-request-body-title}\n\nYou can also specify the `delete_intervening_results` query parameter in the\nrequest body.\n\n[[ml-revert-snapshot-example]]\n== {api-examples-title}\n\n[source,console]\n--------------------------------------------------\nPOST _ml/anomaly_detectors/low_request_rate/model_snapshots/1637092688/_revert\n{\n  \"delete_intervening_results\": true\n}\n--------------------------------------------------\n// TEST[skip:todo]\n\n\nWhen the operation is complete, you receive the following results:\n[source,js]\n----\n{\n  \"model\" : {\n    \"job_id\" : \"low_request_rate\",\n    \"min_version\" : \"7.11.0\",\n    \"timestamp\" : 1637092688000,\n    \"description\" : \"State persisted due to job close at 2021-11-16T19:58:08+0000\",\n    \"snapshot_id\" : \"1637092688\",\n    \"snapshot_doc_count\" : 1,\n    \"model_size_stats\" : {\n      \"job_id\" : \"low_request_rate\",\n      \"result_type\" : \"model_size_stats\",\n      \"model_bytes\" : 45200,\n      \"peak_model_bytes\" : 101552,\n      \"model_bytes_exceeded\" : 0,\n      \"model_bytes_memory_limit\" : 11534336,\n      \"total_by_field_count\" : 3,\n      \"total_over_field_count\" : 0,\n      \"total_partition_field_count\" : 2,\n      \"bucket_allocation_failures_count\" : 0,\n      \"memory_status\" : \"ok\",\n      \"assignment_memory_basis\" : \"current_model_bytes\",\n      \"categorized_doc_count\" : 0,\n      \"total_category_count\" : 0,\n      \"frequent_category_count\" : 0,\n      \"rare_category_count\" : 0,\n      \"dead_category_count\" : 0,\n      \"failed_category_count\" : 0,\n      \"categorization_status\" : \"ok\",\n      \"log_time\" : 1637092688530,\n      \"timestamp\" : 1641495600000\n    },\n    \"latest_record_time_stamp\" : 1641502169000,\n    \"latest_result_time_stamp\" : 1641495600000,\n    \"retain\" : false\n  }\n}\n----\n\nFor a description of these properties, see the \n<<ml-get-snapshot-results,get model snapshots API>>.\n"
}