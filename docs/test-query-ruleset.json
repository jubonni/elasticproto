{
    "meta": {
        "timestamp": "2024-11-01T02:49:26.656068",
        "size": 2936,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/test-query-ruleset.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "test-query-ruleset",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[test-query-ruleset]]\n=== Test query ruleset\n\n++++\n<titleabbrev>Tests query ruleset</titleabbrev>\n++++\n\nEvaluates match criteria against a query ruleset to identify the rules that would match that criteria.\n\npreview::[]\n\n[[test-query-ruleset-request]]\n==== {api-request-title}\n\n`POST _query_rules/<ruleset_id>/_test`\n\n[[test-query-ruleset-prereq]]\n==== {api-prereq-title}\n\nRequires the `manage_search_query_rules` privilege.\n\n[[test-query-ruleset-path-params]]\n==== {api-path-parms-title}\n\n`<ruleset_id>`::\n(Required, string)\n\n[[test-query-rule-request-body]]\n==== {api-request-body-title}\n\n`match_criteria`::\n(Required, object) Defines the match criteria to apply to rules in the given query ruleset.\nMatch criteria should match the keys defined in the `criteria.metadata` field of the rule.\n\n[[test-query-ruleset-response-codes]]\n==== {api-response-codes-title}\n\n`400`::\nThe `ruleset_id` or `match_criteria` were not provided.\n\n`404` (Missing resources)::\nNo query ruleset matching `ruleset_id` could be found.\n\n[[test-query-ruleset-example]]\n==== {api-examples-title}\n\nTo test a ruleset, provide the match criteria that you want to test against:\n\n////\n\n[source,console]\n--------------------------------------------------\nPUT _query_rules/my-ruleset\n{\n    \"rules\": [\n        {\n            \"rule_id\": \"my-rule1\",\n            \"type\": \"pinned\",\n            \"criteria\": [\n                {\n                    \"type\": \"contains\",\n                    \"metadata\": \"query_string\",\n                    \"values\": [ \"pugs\", \"puggles\" ]\n                }\n            ],\n            \"actions\": {\n                \"ids\": [\n                    \"id1\",\n                    \"id2\"\n                ]\n            }\n        },\n        {\n            \"rule_id\": \"my-rule2\",\n            \"type\": \"pinned\",\n            \"criteria\": [\n                {\n                    \"type\": \"fuzzy\",\n                    \"metadata\": \"query_string\",\n                    \"values\": [ \"rescue dogs\" ]\n                }\n            ],\n            \"actions\": {\n                \"docs\": [\n                    {\n                        \"_index\": \"index1\",\n                        \"_id\": \"id3\"\n                    },\n                    {\n                        \"_index\": \"index2\",\n                        \"_id\": \"id4\"\n                    }\n                ]\n            }\n        }\n    ]\n}\n--------------------------------------------------\n// TESTSETUP\n\n[source,console]\n--------------------------------------------------\nDELETE _query_rules/my-ruleset\n--------------------------------------------------\n// TEARDOWN\n\n////\n\n[source,console]\n----\nPOST _query_rules/my-ruleset/_test\n{\n    \"match_criteria\": {\n        \"query_string\": \"puggles\"\n    }\n}\n----\n\nA sample response:\n\n[source,console-result]\n----\n{\n    \"total_matched_rules\": 1,\n    \"matched_rules\": [\n        {\n            \"ruleset_id\": \"my-ruleset\",\n            \"rule_id\": \"my-rule1\"\n        }\n    ]\n}\n----\n"
}