{
    "meta": {
        "size": 27450,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/put-dfanalytics.html",
        "type": "documentation",
        "role": [
            "xpack",
            "child_attributes"
        ],
        "has_code": true,
        "title": "put-dfanalytics",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[put-dfanalytics]]\n= Create {dfanalytics-jobs} API\n[subs=\"attributes\"]\n++++\n<titleabbrev>Create {dfanalytics-jobs}</titleabbrev>\n++++\n\nInstantiates a {dfanalytics-job}.\n\n\n[[ml-put-dfanalytics-request]]\n== {api-request-title}\n\n`PUT _ml/data_frame/analytics/<data_frame_analytics_id>`\n\n\n[[ml-put-dfanalytics-prereq]]\n== {api-prereq-title}\n\n\nRequires the following privileges:\n\n* cluster: `manage_ml` (the `machine_learning_admin` built-in role grants this\n  privilege)\n* source indices: `read`, `view_index_metadata`\n* destination index: `read`, `create_index`, `manage` and `index`\n\nNOTE: The {dfanalytics-job} remembers which roles the user who created it had at\nthe time of creation. When you start the job, it performs the analysis using\nthose same roles. If you provide\n<<http-clients-secondary-authorization,secondary authorization headers>>,\nthose credentials are used instead.\n\n[[ml-put-dfanalytics-desc]]\n== {api-description-title}\n\nThis API creates a {dfanalytics-job} that performs an analysis on the source\nindices and stores the outcome in a destination index.\n\nIf the destination index does not exist, it is created automatically when you\nstart the job. See <<start-dfanalytics>>.\n\nIf you supply only a subset of the {regression} or {classification} parameters,\n{ml-docs}/hyperparameters.html[hyperparameter optimization] occurs. It\ndetermines a value for each of the undefined parameters.\n\n\n[[ml-put-dfanalytics-path-params]]\n== {api-path-parms-title}\n\n`<data_frame_analytics_id>`::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=job-id-data-frame-analytics-define]\n\n[role=\"child_attributes\"]\n[[ml-put-dfanalytics-request-body]]\n== {api-request-body-title}\n\n`allow_lazy_start`::\n(Optional, Boolean)\nSpecifies whether this job can start when there is insufficient {ml} node\ncapacity for it to be immediately assigned to a node. The default is `false`; if\na {ml} node with capacity to run the job cannot immediately be found, the API\nreturns an error. However, this is also subject to the cluster-wide\n`xpack.ml.max_lazy_ml_nodes` setting. See <<advanced-ml-settings>>. If this\noption is set to `true`, the API does not return an error and the job waits in\nthe `starting` state until sufficient {ml} node capacity is available.\n\n//Begin analysis\n`analysis`::\n(Required, object)\nThe analysis configuration, which contains the information necessary to perform\none of the following types of analysis: {classification}, {oldetection}, or\n{regression}.\n+\n.Properties of `analysis`\n[%collapsible%open]\n====\n//Begin classification\n`classification`:::\n(Required^*^, object)\nThe configuration information necessary to perform\n{ml-docs}/ml-dfa-classification.html[{classification}].\n+\nTIP: Advanced parameters are for fine-tuning {classanalysis}. They are set\nautomatically by hyperparameter optimization to give the minimum validation\nerror. It is highly recommended to use the default values unless you fully\nunderstand the function of these parameters.\n+\n.Properties of `classification`\n[%collapsible%open]\n=====\n`alpha`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-alpha]\n\n`class_assignment_objective`::::\n(Optional, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=class-assignment-objective]\n\n`dependent_variable`::::\n(Required, string)\n+\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dependent-variable]\n+\nThe data type of the field must be numeric (`integer`, `short`, `long`, `byte`),\ncategorical (`ip` or `keyword`), or boolean. There must be no more than 100\ndifferent values in this field.\n\n`downsample_factor`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-downsample-factor]\n\n`early_stopping_enabled`::::\n(Optional, Boolean)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-early-stopping-enabled]\n\n`eta`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=eta]\n\n`eta_growth_rate_per_tree`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-eta-growth]\n\n`feature_bag_fraction`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=feature-bag-fraction]\n\n`feature_processors`::::\n(Optional, list)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors]\n+\n.Properties of `feature_processors`\n[%collapsible%open]\n======\n`frequency_encoding`::::\n(object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-frequency]\n+\n.Properties of `frequency_encoding`\n[%collapsible%open]\n=======\n`feature_name`::::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-feat-name]\n\n`field`::::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-field]\n\n`frequency_map`::::\n(Required, object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-frequency-map]\n=======\n\n`multi_encoding`::::\n(object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-multi]\n+\n.Properties of `multi_encoding`\n[%collapsible%open]\n=======\n`processors`::::\n(Required, array)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-multi-proc]\n=======\n\n`n_gram_encoding`::::\n(object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-ngram]\n+\n.Properties of `n_gram_encoding`\n[%collapsible%open]\n=======\n`feature_prefix`::::\n(Optional, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-ngram-feat-pref]\n\n`field`::::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-ngram-field]\n\n`length`::::\n(Optional, integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-ngram-length]\n\n`n_grams`::::\n(Required, array)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-ngram-ngrams]\n\n`start`::::\n(Optional, integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-ngram-start]\n=======\n\n`one_hot_encoding`::::\n(object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-one-hot]\n+\n.Properties of `one_hot_encoding`\n[%collapsible%open]\n=======\n`field`::::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-field]\n\n`hot_map`::::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-one-hot-map]\n=======\n\n`target_mean_encoding`::::\n(object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-target-mean]\n+\n.Properties of `target_mean_encoding`\n[%collapsible%open]\n=======\n`default_value`::::\n(Required, integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-target-mean-default]\n\n`feature_name`::::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-feat-name]\n\n`field`::::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-field]\n\n`target_map`::::\n(Required, object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors-target-mean-map]\n=======\n\n======\n\n`gamma`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=gamma]\n\n`lambda`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=lambda]\n\n`max_optimization_rounds_per_hyperparameter`::::\n(Optional, integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-max-optimization-rounds]\n\n`max_trees`::::\n(Optional, integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=max-trees]\n\n`num_top_classes`::::\n(Optional, integer)\nDefines the number of categories for which the predicted probabilities are\nreported. It must be non-negative or -1. If it is -1 or greater than the total\nnumber of categories, probabilities are reported for all categories; if you have\na large number of categories, there could be a significant effect on the size of your destination index. Defaults to 2.\n+\n--\nNOTE: To use the\n{ml-docs}/ml-dfa-classification.html#ml-dfanalytics-class-aucroc[AUC ROC]\nevaluation method, `num_top_classes` must be set to `-1` or a value greater than\nor equal to the total number of categories.\n\n--\n\n`num_top_feature_importance_values`::::\n(Optional, integer)\nAdvanced configuration option. Specifies the maximum number of\n{ml-docs}/ml-feature-importance.html[{feat-imp}] values per document to return.\nBy default, it is zero and no {feat-imp} calculation occurs.\n\n`prediction_field_name`::::\n(Optional, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=prediction-field-name]\n\n`randomize_seed`::::\n(Optional, long)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=randomize-seed]\n\n`soft_tree_depth_limit`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-soft-limit]\n\n`soft_tree_depth_tolerance`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-soft-tolerance]\n\n`training_percent`::::\n(Optional, integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=training-percent]\n//End classification\n=====\n//Begin outlier_detection\n`outlier_detection`:::\n(Required^*^, object)\nThe configuration information necessary to perform\n{ml-docs}/ml-dfa-finding-outliers.html[{oldetection}]:\n+\n.Properties of `outlier_detection`\n[%collapsible%open]\n=====\n`compute_feature_influence`::::\n(Optional, Boolean)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=compute-feature-influence]\n\n`feature_influence_threshold`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=feature-influence-threshold]\n\n`method`::::\n(Optional, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=method]\n\n`n_neighbors`::::\n(Optional, integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=n-neighbors]\n\n`outlier_fraction`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=outlier-fraction]\n\n`standardization_enabled`::::\n(Optional, Boolean)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=standardization-enabled]\n//End outlier_detection\n=====\n//Begin regression\n`regression`:::\n(Required^*^, object)\nThe configuration information necessary to perform\n{ml-docs}/ml-dfa-regression.html[{regression}].\n+\nTIP: Advanced parameters are for fine-tuning {reganalysis}. They are set\nautomatically by hyperparameter optimization to give the minimum validation\nerror. It is highly recommended to use the default values unless you fully\nunderstand the function of these parameters.\n+\n.Properties of `regression`\n[%collapsible%open]\n=====\n`alpha`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-alpha]\n\n`dependent_variable`::::\n(Required, string)\n+\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dependent-variable]\n+\nThe data type of the field must be numeric.\n\n`downsample_factor`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-downsample-factor]\n\n`early_stopping_enabled`::::\n(Optional, Boolean)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-early-stopping-enabled]\n\n`eta`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=eta]\n\n`eta_growth_rate_per_tree`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-eta-growth]\n\n`feature_bag_fraction`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=feature-bag-fraction]\n\n`feature_processors`::::\n(Optional, list)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-feature-processors]\n\n`gamma`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=gamma]\n\n`lambda`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=lambda]\n\n`loss_function`::::\n(Optional, string)\nThe loss function used during {regression}. Available options are `mse` (mean\nsquared error), `msle` (mean squared logarithmic error),  `huber` (Pseudo-Huber\nloss). Defaults to `mse`.\nRefer to\n{ml-docs}/dfa-regression-lossfunction.html[Loss functions for {regression} analyses]\nto learn more.\n\n`loss_function_parameter`::::\n(Optional, double)\nA positive number that is used as a parameter to the `loss_function`.\n\n`max_optimization_rounds_per_hyperparameter`::::\n(Optional, integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-max-optimization-rounds]\n\n`max_trees`::::\n(Optional, integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=max-trees]\n\n`num_top_feature_importance_values`::::\n(Optional, integer)\nAdvanced configuration option. Specifies the maximum number of\n{ml-docs}/ml-feature-importance.html[{feat-imp}] values per document to return.\nBy default, it is zero and no {feat-imp} calculation occurs.\n\n`prediction_field_name`::::\n(Optional, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=prediction-field-name]\n\n`randomize_seed`::::\n(Optional, long)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=randomize-seed]\n\n`soft_tree_depth_limit`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-soft-limit]\n\n`soft_tree_depth_tolerance`::::\n(Optional, double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dfas-soft-tolerance]\n\n`training_percent`::::\n(Optional, integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=training-percent]\n=====\n//End regression\n====\n//End analysis\n\n//Begin analyzed_fields\n`analyzed_fields`::\n(Optional, object)\nSpecify `includes` and/or `excludes` patterns to select which fields will be\nincluded in the analysis. The patterns specified in `excludes` are applied last,\ntherefore `excludes` takes precedence. In other words, if the same field is\nspecified in both `includes` and `excludes`, then the field will not be included\nin the analysis.\n+\n--\n[[dfa-supported-fields]]\nThe supported fields for each type of analysis are as follows:\n\n* {oldetection-cap} requires numeric or boolean data to analyze. The algorithms\ndon't support missing values therefore fields that have data types other than\nnumeric or boolean are ignored. Documents where included fields contain missing\nvalues, null values, or an array are also ignored. Therefore the `dest` index\nmay contain documents that don't have an {olscore}.\n* {regression-cap} supports fields that are numeric, `boolean`, `text`,\n`keyword`, and `ip`. It is also tolerant of missing values. Fields that are\nsupported are included in the analysis, other fields are ignored. Documents\nwhere included fields contain an array with two or more values are also\nignored. Documents in the `dest` index that don\u2019t contain a results field are\nnot included in the {reganalysis}.\n* {classification-cap} supports fields that are numeric, `boolean`, `text`,\n`keyword`, and `ip`. It is also tolerant of missing values. Fields that are\nsupported are included in the analysis, other fields are ignored. Documents\nwhere included fields contain an array with two or more values are also ignored.\nDocuments in the `dest` index that don\u2019t contain a results field are not\nincluded in the {classanalysis}. {classanalysis-cap} can be improved by mapping\nordinal variable values to a single number. For example, in case of age ranges,\nyou can model the values as \"0-14\" = 0, \"15-24\" = 1, \"25-34\" = 2, and so on.\n\nIf `analyzed_fields` is not set, only the relevant fields will be included. For\nexample, all the numeric fields for {oldetection}. For more information about\nfield selection, see <<explain-dfanalytics>>.\n--\n+\n.Properties of `analyzed_fields`\n[%collapsible%open]\n====\n`excludes`:::\n(Optional, array)\nAn array of strings that defines the fields that will be excluded from the\nanalysis. You do not need to add fields with unsupported data types to\n`excludes`, these fields are excluded from the analysis automatically.\n\n`includes`:::\n(Optional, array)\nAn array of strings that defines the fields that will be included in the\nanalysis.\n//End analyzed_fields\n====\n\n`description`::\n(Optional, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=description-dfa]\n\n`dest`::\n(Required, object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=dest]\n\n`max_num_threads`::\n(Optional, integer)\nThe maximum number of threads to be used by the analysis.\nThe default value is `1`. Using more threads may decrease the time\nnecessary to complete the analysis at the cost of using more CPU.\nNote that the process may use additional threads for operational\nfunctionality other than the analysis itself.\n\n`_meta`::\n(Optional, object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=meta]\n\n`model_memory_limit`::\n(Optional, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=model-memory-limit-dfa]\n\n`source`::\n(object)\nThe configuration of how to source the analysis data. It requires an `index`.\nOptionally, `query`, `runtime_mappings`, and `_source` may be specified.\n+\n.Properties of `source`\n[%collapsible%open]\n====\n`index`:::\n(Required, string or array) Index or indices on which to perform the analysis.\nIt can be a single index or index pattern as well as an array of indices or\npatterns.\n+\nWARNING: If your source indices contain documents with the same IDs, only the\ndocument that is indexed last appears in the destination index.\n\n`query`:::\n(Optional, object) The {es} query domain-specific language (<<query-dsl,DSL>>).\nThis value corresponds to the query object in an {es} search POST body. All the\noptions that are supported by {es} can be used, as this object is passed\nverbatim to {es}. By default, this property has the following value:\n`{\"match_all\": {}}`.\n\n`runtime_mappings`:::\n(Optional, object) Definitions of runtime fields that will become part of the\nmapping of the destination index.\n\n`_source`:::\n(Optional, object) Specify `includes` and/or `excludes` patterns to select which\nfields will be present in the destination. Fields that are excluded cannot be\nincluded in the analysis.\n+\n.Properties of `_source`\n[%collapsible%open]\n=====\n`includes`::::\n(array) An array of strings that defines the fields that will be included in the\ndestination.\n\n`excludes`::::\n(array) An array of strings that defines the fields that will be excluded from\nthe destination.\n=====\n====\n\n[[ml-put-dfanalytics-example]]\n== {api-examples-title}\n\n[[ml-put-dfanalytics-example-preprocess]]\n=== Preprocessing actions example\n\nThe following example shows how to limit the scope of the analysis to certain\nfields, specify excluded fields in the destination index, and use a query to\nfilter your data before analysis.\n\n[source,console]\n--------------------------------------------------\nPUT _ml/data_frame/analytics/model-flight-delays-pre\n{\n  \"source\": {\n    \"index\": [\n      \"kibana_sample_data_flights\" <1>\n    ],\n    \"query\": { <2>\n      \"range\": {\n        \"DistanceKilometers\": {\n          \"gt\": 0\n        }\n      }\n    },\n    \"_source\": { <3>\n      \"includes\": [],\n      \"excludes\": [\n        \"FlightDelay\",\n        \"FlightDelayType\"\n      ]\n    }\n  },\n  \"dest\": { <4>\n    \"index\": \"df-flight-delays\",\n    \"results_field\": \"ml-results\"\n  },\n  \"analysis\": {\n  \"regression\": {\n    \"dependent_variable\": \"FlightDelayMin\",\n    \"training_percent\": 90\n    }\n  },\n  \"analyzed_fields\": { <5>\n    \"includes\": [],\n    \"excludes\": [\n      \"FlightNum\"\n    ]\n  },\n  \"model_memory_limit\": \"100mb\"\n}\n--------------------------------------------------\n// TEST[skip:setup kibana sample data]\n\n<1> Source index to analyze.\n<2> This query filters out entire documents that will not be present in the\ndestination index.\n<3> The `_source` object defines fields in the data set that will be included or\nexcluded in the destination index.\n<4> Defines the destination index that contains the results of the analysis and\nthe fields of the source index specified in the `_source` object. Also defines\nthe name of the `results_field`.\n<5> Specifies fields to be included in or excluded from the analysis. This does\nnot affect whether the fields will be present in the destination index, only\naffects whether they are used in the analysis.\n\nIn this example, we can see that all the fields of the source index are included\nin the destination index except `FlightDelay` and `FlightDelayType` because\nthese are defined as excluded fields by the `excludes` parameter of the\n`_source` object. The `FlightNum` field is included in the destination index,\nhowever it is not included in the analysis because it is explicitly specified as\nexcluded field by the `excludes` parameter of the `analyzed_fields` object.\n\n\n[[ml-put-dfanalytics-example-od]]\n=== {oldetection-cap} example\n\nThe following example creates the `loganalytics` {dfanalytics-job}, the analysis\ntype is `outlier_detection`:\n\n[source,console]\n--------------------------------------------------\nPUT _ml/data_frame/analytics/loganalytics\n{\n  \"description\": \"Outlier detection on log data\",\n  \"source\": {\n    \"index\": \"logdata\"\n  },\n  \"dest\": {\n    \"index\": \"logdata_out\"\n  },\n  \"analysis\": {\n    \"outlier_detection\": {\n      \"compute_feature_influence\": true,\n      \"outlier_fraction\": 0.05,\n      \"standardization_enabled\": true\n    }\n  }\n}\n--------------------------------------------------\n// TEST[setup:setup_logdata]\n\n\nThe API returns the following result:\n\n[source,console-result]\n----\n{\n  \"id\" : \"loganalytics\",\n  \"create_time\" : 1656364565517,\n  \"version\" : \"8.4.0\",\n  \"authorization\" : {\n    \"roles\" : [\n      \"superuser\"\n    ]\n  },\n  \"description\" : \"Outlier detection on log data\",\n  \"source\" : {\n    \"index\" : [\n      \"logdata\"\n    ],\n    \"query\" : {\n      \"match_all\" : { }\n    }\n  },\n  \"dest\" : {\n    \"index\" : \"logdata_out\",\n    \"results_field\" : \"ml\"\n  },\n  \"analysis\" : {\n    \"outlier_detection\" : {\n      \"compute_feature_influence\" : true,\n      \"outlier_fraction\" : 0.05,\n      \"standardization_enabled\" : true\n    }\n  },\n  \"model_memory_limit\" : \"1gb\",\n  \"allow_lazy_start\" : false,\n  \"max_num_threads\" : 1\n}\n\n----\n// TESTRESPONSE[s/1656364565517/$body.$_path/]\n// TESTRESPONSE[s/\"version\" : \"8.4.0\"/\"version\": $body.version/]\n// TESTRESPONSE[s/\"superuser\"/\"_es_test_root\"/]\n\n\n[[ml-put-dfanalytics-example-r]]\n=== {regression-cap} examples\n\nThe following example creates the `house_price_regression_analysis`\n{dfanalytics-job}, the analysis type is `regression`:\n\n[source,console]\n--------------------------------------------------\nPUT _ml/data_frame/analytics/house_price_regression_analysis\n{\n  \"source\": {\n    \"index\": \"houses_sold_last_10_yrs\"\n  },\n  \"dest\": {\n    \"index\": \"house_price_predictions\"\n  },\n  \"analysis\":\n    {\n      \"regression\": {\n        \"dependent_variable\": \"price\"\n      }\n    }\n}\n--------------------------------------------------\n// TEST[setup:setup_houseprices]\n\n\nThe API returns the following result:\n\n[source,console-result]\n----\n{\n  \"id\" : \"house_price_regression_analysis\",\n  \"create_time\" : 1656364845151,\n  \"version\" : \"8.4.0\",\n  \"authorization\" : {\n    \"roles\" : [\n      \"superuser\"\n    ]\n  },\n  \"source\" : {\n    \"index\" : [\n      \"houses_sold_last_10_yrs\"\n    ],\n    \"query\" : {\n      \"match_all\" : { }\n    }\n  },\n  \"dest\" : {\n    \"index\" : \"house_price_predictions\",\n    \"results_field\" : \"ml\"\n  },\n  \"analysis\" : {\n    \"regression\" : {\n      \"dependent_variable\" : \"price\",\n      \"prediction_field_name\" : \"price_prediction\",\n      \"training_percent\" : 100.0,\n      \"randomize_seed\" : -3578554885299300212,\n      \"loss_function\" : \"mse\",\n      \"early_stopping_enabled\" : true\n    }\n  },\n  \"model_memory_limit\" : \"1gb\",\n  \"allow_lazy_start\" : false,\n  \"max_num_threads\" : 1\n}\n\n----\n// TESTRESPONSE[s/1656364845151/$body.$_path/]\n// TESTRESPONSE[s/\"version\" : \"8.4.0\"/\"version\": $body.version/]\n// TESTRESPONSE[s/\"superuser\"/\"_es_test_root\"/]\n// TESTRESPONSE[s/-3578554885299300212/$body.$_path/]\n\n\nThe following example creates a job and specifies a training percent:\n\n[source,console]\n--------------------------------------------------\nPUT _ml/data_frame/analytics/student_performance_mathematics_0.3\n{\n \"source\": {\n   \"index\": \"student_performance_mathematics\"\n },\n \"dest\": {\n   \"index\":\"student_performance_mathematics_reg\"\n },\n \"analysis\":\n   {\n     \"regression\": {\n       \"dependent_variable\": \"G3\",\n       \"training_percent\": 70,  <1>\n       \"randomize_seed\": 19673948271  <2>\n     }\n   }\n}\n--------------------------------------------------\n// TEST[skip:TBD]\n\n<1> The percentage of the data set that is used for training the model.\n<2> The seed that is used to randomly pick which data is used for training.\n\nThe following example uses custom feature processors to transform the\ncategorical values for `DestWeather` into numerical values using one-hot,\ntarget-mean, and frequency encoding techniques:\n\n[source,console]\n--------------------------------------------------\nPUT _ml/data_frame/analytics/flight_prices\n{\n  \"source\": {\n    \"index\": [\n      \"kibana_sample_data_flights\"\n    ]\n  },\n  \"dest\": {\n    \"index\": \"kibana_sample_flight_prices\"\n  },\n  \"analysis\": {\n    \"regression\": {\n      \"dependent_variable\": \"AvgTicketPrice\",\n      \"num_top_feature_importance_values\": 2,\n      \"feature_processors\": [\n        {\n          \"frequency_encoding\": {\n            \"field\": \"DestWeather\",\n            \"feature_name\": \"DestWeather_frequency\",\n            \"frequency_map\": {\n              \"Rain\": 0.14604811155570188,\n              \"Heavy Fog\": 0.14604811155570188,\n              \"Thunder & Lightning\": 0.14604811155570188,\n              \"Cloudy\": 0.14604811155570188,\n              \"Damaging Wind\": 0.14604811155570188,\n              \"Hail\": 0.14604811155570188,\n              \"Sunny\": 0.14604811155570188,\n              \"Clear\": 0.14604811155570188\n            }\n          }\n        },\n        {\n          \"target_mean_encoding\": {\n            \"field\": \"DestWeather\",\n            \"feature_name\": \"DestWeather_targetmean\",\n            \"target_map\": {\n              \"Rain\": 626.5588814585794,\n              \"Heavy Fog\": 626.5588814585794,\n              \"Thunder & Lightning\": 626.5588814585794,\n              \"Hail\": 626.5588814585794,\n              \"Damaging Wind\": 626.5588814585794,\n              \"Cloudy\": 626.5588814585794,\n              \"Clear\": 626.5588814585794,\n              \"Sunny\": 626.5588814585794\n            },\n            \"default_value\": 624.0249512020454\n          }\n        },\n        {\n          \"one_hot_encoding\": {\n            \"field\": \"DestWeather\",\n            \"hot_map\": {\n              \"Rain\": \"DestWeather_Rain\",\n              \"Heavy Fog\": \"DestWeather_Heavy Fog\",\n              \"Thunder & Lightning\": \"DestWeather_Thunder & Lightning\",\n              \"Cloudy\": \"DestWeather_Cloudy\",\n              \"Damaging Wind\": \"DestWeather_Damaging Wind\",\n              \"Hail\": \"DestWeather_Hail\",\n              \"Clear\": \"DestWeather_Clear\",\n              \"Sunny\": \"DestWeather_Sunny\"\n            }\n          }\n        }\n      ]\n    }\n  },\n  \"analyzed_fields\": {\n    \"includes\": [\n      \"AvgTicketPrice\",\n      \"Cancelled\",\n      \"DestWeather\",\n      \"FlightDelayMin\",\n      \"DistanceMiles\"\n    ]\n  },\n  \"model_memory_limit\": \"30mb\"\n}\n--------------------------------------------------\n// TEST[skip:TBD]\n\nNOTE: These custom feature processors are optional; automatic\n{ml-docs}/ml-feature-encoding.html[feature encoding] still occurs for all\ncategorical features.\n\n[[ml-put-dfanalytics-example-c]]\n=== {classification-cap} example\n\nThe following example creates the `loan_classification` {dfanalytics-job}, the\nanalysis type is `classification`:\n\n[source,console]\n--------------------------------------------------\nPUT _ml/data_frame/analytics/loan_classification\n{\n  \"source\" : {\n    \"index\": \"loan-applicants\"\n  },\n  \"dest\" : {\n    \"index\": \"loan-applicants-classified\"\n  },\n  \"analysis\" : {\n    \"classification\": {\n      \"dependent_variable\": \"label\",\n      \"training_percent\": 75,\n      \"num_top_classes\": 2\n    }\n  }\n}\n--------------------------------------------------\n// TEST[skip:TBD]\n"
}