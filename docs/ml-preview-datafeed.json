{
    "meta": {
        "timestamp": "2024-11-01T02:49:25.964072",
        "size": 6864,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-preview-datafeed.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "ml-preview-datafeed",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[ml-preview-datafeed]]\n= Preview {dfeeds} API\n\n[subs=\"attributes\"]\n++++\n<titleabbrev>Preview {dfeeds}</titleabbrev>\n++++\n\nPreviews a {dfeed}.\n\n[[ml-preview-datafeed-request]]\n== {api-request-title}\n\n`GET _ml/datafeeds/<datafeed_id>/_preview` +\n\n`POST _ml/datafeeds/<datafeed_id>/_preview` +\n\n`GET _ml/datafeeds/_preview` +\n\n`POST _ml/datafeeds/_preview`\n\n[[ml-preview-datafeed-prereqs]]\n== {api-prereq-title}\n\nRequires the following privileges:\n\n* cluster: `manage_ml` (the `machine_learning_admin` built-in role grants this\n   privilege)\n* source index configured in the {dfeed}: `read`.\n\n[[ml-preview-datafeed-desc]]\n== {api-description-title}\n\nThe preview {dfeeds} API returns the first \"page\" of search results from a\n{dfeed}. You can preview an existing {dfeed} or provide configuration details\nfor the {dfeed} and {anomaly-job} in the API. The preview shows the structure of\nthe data that will be passed to the anomaly detection engine.\n\nIMPORTANT: When {es} {security-features} are enabled, the {dfeed} query is\npreviewed using the credentials of the user calling the preview {dfeed} API.\nWhen the {dfeed} is started it runs the query using the roles of the last user\nto create or update it. If the two sets of roles differ then the preview may\nnot accurately reflect what the {dfeed} will return when started. To avoid\nsuch problems, the same user that creates or updates the {dfeed} should preview\nit to ensure it is returning the expected data. Alternatively, use\n<<http-clients-secondary-authorization,secondary authorization headers>> to\nsupply the credentials.\n\n[[ml-preview-datafeed-path-parms]]\n== {api-path-parms-title}\n\n`<datafeed_id>`::\n(Optional, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=datafeed-id]\n+\nNOTE: If you provide the `<datafeed_id>` as a path parameter, you cannot\nprovide {dfeed} or {anomaly-job} configuration details in the request body.\n\n[[ml-preview-datafeed-query-parms]]\n== {api-query-parms-title}\n\n`end`::\n(Optional, string) The time that the {dfeed} preview should end. The preview may not go to the end of the provided value\nas only the first page of results are returned. The time can be specified by using one of the following formats:\n+\n--\n* ISO 8601 format with milliseconds, for example `2017-01-22T06:00:00.000Z`\n* ISO 8601 format without milliseconds, for example `2017-01-22T06:00:00+00:00`\n* Milliseconds since the epoch, for example `1485061200000`\n\nDate-time arguments using either of the ISO 8601 formats must have a time zone\ndesignator, where `Z` is accepted as an abbreviation for UTC time.\n\nNOTE: When a URL is expected (for example, in browsers), the `+` used in time\nzone designators must be encoded as `%2B`.\n\nThis value is exclusive.\n--\n\n`start`::\n(Optional, string) The time that the {dfeed} preview should begin, which can be\nspecified by using the same formats as the `end` parameter. This value is\ninclusive.\n\nNOTE: If you don't provide either the `start` or `end` parameter, the {dfeed} preview will search over the entire\ntime of data but exclude data within `cold` or `frozen` <<data-tiers, data tiers>>.\n\n[[ml-preview-datafeed-request-body]]\n== {api-request-body-title}\n\n`datafeed_config`::\n(Optional, object) The {dfeed} definition to preview. For valid definitions, see\nthe <<ml-put-datafeed-request-body,create {dfeeds} API>>.\n\n`job_config`::\n(Optional, object) The configuration details for the {anomaly-job} that is\nassociated with the {dfeed}. If the `datafeed_config` object does not include a\n`job_id` that references an existing {anomaly-job}, you must supply this\n`job_config` object. If you include both a `job_id` and a `job_config`, the\nlatter information is used. You cannot specify a `job_config` object unless you also supply a `datafeed_config` object. For valid definitions, see the\n<<ml-put-job-request-body,create {anomaly-jobs} API>>.\n\n[[ml-preview-datafeed-example]]\n== {api-examples-title}\n\nThis is an example of providing the ID of an existing {dfeed}:\n\n[source,console]\n--------------------------------------------------\nGET _ml/datafeeds/datafeed-high_sum_total_sales/_preview\n--------------------------------------------------\n// TEST[skip:set up Kibana sample data]\n\nThe data that is returned for this example is as follows:\n\n[source,console-result]\n----\n[\n  {\n    \"order_date\" : 1574294659000,\n    \"category.keyword\" : \"Men's Clothing\",\n    \"customer_full_name.keyword\" : \"Sultan Al Benson\",\n    \"taxful_total_price\" : 35.96875\n  },\n  {\n    \"order_date\" : 1574294918000,\n    \"category.keyword\" : [\n      \"Women's Accessories\",\n      \"Women's Clothing\"\n    ],\n    \"customer_full_name.keyword\" : \"Pia Webb\",\n    \"taxful_total_price\" : 83.0\n  },\n  {\n    \"order_date\" : 1574295782000,\n    \"category.keyword\" : [\n      \"Women's Accessories\",\n      \"Women's Shoes\"\n    ],\n    \"customer_full_name.keyword\" : \"Brigitte Graham\",\n    \"taxful_total_price\" : 72.0\n  }\n]\n----\n\nThe following example provides {dfeed} and {anomaly-job} configuration\ndetails in the API:\n\n[source,console]\n--------------------------------------------------\nPOST _ml/datafeeds/_preview\n{\n  \"datafeed_config\": {\n    \"indices\" : [\n      \"kibana_sample_data_ecommerce\"\n    ],\n    \"query\" : {\n      \"bool\" : {\n        \"filter\" : [\n          {\n            \"term\" : {\n              \"_index\" : \"kibana_sample_data_ecommerce\"\n            }\n          }\n        ]\n      }\n    },\n    \"scroll_size\" : 1000\n  },\n  \"job_config\": {\n    \"description\" : \"Find customers spending an unusually high amount in an hour\",\n    \"analysis_config\" : {\n      \"bucket_span\" : \"1h\",\n      \"detectors\" : [\n        {\n          \"detector_description\" : \"High total sales\",\n          \"function\" : \"high_sum\",\n          \"field_name\" : \"taxful_total_price\",\n          \"over_field_name\" : \"customer_full_name.keyword\"\n        }\n      ],\n      \"influencers\" : [\n        \"customer_full_name.keyword\",\n        \"category.keyword\"\n      ]\n    },\n    \"analysis_limits\" : {\n      \"model_memory_limit\" : \"10mb\"\n    },\n    \"data_description\" : {\n      \"time_field\" : \"order_date\",\n      \"time_format\" : \"epoch_ms\"\n    }\n  }\n}\n--------------------------------------------------\n// TEST[skip:set up Kibana sample data]\n\nThe data that is returned for this example is as follows:\n\n[source,console-result]\n----\n[\n  {\n    \"order_date\" : 1574294659000,\n    \"category.keyword\" : \"Men's Clothing\",\n    \"customer_full_name.keyword\" : \"Sultan Al Benson\",\n    \"taxful_total_price\" : 35.96875\n  },\n  {\n    \"order_date\" : 1574294918000,\n    \"category.keyword\" : [\n      \"Women's Accessories\",\n      \"Women's Clothing\"\n    ],\n    \"customer_full_name.keyword\" : \"Pia Webb\",\n    \"taxful_total_price\" : 83.0\n  },\n  {\n    \"order_date\" : 1574295782000,\n    \"category.keyword\" : [\n      \"Women's Accessories\",\n      \"Women's Shoes\"\n    ],\n    \"customer_full_name.keyword\" : \"Brigitte Graham\",\n    \"taxful_total_price\" : 72.0\n  }\n]\n----\n"
}