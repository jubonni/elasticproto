{
    "meta": {
        "size": 47969,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/find-structure.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": false,
        "title": "find-structure",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[find-structure]]\n= Find text structure API\n\nFinds the structure of text. The text must\ncontain data that is suitable to be ingested into the\n{stack}.\n\n[discrete]\n[[find-structure-request]]\n== {api-request-title}\n\n`POST _text_structure/find_structure`\n\n[discrete]\n[[find-structure-prereqs]]\n== {api-prereq-title}\n\n* If the {es} {security-features} are enabled, you must have `monitor_text_structure` or\n`monitor` cluster privileges to use this API. See\n<<security-privileges>>.\n\n[discrete]\n[[find-structure-desc]]\n== {api-description-title}\n\nThis API provides a starting point for ingesting data into {es} in a format that\nis suitable for subsequent use with other {stack} functionality.\n\nUnlike other {es} endpoints, the data that is posted to this endpoint does not\nneed to be UTF-8 encoded and in JSON format. It must, however, be text; binary\ntext formats are not currently supported.\n\nThe response from the API contains:\n\n* A couple of messages from the beginning of the text.\n* Statistics that reveal the most common values for all fields detected within\nthe text and basic numeric statistics for numeric fields.\n* Information about the structure of the text, which is useful when you write\ningest configurations to index it or similarly formatted text.\n* Appropriate mappings for an {es} index, which you could use to ingest the text.\n\nAll this information can be calculated by the structure finder with no guidance.\nHowever, you can optionally override some of the decisions about the text\nstructure by specifying one or more query parameters.\n\nDetails of the output can be seen in the <<find-structure-examples,examples>>.\n\nIf the structure finder produces unexpected results for some text,\nspecify the `explain` query parameter. It causes an `explanation` to appear in\nthe response, which should help in determining why the returned structure was\nchosen.\n\n[discrete]\n[[find-structure-query-parms]]\n== {api-query-parms-title}\n\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-charset]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-column-names]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-delimiter]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-explain]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-format]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-grok-pattern]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-ecs-compatibility]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-has-header-row]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-line-merge-size-limit]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-lines-to-sample]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-quote]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-should-trim-fields]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-timeout]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-timestamp-field]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-timestamp-format]\n\n[discrete]\n[[find-structure-request-body]]\n== {api-request-body-title}\n\nThe text that you want to analyze. It must contain data that is suitable to\nbe ingested into {es}. It does not need to be in JSON format and it does not\nneed to be UTF-8 encoded. The size is limited to the {es} HTTP receive buffer\nsize, which defaults to 100 Mb.\n\n[discrete]\n[[find-structure-examples]]\n== {api-examples-title}\n\n[discrete]\n[[find-structure-example-nld-json]]\n=== Ingesting newline-delimited JSON\n\nSuppose you have newline-delimited JSON text that contains information about\nsome books. You can send the contents to the `find_structure` endpoint:\n\n[source,console]\n----\nPOST _text_structure/find_structure\n{\"name\": \"Leviathan Wakes\", \"author\": \"James S.A. Corey\", \"release_date\": \"2011-06-02\", \"page_count\": 561}\n{\"name\": \"Hyperion\", \"author\": \"Dan Simmons\", \"release_date\": \"1989-05-26\", \"page_count\": 482}\n{\"name\": \"Dune\", \"author\": \"Frank Herbert\", \"release_date\": \"1965-06-01\", \"page_count\": 604}\n{\"name\": \"Dune Messiah\", \"author\": \"Frank Herbert\", \"release_date\": \"1969-10-15\", \"page_count\": 331}\n{\"name\": \"Children of Dune\", \"author\": \"Frank Herbert\", \"release_date\": \"1976-04-21\", \"page_count\": 408}\n{\"name\": \"God Emperor of Dune\", \"author\": \"Frank Herbert\", \"release_date\": \"1981-05-28\", \"page_count\": 454}\n{\"name\": \"Consider Phlebas\", \"author\": \"Iain M. Banks\", \"release_date\": \"1987-04-23\", \"page_count\": 471}\n{\"name\": \"Pandora's Star\", \"author\": \"Peter F. Hamilton\", \"release_date\": \"2004-03-02\", \"page_count\": 768}\n{\"name\": \"Revelation Space\", \"author\": \"Alastair Reynolds\", \"release_date\": \"2000-03-15\", \"page_count\": 585}\n{\"name\": \"A Fire Upon the Deep\", \"author\": \"Vernor Vinge\", \"release_date\": \"1992-06-01\", \"page_count\": 613}\n{\"name\": \"Ender's Game\", \"author\": \"Orson Scott Card\", \"release_date\": \"1985-06-01\", \"page_count\": 324}\n{\"name\": \"1984\", \"author\": \"George Orwell\", \"release_date\": \"1985-06-01\", \"page_count\": 328}\n{\"name\": \"Fahrenheit 451\", \"author\": \"Ray Bradbury\", \"release_date\": \"1953-10-15\", \"page_count\": 227}\n{\"name\": \"Brave New World\", \"author\": \"Aldous Huxley\", \"release_date\": \"1932-06-01\", \"page_count\": 268}\n{\"name\": \"Foundation\", \"author\": \"Isaac Asimov\", \"release_date\": \"1951-06-01\", \"page_count\": 224}\n{\"name\": \"The Giver\", \"author\": \"Lois Lowry\", \"release_date\": \"1993-04-26\", \"page_count\": 208}\n{\"name\": \"Slaughterhouse-Five\", \"author\": \"Kurt Vonnegut\", \"release_date\": \"1969-06-01\", \"page_count\": 275}\n{\"name\": \"The Hitchhiker's Guide to the Galaxy\", \"author\": \"Douglas Adams\", \"release_date\": \"1979-10-12\", \"page_count\": 180}\n{\"name\": \"Snow Crash\", \"author\": \"Neal Stephenson\", \"release_date\": \"1992-06-01\", \"page_count\": 470}\n{\"name\": \"Neuromancer\", \"author\": \"William Gibson\", \"release_date\": \"1984-07-01\", \"page_count\": 271}\n{\"name\": \"The Handmaid's Tale\", \"author\": \"Margaret Atwood\", \"release_date\": \"1985-06-01\", \"page_count\": 311}\n{\"name\": \"Starship Troopers\", \"author\": \"Robert A. Heinlein\", \"release_date\": \"1959-12-01\", \"page_count\": 335}\n{\"name\": \"The Left Hand of Darkness\", \"author\": \"Ursula K. Le Guin\", \"release_date\": \"1969-06-01\", \"page_count\": 304}\n{\"name\": \"The Moon is a Harsh Mistress\", \"author\": \"Robert A. Heinlein\", \"release_date\": \"1966-04-01\", \"page_count\": 288}\n----\n// TEST\n\nIf the request does not encounter errors, you receive the following result:\n\n[source,console-result]\n----\n{\n  \"num_lines_analyzed\" : 24, <1>\n  \"num_messages_analyzed\" : 24, <2>\n  \"sample_start\" : \"{\\\"name\\\": \\\"Leviathan Wakes\\\", \\\"author\\\": \\\"James S.A. Corey\\\", \\\"release_date\\\": \\\"2011-06-02\\\", \\\"page_count\\\": 561}\\n{\\\"name\\\": \\\"Hyperion\\\", \\\"author\\\": \\\"Dan Simmons\\\", \\\"release_date\\\": \\\"1989-05-26\\\", \\\"page_count\\\": 482}\\n\", <3>\n  \"charset\" : \"UTF-8\", <4>\n  \"has_byte_order_marker\" : false, <5>\n  \"format\" : \"ndjson\", <6>\n  \"ecs_compatibility\" : \"disabled\", <7>\n  \"timestamp_field\" : \"release_date\", <8>\n  \"joda_timestamp_formats\" : [ <9>\n    \"ISO8601\"\n  ],\n  \"java_timestamp_formats\" : [ <10>\n    \"ISO8601\"\n  ],\n  \"need_client_timezone\" : true, <11>\n  \"mappings\" : { <12>\n    \"properties\" : {\n      \"@timestamp\" : {\n        \"type\" : \"date\"\n      },\n      \"author\" : {\n        \"type\" : \"keyword\"\n      },\n      \"name\" : {\n        \"type\" : \"keyword\"\n      },\n      \"page_count\" : {\n        \"type\" : \"long\"\n      },\n      \"release_date\" : {\n        \"type\" : \"date\",\n        \"format\" : \"iso8601\"\n      }\n    }\n  },\n  \"ingest_pipeline\" : {\n    \"description\" : \"Ingest pipeline created by text structure finder\",\n    \"processors\" : [\n      {\n        \"date\" : {\n          \"field\" : \"release_date\",\n          \"timezone\" : \"{{ event.timezone }}\",\n          \"formats\" : [\n            \"ISO8601\"\n          ]\n        }\n      }\n    ]\n  },\n  \"field_stats\" : { <13>\n    \"author\" : {\n      \"count\" : 24,\n      \"cardinality\" : 20,\n      \"top_hits\" : [\n        {\n          \"value\" : \"Frank Herbert\",\n          \"count\" : 4\n        },\n        {\n          \"value\" : \"Robert A. Heinlein\",\n          \"count\" : 2\n        },\n        {\n          \"value\" : \"Alastair Reynolds\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Aldous Huxley\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Dan Simmons\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Douglas Adams\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"George Orwell\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Iain M. Banks\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Isaac Asimov\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"James S.A. Corey\",\n          \"count\" : 1\n        }\n      ]\n    },\n    \"name\" : {\n      \"count\" : 24,\n      \"cardinality\" : 24,\n      \"top_hits\" : [\n        {\n          \"value\" : \"1984\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"A Fire Upon the Deep\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Brave New World\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Children of Dune\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Consider Phlebas\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Dune\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Dune Messiah\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Ender's Game\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Fahrenheit 451\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"Foundation\",\n          \"count\" : 1\n        }\n      ]\n    },\n    \"page_count\" : {\n      \"count\" : 24,\n      \"cardinality\" : 24,\n      \"min_value\" : 180,\n      \"max_value\" : 768,\n      \"mean_value\" : 387.0833333333333,\n      \"median_value\" : 329.5,\n      \"top_hits\" : [\n        {\n          \"value\" : 180,\n          \"count\" : 1\n        },\n        {\n          \"value\" : 208,\n          \"count\" : 1\n        },\n        {\n          \"value\" : 224,\n          \"count\" : 1\n        },\n        {\n          \"value\" : 227,\n          \"count\" : 1\n        },\n        {\n          \"value\" : 268,\n          \"count\" : 1\n        },\n        {\n          \"value\" : 271,\n          \"count\" : 1\n        },\n        {\n          \"value\" : 275,\n          \"count\" : 1\n        },\n        {\n          \"value\" : 288,\n          \"count\" : 1\n        },\n        {\n          \"value\" : 304,\n          \"count\" : 1\n        },\n        {\n          \"value\" : 311,\n          \"count\" : 1\n        }\n      ]\n    },\n    \"release_date\" : {\n      \"count\" : 24,\n      \"cardinality\" : 20,\n      \"earliest\" : \"1932-06-01\",\n      \"latest\" : \"2011-06-02\",\n      \"top_hits\" : [\n        {\n          \"value\" : \"1985-06-01\",\n          \"count\" : 3\n        },\n        {\n          \"value\" : \"1969-06-01\",\n          \"count\" : 2\n        },\n        {\n          \"value\" : \"1992-06-01\",\n          \"count\" : 2\n        },\n        {\n          \"value\" : \"1932-06-01\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"1951-06-01\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"1953-10-15\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"1959-12-01\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"1965-06-01\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"1966-04-01\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"1969-10-15\",\n          \"count\" : 1\n        }\n      ]\n    }\n  }\n}\n----\n// TESTRESPONSE[s/\"sample_start\" : \".*\",/\"sample_start\" : \"$body.sample_start\",/]\n// The substitution is because the text is pre-processed by the test harness,\n// so the fields may get reordered in the JSON the endpoint sees\n\n<1> `num_lines_analyzed` indicates how many lines of the text were analyzed.\n<2> `num_messages_analyzed` indicates how many distinct messages the lines\ncontained. For NDJSON, this value is the same as `num_lines_analyzed`. For other\ntext formats, messages can span several lines.\n<3> `sample_start` reproduces the first two messages in the text verbatim. This\nmay help diagnose parse errors or accidental uploads of the wrong text.\n<4> `charset` indicates the character encoding used to parse the text.\n<5> For UTF character encodings, `has_byte_order_marker` indicates whether the\ntext begins with a byte order marker.\n<6> `format` is one of `ndjson`, `xml`, `delimited` or `semi_structured_text`.\n<7> `ecs_compatibility` is either `disabled` or `v1`, defaults to `disabled`.\n<8> The `timestamp_field` names the field considered most likely to be the\nprimary timestamp of each document.\n<9> `joda_timestamp_formats` are used to tell {ls} how to parse timestamps.\n<10> `java_timestamp_formats` are the Java time formats recognized in the time\nfields. {es} mappings and ingest pipelines use this format.\n<11> If a timestamp format is detected that does not include a timezone,\n`need_client_timezone` will be `true`. The server that parses the text must\ntherefore be told the correct timezone by the client.\n<12> `mappings` contains some suitable mappings for an index into which the data\ncould be ingested. In this case, the `release_date` field has been given a\n`keyword` type as it is not considered specific enough to convert to the `date`\ntype.\n<13> `field_stats` contains the most common values of each field, plus basic\nnumeric statistics for the numeric `page_count` field. This information may\nprovide clues that the data needs to be cleaned or transformed prior to use by\nother {stack} functionality.\n\n[discrete]\n[[find-structure-example-nyc]]\n=== Finding the structure of NYC yellow cab example data\n\nThe next example shows how it's possible to find the structure of some New York\nCity yellow cab trip data. The first `curl` command downloads the data, the\nfirst 20000 lines of which are then piped into the `find_structure`\nendpoint. The `lines_to_sample` query parameter of the endpoint is set to 20000\nto match what is specified in the `head` command.\n\n[source,js]\n----\ncurl -s \"s3.amazonaws.com/nyc-tlc/trip+data/yellow_tripdata_2018-06.csv\" | head -20000 | curl -s -H \"Content-Type: application/json\" -XPOST \"localhost:9200/_text_structure/find_structure?pretty&lines_to_sample=20000\" -T -\n----\n// NOTCONSOLE\n// Not converting to console because this shows how curl can be used\n\n--\nNOTE: The `Content-Type: application/json` header must be set even though in\nthis case the data is not JSON. (Alternatively the `Content-Type` can be set\nto any other supported by {es}, but it must be set.)\n\n--\n\nIf the request does not encounter errors, you receive the following result:\n\n[source,js]\n----\n{\n  \"num_lines_analyzed\" : 20000,\n  \"num_messages_analyzed\" : 19998, <1>\n  \"sample_start\" : \"VendorID,tpep_pickup_datetime,tpep_dropoff_datetime,passenger_count,trip_distance,RatecodeID,store_and_fwd_flag,PULocationID,DOLocationID,payment_type,fare_amount,extra,mta_tax,tip_amount,tolls_amount,improvement_surcharge,total_amount\\n\\n1,2018-06-01 00:15:40,2018-06-01 00:16:46,1,.00,1,N,145,145,2,3,0.5,0.5,0,0,0.3,4.3\\n\",\n  \"charset\" : \"UTF-8\",\n  \"has_byte_order_marker\" : false,\n  \"format\" : \"delimited\", <2>\n  \"multiline_start_pattern\" : \"^.*?,\\\"?\\\\d{4}-\\\\d{2}-\\\\d{2}[T ]\\\\d{2}:\\\\d{2}\",\n  \"exclude_lines_pattern\" : \"^\\\"?VendorID\\\"?,\\\"?tpep_pickup_datetime\\\"?,\\\"?tpep_dropoff_datetime\\\"?,\\\"?passenger_count\\\"?,\\\"?trip_distance\\\"?,\\\"?RatecodeID\\\"?,\\\"?store_and_fwd_flag\\\"?,\\\"?PULocationID\\\"?,\\\"?DOLocationID\\\"?,\\\"?payment_type\\\"?,\\\"?fare_amount\\\"?,\\\"?extra\\\"?,\\\"?mta_tax\\\"?,\\\"?tip_amount\\\"?,\\\"?tolls_amount\\\"?,\\\"?improvement_surcharge\\\"?,\\\"?total_amount\\\"?\",\n  \"column_names\" : [ <3>\n    \"VendorID\",\n    \"tpep_pickup_datetime\",\n    \"tpep_dropoff_datetime\",\n    \"passenger_count\",\n    \"trip_distance\",\n    \"RatecodeID\",\n    \"store_and_fwd_flag\",\n    \"PULocationID\",\n    \"DOLocationID\",\n    \"payment_type\",\n    \"fare_amount\",\n    \"extra\",\n    \"mta_tax\",\n    \"tip_amount\",\n    \"tolls_amount\",\n    \"improvement_surcharge\",\n    \"total_amount\"\n  ],\n  \"has_header_row\" : true, <4>\n  \"delimiter\" : \",\", <5>\n  \"quote\" : \"\\\"\", <6>\n  \"timestamp_field\" : \"tpep_pickup_datetime\", <7>\n  \"joda_timestamp_formats\" : [ <8>\n    \"YYYY-MM-dd HH:mm:ss\"\n  ],\n  \"java_timestamp_formats\" : [ <9>\n    \"yyyy-MM-dd HH:mm:ss\"\n  ],\n  \"need_client_timezone\" : true, <10>\n  \"mappings\" : {\n    \"properties\" : {\n      \"@timestamp\" : {\n        \"type\" : \"date\"\n      },\n      \"DOLocationID\" : {\n        \"type\" : \"long\"\n      },\n      \"PULocationID\" : {\n        \"type\" : \"long\"\n      },\n      \"RatecodeID\" : {\n        \"type\" : \"long\"\n      },\n      \"VendorID\" : {\n        \"type\" : \"long\"\n      },\n      \"extra\" : {\n        \"type\" : \"double\"\n      },\n      \"fare_amount\" : {\n        \"type\" : \"double\"\n      },\n      \"improvement_surcharge\" : {\n        \"type\" : \"double\"\n      },\n      \"mta_tax\" : {\n        \"type\" : \"double\"\n      },\n      \"passenger_count\" : {\n        \"type\" : \"long\"\n      },\n      \"payment_type\" : {\n        \"type\" : \"long\"\n      },\n      \"store_and_fwd_flag\" : {\n        \"type\" : \"keyword\"\n      },\n      \"tip_amount\" : {\n        \"type\" : \"double\"\n      },\n      \"tolls_amount\" : {\n        \"type\" : \"double\"\n      },\n      \"total_amount\" : {\n        \"type\" : \"double\"\n      },\n      \"tpep_dropoff_datetime\" : {\n        \"type\" : \"date\",\n        \"format\" : \"yyyy-MM-dd HH:mm:ss\"\n      },\n      \"tpep_pickup_datetime\" : {\n        \"type\" : \"date\",\n        \"format\" : \"yyyy-MM-dd HH:mm:ss\"\n      },\n      \"trip_distance\" : {\n        \"type\" : \"double\"\n      }\n    }\n  },\n  \"ingest_pipeline\" : {\n    \"description\" : \"Ingest pipeline created by text structure finder\",\n    \"processors\" : [\n      {\n        \"csv\" : {\n          \"field\" : \"message\",\n          \"target_fields\" : [\n            \"VendorID\",\n            \"tpep_pickup_datetime\",\n            \"tpep_dropoff_datetime\",\n            \"passenger_count\",\n            \"trip_distance\",\n            \"RatecodeID\",\n            \"store_and_fwd_flag\",\n            \"PULocationID\",\n            \"DOLocationID\",\n            \"payment_type\",\n            \"fare_amount\",\n            \"extra\",\n            \"mta_tax\",\n            \"tip_amount\",\n            \"tolls_amount\",\n            \"improvement_surcharge\",\n            \"total_amount\"\n          ]\n        }\n      },\n      {\n        \"date\" : {\n          \"field\" : \"tpep_pickup_datetime\",\n          \"timezone\" : \"{{ event.timezone }}\",\n          \"formats\" : [\n            \"yyyy-MM-dd HH:mm:ss\"\n          ]\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"DOLocationID\",\n          \"type\" : \"long\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"PULocationID\",\n          \"type\" : \"long\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"RatecodeID\",\n          \"type\" : \"long\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"VendorID\",\n          \"type\" : \"long\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"extra\",\n          \"type\" : \"double\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"fare_amount\",\n          \"type\" : \"double\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"improvement_surcharge\",\n          \"type\" : \"double\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"mta_tax\",\n          \"type\" : \"double\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"passenger_count\",\n          \"type\" : \"long\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"payment_type\",\n          \"type\" : \"long\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"tip_amount\",\n          \"type\" : \"double\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"tolls_amount\",\n          \"type\" : \"double\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"total_amount\",\n          \"type\" : \"double\"\n        }\n      },\n      {\n        \"convert\" : {\n          \"field\" : \"trip_distance\",\n          \"type\" : \"double\"\n        }\n      },\n      {\n        \"remove\" : {\n          \"field\" : \"message\"\n        }\n      }\n    ]\n  },\n  \"field_stats\" : {\n    \"DOLocationID\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 240,\n      \"min_value\" : 1,\n      \"max_value\" : 265,\n      \"mean_value\" : 150.26532653265312,\n      \"median_value\" : 148,\n      \"top_hits\" : [\n        {\n          \"value\" : 79,\n          \"count\" : 760\n        },\n        {\n          \"value\" : 48,\n          \"count\" : 683\n        },\n        {\n          \"value\" : 68,\n          \"count\" : 529\n        },\n        {\n          \"value\" : 170,\n          \"count\" : 506\n        },\n        {\n          \"value\" : 107,\n          \"count\" : 468\n        },\n        {\n          \"value\" : 249,\n          \"count\" : 457\n        },\n        {\n          \"value\" : 230,\n          \"count\" : 441\n        },\n        {\n          \"value\" : 186,\n          \"count\" : 432\n        },\n        {\n          \"value\" : 141,\n          \"count\" : 409\n        },\n        {\n          \"value\" : 263,\n          \"count\" : 386\n        }\n      ]\n    },\n    \"PULocationID\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 154,\n      \"min_value\" : 1,\n      \"max_value\" : 265,\n      \"mean_value\" : 153.4042404240424,\n      \"median_value\" : 148,\n      \"top_hits\" : [\n        {\n          \"value\" : 79,\n          \"count\" : 1067\n        },\n        {\n          \"value\" : 230,\n          \"count\" : 949\n        },\n        {\n          \"value\" : 148,\n          \"count\" : 940\n        },\n        {\n          \"value\" : 132,\n          \"count\" : 897\n        },\n        {\n          \"value\" : 48,\n          \"count\" : 853\n        },\n        {\n          \"value\" : 161,\n          \"count\" : 820\n        },\n        {\n          \"value\" : 234,\n          \"count\" : 750\n        },\n        {\n          \"value\" : 249,\n          \"count\" : 722\n        },\n        {\n          \"value\" : 164,\n          \"count\" : 663\n        },\n        {\n          \"value\" : 114,\n          \"count\" : 646\n        }\n      ]\n    },\n    \"RatecodeID\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 5,\n      \"min_value\" : 1,\n      \"max_value\" : 5,\n      \"mean_value\" : 1.0656565656565653,\n      \"median_value\" : 1,\n      \"top_hits\" : [\n        {\n          \"value\" : 1,\n          \"count\" : 19311\n        },\n        {\n          \"value\" : 2,\n          \"count\" : 468\n        },\n        {\n          \"value\" : 5,\n          \"count\" : 195\n        },\n        {\n          \"value\" : 4,\n          \"count\" : 17\n        },\n        {\n          \"value\" : 3,\n          \"count\" : 7\n        }\n      ]\n    },\n    \"VendorID\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 2,\n      \"min_value\" : 1,\n      \"max_value\" : 2,\n      \"mean_value\" : 1.59005900590059,\n      \"median_value\" : 2,\n      \"top_hits\" : [\n        {\n          \"value\" : 2,\n          \"count\" : 11800\n        },\n        {\n          \"value\" : 1,\n          \"count\" : 8198\n        }\n      ]\n    },\n    \"extra\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 3,\n      \"min_value\" : -0.5,\n      \"max_value\" : 0.5,\n      \"mean_value\" : 0.4815981598159816,\n      \"median_value\" : 0.5,\n      \"top_hits\" : [\n        {\n          \"value\" : 0.5,\n          \"count\" : 19281\n        },\n        {\n          \"value\" : 0,\n          \"count\" : 698\n        },\n        {\n          \"value\" : -0.5,\n          \"count\" : 19\n        }\n      ]\n    },\n    \"fare_amount\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 208,\n      \"min_value\" : -100,\n      \"max_value\" : 300,\n      \"mean_value\" : 13.937719771977209,\n      \"median_value\" : 9.5,\n      \"top_hits\" : [\n        {\n          \"value\" : 6,\n          \"count\" : 1004\n        },\n        {\n          \"value\" : 6.5,\n          \"count\" : 935\n        },\n        {\n          \"value\" : 5.5,\n          \"count\" : 909\n        },\n        {\n          \"value\" : 7,\n          \"count\" : 903\n        },\n        {\n          \"value\" : 5,\n          \"count\" : 889\n        },\n        {\n          \"value\" : 7.5,\n          \"count\" : 854\n        },\n        {\n          \"value\" : 4.5,\n          \"count\" : 802\n        },\n        {\n          \"value\" : 8.5,\n          \"count\" : 790\n        },\n        {\n          \"value\" : 8,\n          \"count\" : 789\n        },\n        {\n          \"value\" : 9,\n          \"count\" : 711\n        }\n      ]\n    },\n    \"improvement_surcharge\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 3,\n      \"min_value\" : -0.3,\n      \"max_value\" : 0.3,\n      \"mean_value\" : 0.29915991599159913,\n      \"median_value\" : 0.3,\n      \"top_hits\" : [\n        {\n          \"value\" : 0.3,\n          \"count\" : 19964\n        },\n        {\n          \"value\" : -0.3,\n          \"count\" : 22\n        },\n        {\n          \"value\" : 0,\n          \"count\" : 12\n        }\n      ]\n    },\n    \"mta_tax\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 3,\n      \"min_value\" : -0.5,\n      \"max_value\" : 0.5,\n      \"mean_value\" : 0.4962246224622462,\n      \"median_value\" : 0.5,\n      \"top_hits\" : [\n        {\n          \"value\" : 0.5,\n          \"count\" : 19868\n        },\n        {\n          \"value\" : 0,\n          \"count\" : 109\n        },\n        {\n          \"value\" : -0.5,\n          \"count\" : 21\n        }\n      ]\n    },\n    \"passenger_count\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 7,\n      \"min_value\" : 0,\n      \"max_value\" : 6,\n      \"mean_value\" : 1.6201620162016201,\n      \"median_value\" : 1,\n      \"top_hits\" : [\n        {\n          \"value\" : 1,\n          \"count\" : 14219\n        },\n        {\n          \"value\" : 2,\n          \"count\" : 2886\n        },\n        {\n          \"value\" : 5,\n          \"count\" : 1047\n        },\n        {\n          \"value\" : 3,\n          \"count\" : 804\n        },\n        {\n          \"value\" : 6,\n          \"count\" : 523\n        },\n        {\n          \"value\" : 4,\n          \"count\" : 406\n        },\n        {\n          \"value\" : 0,\n          \"count\" : 113\n        }\n      ]\n    },\n    \"payment_type\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 4,\n      \"min_value\" : 1,\n      \"max_value\" : 4,\n      \"mean_value\" : 1.315631563156316,\n      \"median_value\" : 1,\n      \"top_hits\" : [\n        {\n          \"value\" : 1,\n          \"count\" : 13936\n        },\n        {\n          \"value\" : 2,\n          \"count\" : 5857\n        },\n        {\n          \"value\" : 3,\n          \"count\" : 160\n        },\n        {\n          \"value\" : 4,\n          \"count\" : 45\n        }\n      ]\n    },\n    \"store_and_fwd_flag\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 2,\n      \"top_hits\" : [\n        {\n          \"value\" : \"N\",\n          \"count\" : 19910\n        },\n        {\n          \"value\" : \"Y\",\n          \"count\" : 88\n        }\n      ]\n    },\n    \"tip_amount\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 717,\n      \"min_value\" : 0,\n      \"max_value\" : 128,\n      \"mean_value\" : 2.010959095909593,\n      \"median_value\" : 1.45,\n      \"top_hits\" : [\n        {\n          \"value\" : 0,\n          \"count\" : 6917\n        },\n        {\n          \"value\" : 1,\n          \"count\" : 1178\n        },\n        {\n          \"value\" : 2,\n          \"count\" : 624\n        },\n        {\n          \"value\" : 3,\n          \"count\" : 248\n        },\n        {\n          \"value\" : 1.56,\n          \"count\" : 206\n        },\n        {\n          \"value\" : 1.46,\n          \"count\" : 205\n        },\n        {\n          \"value\" : 1.76,\n          \"count\" : 196\n        },\n        {\n          \"value\" : 1.45,\n          \"count\" : 195\n        },\n        {\n          \"value\" : 1.36,\n          \"count\" : 191\n        },\n        {\n          \"value\" : 1.5,\n          \"count\" : 187\n        }\n      ]\n    },\n    \"tolls_amount\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 26,\n      \"min_value\" : 0,\n      \"max_value\" : 35,\n      \"mean_value\" : 0.2729697969796978,\n      \"median_value\" : 0,\n      \"top_hits\" : [\n        {\n          \"value\" : 0,\n          \"count\" : 19107\n        },\n        {\n          \"value\" : 5.76,\n          \"count\" : 791\n        },\n        {\n          \"value\" : 10.5,\n          \"count\" : 36\n        },\n        {\n          \"value\" : 2.64,\n          \"count\" : 21\n        },\n        {\n          \"value\" : 11.52,\n          \"count\" : 8\n        },\n        {\n          \"value\" : 5.54,\n          \"count\" : 4\n        },\n        {\n          \"value\" : 8.5,\n          \"count\" : 4\n        },\n        {\n          \"value\" : 17.28,\n          \"count\" : 4\n        },\n        {\n          \"value\" : 2,\n          \"count\" : 2\n        },\n        {\n          \"value\" : 2.16,\n          \"count\" : 2\n        }\n      ]\n    },\n    \"total_amount\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 1267,\n      \"min_value\" : -100.3,\n      \"max_value\" : 389.12,\n      \"mean_value\" : 17.499898989898995,\n      \"median_value\" : 12.35,\n      \"top_hits\" : [\n        {\n          \"value\" : 7.3,\n          \"count\" : 478\n        },\n        {\n          \"value\" : 8.3,\n          \"count\" : 443\n        },\n        {\n          \"value\" : 8.8,\n          \"count\" : 420\n        },\n        {\n          \"value\" : 6.8,\n          \"count\" : 406\n        },\n        {\n          \"value\" : 7.8,\n          \"count\" : 405\n        },\n        {\n          \"value\" : 6.3,\n          \"count\" : 371\n        },\n        {\n          \"value\" : 9.8,\n          \"count\" : 368\n        },\n        {\n          \"value\" : 5.8,\n          \"count\" : 362\n        },\n        {\n          \"value\" : 9.3,\n          \"count\" : 332\n        },\n        {\n          \"value\" : 10.3,\n          \"count\" : 332\n        }\n      ]\n    },\n    \"tpep_dropoff_datetime\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 9066,\n      \"earliest\" : \"2018-05-31 06:18:15\",\n      \"latest\" : \"2018-06-02 02:25:44\",\n      \"top_hits\" : [\n        {\n          \"value\" : \"2018-06-01 01:12:12\",\n          \"count\" : 10\n        },\n        {\n          \"value\" : \"2018-06-01 00:32:15\",\n          \"count\" : 9\n        },\n        {\n          \"value\" : \"2018-06-01 00:44:27\",\n          \"count\" : 9\n        },\n        {\n          \"value\" : \"2018-06-01 00:46:42\",\n          \"count\" : 9\n        },\n        {\n          \"value\" : \"2018-06-01 01:03:22\",\n          \"count\" : 9\n        },\n        {\n          \"value\" : \"2018-06-01 01:05:13\",\n          \"count\" : 9\n        },\n        {\n          \"value\" : \"2018-06-01 00:11:20\",\n          \"count\" : 8\n        },\n        {\n          \"value\" : \"2018-06-01 00:16:03\",\n          \"count\" : 8\n        },\n        {\n          \"value\" : \"2018-06-01 00:19:47\",\n          \"count\" : 8\n        },\n        {\n          \"value\" : \"2018-06-01 00:25:17\",\n          \"count\" : 8\n        }\n      ]\n    },\n    \"tpep_pickup_datetime\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 8760,\n      \"earliest\" : \"2018-05-31 06:08:31\",\n      \"latest\" : \"2018-06-02 01:21:21\",\n      \"top_hits\" : [\n        {\n          \"value\" : \"2018-06-01 00:01:23\",\n          \"count\" : 12\n        },\n        {\n          \"value\" : \"2018-06-01 00:04:31\",\n          \"count\" : 10\n        },\n        {\n          \"value\" : \"2018-06-01 00:05:38\",\n          \"count\" : 10\n        },\n        {\n          \"value\" : \"2018-06-01 00:09:50\",\n          \"count\" : 10\n        },\n        {\n          \"value\" : \"2018-06-01 00:12:01\",\n          \"count\" : 10\n        },\n        {\n          \"value\" : \"2018-06-01 00:14:17\",\n          \"count\" : 10\n        },\n        {\n          \"value\" : \"2018-06-01 00:00:34\",\n          \"count\" : 9\n        },\n        {\n          \"value\" : \"2018-06-01 00:00:40\",\n          \"count\" : 9\n        },\n        {\n          \"value\" : \"2018-06-01 00:02:53\",\n          \"count\" : 9\n        },\n        {\n          \"value\" : \"2018-06-01 00:05:40\",\n          \"count\" : 9\n        }\n      ]\n    },\n    \"trip_distance\" : {\n      \"count\" : 19998,\n      \"cardinality\" : 1687,\n      \"min_value\" : 0,\n      \"max_value\" : 64.63,\n      \"mean_value\" : 3.6521062106210715,\n      \"median_value\" : 2.16,\n      \"top_hits\" : [\n        {\n          \"value\" : 0.9,\n          \"count\" : 335\n        },\n        {\n          \"value\" : 0.8,\n          \"count\" : 320\n        },\n        {\n          \"value\" : 1.1,\n          \"count\" : 316\n        },\n        {\n          \"value\" : 0.7,\n          \"count\" : 304\n        },\n        {\n          \"value\" : 1.2,\n          \"count\" : 303\n        },\n        {\n          \"value\" : 1,\n          \"count\" : 296\n        },\n        {\n          \"value\" : 1.3,\n          \"count\" : 280\n        },\n        {\n          \"value\" : 1.5,\n          \"count\" : 268\n        },\n        {\n          \"value\" : 1.6,\n          \"count\" : 268\n        },\n        {\n          \"value\" : 0.6,\n          \"count\" : 256\n        }\n      ]\n    }\n  }\n}\n----\n// NOTCONSOLE\n\n<1> `num_messages_analyzed` is 2 lower than `num_lines_analyzed` because only\ndata records count as messages. The first line contains the column names and in\nthis sample the second line is blank.\n<2> Unlike the first example, in this case the `format` has been identified as\n`delimited`.\n<3> Because the `format` is `delimited`, the `column_names` field in the output\nlists the column names in the order they appear in the sample.\n<4> `has_header_row` indicates that for this sample the column names were in\nthe first row of the sample. (If they hadn't been then it would have been a good\nidea to specify them in the `column_names` query parameter.)\n<5> The `delimiter` for this sample is a comma, as it's CSV formatted text.\n<6> The `quote` character is the default double quote. (The structure finder\ndoes not attempt to deduce any other quote character, so if you have delimited\ntext that's quoted with some other character you must specify it using the\n`quote` query parameter.)\n<7> The `timestamp_field` has been chosen to be `tpep_pickup_datetime`.\n`tpep_dropoff_datetime` would work just as well, but `tpep_pickup_datetime` was\nchosen because it comes first in the column order. If you prefer\n`tpep_dropoff_datetime` then force it to be chosen using the\n`timestamp_field` query parameter.\n<8> `joda_timestamp_formats` are used to tell {ls} how to parse timestamps.\n<9> `java_timestamp_formats` are the Java time formats recognized in the time\nfields. {es} mappings and ingest pipelines use this format.\n<10> The timestamp format in this sample doesn't specify a timezone, so to\naccurately convert them to UTC timestamps to store in {es} it's necessary to\nsupply the timezone they relate to. `need_client_timezone` will be `false` for\ntimestamp formats that include the timezone.\n\n[discrete]\n[[find-structure-example-timeout]]\n=== Setting the timeout parameter\n\nIf you try to analyze a lot of data then the analysis will take a long time. If\nyou want to limit the amount of processing your {es} cluster performs for a\nrequest, use the `timeout` query parameter. The analysis will be aborted and an\nerror returned when the timeout expires. For example, you can replace 20000\nlines in the previous example with 200000 and set a 1 second timeout on the\nanalysis:\n\n[source,js]\n----\ncurl -s \"s3.amazonaws.com/nyc-tlc/trip+data/yellow_tripdata_2018-06.csv\" | head -200000 | curl -s -H \"Content-Type: application/json\" -XPOST \"localhost:9200/_text_structure/find_structure?pretty&lines_to_sample=200000&timeout=1s\" -T -\n----\n// NOTCONSOLE\n// Not converting to console because this shows how curl can be used\n\nUnless you are using an incredibly fast computer you'll receive a timeout error:\n\n[source,js]\n----\n{\n  \"error\" : {\n    \"root_cause\" : [\n      {\n        \"type\" : \"timeout_exception\",\n        \"reason\" : \"Aborting structure analysis during [delimited record parsing] as it has taken longer than the timeout of [1s]\"\n      }\n    ],\n    \"type\" : \"timeout_exception\",\n    \"reason\" : \"Aborting structure analysis during [delimited record parsing] as it has taken longer than the timeout of [1s]\"\n  },\n  \"status\" : 500\n}\n----\n// NOTCONSOLE\n\n--\nNOTE: If you try the example above yourself you will note that the overall\nrunning time of the `curl` commands is considerably longer than 1 second. This\nis because it takes a while to download 200000 lines of CSV from the internet,\nand the timeout is measured from the time this endpoint starts to process the\ndata.\n\n--\n\n[discrete]\n[[find-structure-example-eslog]]\n=== Analyzing {es} log files\n\nThis is an example of analyzing an {es} log file:\n\n[source,js]\n----\ncurl -s -H \"Content-Type: application/json\" -XPOST\n\"localhost:9200/_text_structure/find_structure?pretty&ecs_compatibility=disabled\" -T \"$ES_HOME/logs/elasticsearch.log\"\n----\n// NOTCONSOLE\n// Not converting to console because this shows how curl can be used\n\nIf the request does not encounter errors, the result will look something like\nthis:\n\n[source,js]\n----\n{\n  \"num_lines_analyzed\" : 53,\n  \"num_messages_analyzed\" : 53,\n  \"sample_start\" : \"[2018-09-27T14:39:28,518][INFO ][o.e.e.NodeEnvironment    ] [node-0] using [1] data paths, mounts [[/ (/dev/disk1)]], net usable_space [165.4gb], net total_space [464.7gb], types [hfs]\\n[2018-09-27T14:39:28,521][INFO ][o.e.e.NodeEnvironment    ] [node-0] heap size [494.9mb], compressed ordinary object pointers [true]\\n\",\n  \"charset\" : \"UTF-8\",\n  \"has_byte_order_marker\" : false,\n  \"format\" : \"semi_structured_text\", <1>\n  \"multiline_start_pattern\" : \"^\\\\[\\\\b\\\\d{4}-\\\\d{2}-\\\\d{2}[T ]\\\\d{2}:\\\\d{2}\", <2>\n  \"grok_pattern\" : \"\\\\[%{TIMESTAMP_ISO8601:timestamp}\\\\]\\\\[%{LOGLEVEL:loglevel}.*\", <3>\n  \"ecs_compatibility\" : \"disabled\", <4>\n  \"timestamp_field\" : \"timestamp\",\n  \"joda_timestamp_formats\" : [\n    \"ISO8601\"\n  ],\n  \"java_timestamp_formats\" : [\n    \"ISO8601\"\n  ],\n  \"need_client_timezone\" : true,\n  \"mappings\" : {\n    \"properties\" : {\n      \"@timestamp\" : {\n        \"type\" : \"date\"\n      },\n      \"loglevel\" : {\n        \"type\" : \"keyword\"\n      },\n      \"message\" : {\n        \"type\" : \"text\"\n      }\n    }\n  },\n  \"ingest_pipeline\" : {\n    \"description\" : \"Ingest pipeline created by text structure finder\",\n    \"processors\" : [\n      {\n        \"grok\" : {\n          \"field\" : \"message\",\n          \"patterns\" : [\n            \"\\\\[%{TIMESTAMP_ISO8601:timestamp}\\\\]\\\\[%{LOGLEVEL:loglevel}.*\"\n          ]\n        }\n      },\n      {\n        \"date\" : {\n          \"field\" : \"timestamp\",\n          \"timezone\" : \"{{ event.timezone }}\",\n          \"formats\" : [\n            \"ISO8601\"\n          ]\n        }\n      },\n      {\n        \"remove\" : {\n          \"field\" : \"timestamp\"\n        }\n      }\n    ]\n  },\n  \"field_stats\" : {\n    \"loglevel\" : {\n      \"count\" : 53,\n      \"cardinality\" : 3,\n      \"top_hits\" : [\n        {\n          \"value\" : \"INFO\",\n          \"count\" : 51\n        },\n        {\n          \"value\" : \"DEBUG\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"WARN\",\n          \"count\" : 1\n        }\n      ]\n    },\n    \"timestamp\" : {\n      \"count\" : 53,\n      \"cardinality\" : 28,\n      \"earliest\" : \"2018-09-27T14:39:28,518\",\n      \"latest\" : \"2018-09-27T14:39:37,012\",\n      \"top_hits\" : [\n        {\n          \"value\" : \"2018-09-27T14:39:29,859\",\n          \"count\" : 10\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:29,860\",\n          \"count\" : 9\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:29,858\",\n          \"count\" : 6\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:28,523\",\n          \"count\" : 3\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:34,234\",\n          \"count\" : 2\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:28,518\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:28,521\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:28,522\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:29,861\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:32,786\",\n          \"count\" : 1\n        }\n      ]\n    }\n  }\n}\n----\n// NOTCONSOLE\n\n<1> This time the `format` has been identified as `semi_structured_text`.\n<2> The `multiline_start_pattern` is set on the basis that the timestamp appears\nin the first line of each multi-line log message.\n<3> A very simple `grok_pattern` has been created, which extracts the timestamp\nand recognizable fields that appear in every analyzed message. In this case the\nonly field that was recognized beyond the timestamp was the log level.\n<4> The ECS Grok pattern compatibility mode used, may be one of either `disabled`\n(the default if not specified in the request) or `v1`\n\n[discrete]\n[[find-structure-example-grok]]\n=== Specifying `grok_pattern` as query parameter\n\nIf you recognize more fields than the simple `grok_pattern` produced by the\nstructure finder unaided then you can resubmit the request specifying a more\nadvanced `grok_pattern` as a query parameter and the structure finder will\ncalculate `field_stats` for your additional fields.\n\nIn the case of the {es} log a more complete Grok pattern is\n`\\[%{TIMESTAMP_ISO8601:timestamp}\\]\\[%{LOGLEVEL:loglevel} *\\]\\[%{JAVACLASS:class} *\\] \\[%{HOSTNAME:node}\\] %{JAVALOGMESSAGE:message}`.\nYou can analyze the same text again, submitting this `grok_pattern` as a\nquery parameter (appropriately URL escaped):\n\n[source,js]\n----\ncurl -s -H \"Content-Type: application/json\" -XPOST \"localhost:9200/_text_structure/find_structure?pretty&format=semi_structured_text&grok_pattern=%5C%5B%25%7BTIMESTAMP_ISO8601:timestamp%7D%5C%5D%5C%5B%25%7BLOGLEVEL:loglevel%7D%20*%5C%5D%5C%5B%25%7BJAVACLASS:class%7D%20*%5C%5D%20%5C%5B%25%7BHOSTNAME:node%7D%5C%5D%20%25%7BJAVALOGMESSAGE:message%7D\" -T \"$ES_HOME/logs/elasticsearch.log\"\n----\n// NOTCONSOLE\n// Not converting to console because this shows how curl can be used\n\nIf the request does not encounter errors, the result will look something like\nthis:\n\n[source,js]\n----\n{\n  \"num_lines_analyzed\" : 53,\n  \"num_messages_analyzed\" : 53,\n  \"sample_start\" : \"[2018-09-27T14:39:28,518][INFO ][o.e.e.NodeEnvironment    ] [node-0] using [1] data paths, mounts [[/ (/dev/disk1)]], net usable_space [165.4gb], net total_space [464.7gb], types [hfs]\\n[2018-09-27T14:39:28,521][INFO ][o.e.e.NodeEnvironment    ] [node-0] heap size [494.9mb], compressed ordinary object pointers [true]\\n\",\n  \"charset\" : \"UTF-8\",\n  \"has_byte_order_marker\" : false,\n  \"format\" : \"semi_structured_text\",\n  \"multiline_start_pattern\" : \"^\\\\[\\\\b\\\\d{4}-\\\\d{2}-\\\\d{2}[T ]\\\\d{2}:\\\\d{2}\",\n  \"grok_pattern\" : \"\\\\[%{TIMESTAMP_ISO8601:timestamp}\\\\]\\\\[%{LOGLEVEL:loglevel} *\\\\]\\\\[%{JAVACLASS:class} *\\\\] \\\\[%{HOSTNAME:node}\\\\] %{JAVALOGMESSAGE:message}\", <1>\n  \"ecs_compatibility\" : \"disabled\", <2>\n  \"timestamp_field\" : \"timestamp\",\n  \"joda_timestamp_formats\" : [\n    \"ISO8601\"\n  ],\n  \"java_timestamp_formats\" : [\n    \"ISO8601\"\n  ],\n  \"need_client_timezone\" : true,\n  \"mappings\" : {\n    \"properties\" : {\n      \"@timestamp\" : {\n        \"type\" : \"date\"\n      },\n      \"class\" : {\n        \"type\" : \"keyword\"\n      },\n      \"loglevel\" : {\n        \"type\" : \"keyword\"\n      },\n      \"message\" : {\n        \"type\" : \"text\"\n      },\n      \"node\" : {\n        \"type\" : \"keyword\"\n      }\n    }\n  },\n  \"ingest_pipeline\" : {\n    \"description\" : \"Ingest pipeline created by text structure finder\",\n    \"processors\" : [\n      {\n        \"grok\" : {\n          \"field\" : \"message\",\n          \"patterns\" : [\n            \"\\\\[%{TIMESTAMP_ISO8601:timestamp}\\\\]\\\\[%{LOGLEVEL:loglevel} *\\\\]\\\\[%{JAVACLASS:class} *\\\\] \\\\[%{HOSTNAME:node}\\\\] %{JAVALOGMESSAGE:message}\"\n          ]\n        }\n      },\n      {\n        \"date\" : {\n          \"field\" : \"timestamp\",\n          \"timezone\" : \"{{ event.timezone }}\",\n          \"formats\" : [\n            \"ISO8601\"\n          ]\n        }\n      },\n      {\n        \"remove\" : {\n          \"field\" : \"timestamp\"\n        }\n      }\n    ]\n  },\n  \"field_stats\" : { <3>\n    \"class\" : {\n      \"count\" : 53,\n      \"cardinality\" : 14,\n      \"top_hits\" : [\n        {\n          \"value\" : \"o.e.p.PluginsService\",\n          \"count\" : 26\n        },\n        {\n          \"value\" : \"o.e.c.m.MetadataIndexTemplateService\",\n          \"count\" : 8\n        },\n        {\n          \"value\" : \"o.e.n.Node\",\n          \"count\" : 7\n        },\n        {\n          \"value\" : \"o.e.e.NodeEnvironment\",\n          \"count\" : 2\n        },\n        {\n          \"value\" : \"o.e.a.ActionModule\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"o.e.c.s.ClusterApplierService\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"o.e.c.s.MasterService\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"o.e.d.DiscoveryModule\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"o.e.g.GatewayService\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"o.e.l.LicenseService\",\n          \"count\" : 1\n        }\n      ]\n    },\n    \"loglevel\" : {\n      \"count\" : 53,\n      \"cardinality\" : 3,\n      \"top_hits\" : [\n        {\n          \"value\" : \"INFO\",\n          \"count\" : 51\n        },\n        {\n          \"value\" : \"DEBUG\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"WARN\",\n          \"count\" : 1\n        }\n      ]\n    },\n    \"message\" : {\n      \"count\" : 53,\n      \"cardinality\" : 53,\n      \"top_hits\" : [\n        {\n          \"value\" : \"Using REST wrapper from plugin org.elasticsearch.xpack.security.Security\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"adding template [.monitoring-alerts] for index patterns [.monitoring-alerts-6]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"adding template [.monitoring-beats] for index patterns [.monitoring-beats-6-*]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"adding template [.monitoring-es] for index patterns [.monitoring-es-6-*]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"adding template [.monitoring-kibana] for index patterns [.monitoring-kibana-6-*]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"adding template [.monitoring-logstash] for index patterns [.monitoring-logstash-6-*]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"adding template [.triggered_watches] for index patterns [.triggered_watches*]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"adding template [.watch-history-9] for index patterns [.watcher-history-9*]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"adding template [.watches] for index patterns [.watches*]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"starting ...\",\n          \"count\" : 1\n        }\n      ]\n    },\n    \"node\" : {\n      \"count\" : 53,\n      \"cardinality\" : 1,\n      \"top_hits\" : [\n        {\n          \"value\" : \"node-0\",\n          \"count\" : 53\n        }\n      ]\n    },\n    \"timestamp\" : {\n      \"count\" : 53,\n      \"cardinality\" : 28,\n      \"earliest\" : \"2018-09-27T14:39:28,518\",\n      \"latest\" : \"2018-09-27T14:39:37,012\",\n      \"top_hits\" : [\n        {\n          \"value\" : \"2018-09-27T14:39:29,859\",\n          \"count\" : 10\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:29,860\",\n          \"count\" : 9\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:29,858\",\n          \"count\" : 6\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:28,523\",\n          \"count\" : 3\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:34,234\",\n          \"count\" : 2\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:28,518\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:28,521\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:28,522\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:29,861\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2018-09-27T14:39:32,786\",\n          \"count\" : 1\n        }\n      ]\n    }\n  }\n}\n----\n// NOTCONSOLE\n\n<1> The `grok_pattern` in the output is now the overridden one supplied in the\nquery parameter.\n<2> The ECS Grok pattern compatibility mode used, may be one of either `disabled`\n(the default if not specified in the request) or `v1`\n<3> The returned `field_stats` include entries for the fields from the\noverridden `grok_pattern`.\n\nThe URL escaping is hard, so if you are working interactively it is best to use\nthe UI!\n"
}