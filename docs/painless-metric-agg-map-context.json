{
    "meta": {
        "timestamp": "2024-11-01T03:02:53.117579",
        "size": 1732,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/painless-metric-agg-map-context.html",
        "type": "documentation",
        "role": [],
        "has_code": false,
        "title": "painless-metric-agg-map-context",
        "version": "8.15"
    },
    "doc": "[[painless-metric-agg-map-context]]\n=== Metric aggregation map context\n\nUse a Painless script to\n{ref}/search-aggregations-metrics-scripted-metric-aggregation.html[map]\nvalues for use in a scripted metric aggregation. A map script is run once per\ncollected document following an optional\n<<painless-metric-agg-init-context, initialization script>> and is required as\npart of a full metric aggregation.\n\n*Variables*\n\n`params` (`Map`, read-only)::\n        User-defined parameters passed in as part of the query.\n\n`state` (`Map`)::\n        `Map` used to add values for processing in a\n        <<painless-metric-agg-map-context, combine script>> or to be returned from the aggregation.\n\n`doc` (`Map`, read-only)::\n        Contains the fields of the current document where each field is a\n        `List` of values.\n\n`_score` (`double` read-only)::\n        The similarity score of the current document.\n\n*Side Effects*\n\n`state` (`Map`)::\n        Use this `Map` to add values for processing in a combine script.\n        Additional values must be of the type `Map`, `List`, `String` or\n        primitive. The same `state` `Map` is shared between all aggregated documents\n        on a given shard. If an initialization script is provided as part of the\n        aggregation then values added from the initialization script are\n        available. If no combine script is specified, values must be\n        directly stored in `state` in a usable form. If no combine script and no\n        <<painless-metric-agg-reduce-context, reduce script>> are specified, the\n        `state` values are used as the result.\n\n*Return*\n\n`void`::\n        No expected return value.\n\n*API*\n\nThe standard <<painless-api-reference-shared, Painless API>> is available.\n"
}