{
    "meta": {
        "timestamp": "2024-11-01T03:07:09.200271",
        "size": 2932,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/executable-jna-tmpdir.html",
        "type": "documentation",
        "role": [],
        "has_code": false,
        "title": "executable-jna-tmpdir",
        "version": "8.15"
    },
    "doc": "[[executable-jna-tmpdir]]\n=== Ensure JNA temporary directory permits executables\n\n[NOTE]\nThis is only relevant for Linux.\n\n{es} uses the Java Native Access (JNA) library, and another library called\n`libffi`, for executing some platform-dependent native code. On Linux, the\nnative code backing these libraries is extracted at runtime into a temporary\ndirectory and then mapped into executable pages in {es}'s address space. This\nrequires the underlying files not to be on a filesystem mounted with the\n`noexec` option.\n\nBy default, {es} will create its temporary directory within `/tmp`. However,\nsome hardened Linux installations mount `/tmp` with the `noexec` option by\ndefault. This prevents JNA and `libffi` from working correctly. For instance,\nat startup JNA may fail to load with an `java.lang.UnsatisfiedLinkerError`\nexception or with a message that says something similar to\n`failed to map segment from shared object`, or `libffi` may report a message\nsuch as `failed to allocate closure`. Note that the exception messages can\ndiffer between JVM versions. Additionally, the components of {es} that rely on\nexecution of native code via JNA may fail with messages indicating that it is\n`because JNA is not available`.\n\nTo resolve these problems, either remove the `noexec` option from your `/tmp`\nfilesystem, or configure {es} to use a different location for its temporary\ndirectory by setting the <<es-tmpdir,`$ES_TMPDIR`>> environment variable. For\ninstance:\n\n* If you are running {es} directly from a shell, set `$ES_TMPDIR` as follows:\n+\n[\"source\",\"sh\",subs=\"attributes\"]\n--------------------------------------------\nexport ES_TMPDIR=/usr/share/elasticsearch/tmp\n--------------------------------------------\n\n* For installs done through RPM or DEB packages, the environment variable needs\nto be set through the <<sysconfig,system configuration file>>.\n\n* If you are using `systemd` to run {es} as a service, add the following\nline to the `[Service]` section in a <<systemd,service override file>>:\n+\n[source,text]\n--------------------------------------------\nEnvironment=ES_TMPDIR=/usr/share/elasticsearch/tmp\n--------------------------------------------\n\nIf you need finer control over the location of these temporary files, you can\nalso configure the path that JNA uses with the <<set-jvm-options,JVM flag>>\n`-Djna.tmpdir=<path>` and you can configure the path that `libffi` uses for its\ntemporary files by setting the `LIBFFI_TMPDIR` environment variable. Future\nversions of {es} may need additional configuration, so you should prefer to set\n`ES_TMPDIR` wherever possible.\n\nNOTE: {es} does not remove its temporary directory. You should remove leftover\ntemporary directories while {es} is not running. It is best to do this\nautomatically, for instance on each reboot. If you are running on Linux, you\ncan achieve this by using the\nlink:https://www.kernel.org/doc/html/latest/filesystems/tmpfs.html[tmpfs] file\nsystem.\n"
}