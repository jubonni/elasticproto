{
    "meta": {
        "size": 3115,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/painless-field-context.html",
        "type": "documentation",
        "role": [],
        "has_code": false,
        "title": "painless-field-context",
        "version": "8.15"
    },
    "doc": "[[painless-field-context]]\n=== Field context\n\nUse a Painless script to create a\n{ref}/search-fields.html#script-fields[script field] to return\na customized value for each document in the results of a query.\n\n*Variables*\n\n`params` (`Map`, read-only)::\n        User-defined parameters passed in as part of the query.\n\n`doc` (`Map`, read-only)::\n        Contains the fields of the specified document where each field is a\n        `List` of values.\n\n{ref}/mapping-source-field.html[`params['_source']`] (`Map`, read-only)::\n        Contains extracted JSON in a `Map` and `List` structure for the fields\n        existing in a stored document.\n\n*Return*\n\n`Object`::\n        The customized value for each document.\n\n*API*\n\nBoth the standard <<painless-api-reference-shared, Painless API>> and\n<<painless-api-reference-field, Specialized Field API>> are available.\n\n\n*Example*\n\nTo run this example, first follow the steps in\n<<painless-context-examples, context examples>>.\n\nYou can then use these two example scripts to compute custom information\nfor each search hit and output it to two new fields.\n\nThe first script gets the doc value for the `datetime` field and calls\nthe `getDayOfWeekEnum` function to determine the corresponding day of the week.\n\n[source,Painless]\n----\ndoc['datetime'].value.getDayOfWeekEnum().getDisplayName(TextStyle.FULL, Locale.ROOT)\n----\n\nThe second script calculates the number of actors. Actors' names are stored\nas a keyword array in the `actors` field.\n\n[source,Painless]\n----\ndoc['actors'].size()  <1>\n----\n\n<1> By default, doc values are not available for `text` fields. If `actors` was\na `text` field, you could still calculate the number of actors by extracting\nvalues from `_source` with `params['_source']['actors'].size()`.\n\nThe following request returns the calculated day of week and the number of\nactors that appear in each play:\n\n[source,console]\n----\nGET seats/_search\n{\n  \"size\": 2,\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"script_fields\": {\n    \"day-of-week\": {\n      \"script\": {\n        \"source\": \"doc['datetime'].value.getDayOfWeekEnum().getDisplayName(TextStyle.FULL, Locale.ENGLISH)\"\n      }\n    },\n    \"number-of-actors\": {\n      \"script\": {\n        \"source\": \"doc['actors'].size()\"\n      }\n    }\n  }\n}\n----\n// TEST[setup:seats]\n\n[source,console-result]\n----\n{\n  \"took\" : 68,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 1,\n    \"successful\" : 1,\n    \"skipped\" : 0,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : {\n      \"value\" : 11,\n      \"relation\" : \"eq\"\n    },\n    \"max_score\" : 1.0,\n    \"hits\" : [\n      {\n        \"_index\" : \"seats\",\n        \"_id\" : \"1\",\n        \"_score\" : 1.0,\n        \"fields\" : {\n          \"day-of-week\" : [\n            \"Thursday\"\n          ],\n          \"number-of-actors\" : [\n            4\n          ]\n        }\n      },\n      {\n        \"_index\" : \"seats\",\n        \"_id\" : \"2\",\n        \"_score\" : 1.0,\n        \"fields\" : {\n          \"day-of-week\" : [\n            \"Thursday\"\n          ],\n          \"number-of-actors\" : [\n            1\n          ]\n        }\n      }\n    ]\n  }\n}\n----\n// TESTRESPONSE[s/\"took\" : 68/\"took\" : \"$body.took\"/]\n"
}