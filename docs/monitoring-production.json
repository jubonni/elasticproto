{
    "meta": {
        "size": 6041,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/monitoring-production.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "monitoring-production",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[monitoring-production]]\n== Monitoring in a production environment\n\nIn production, you should send monitoring data to a separate _monitoring cluster_\nso that historical data is available even when the nodes you are monitoring are\nnot.\n\n// tag::monitoring-rec[]\n[IMPORTANT]\n=========================\n{agent} and {metricbeat} are the recommended methods for collecting and shipping\nmonitoring data to a monitoring cluster.\n\nIf you have previously configured legacy collection methods, you should migrate\nto using <<configuring-elastic-agent,{agent}>> or\n<<configuring-metricbeat,{metricbeat}>> collection. Do not use legacy collection\nalongside other collection methods.\n=========================\n// end::monitoring-rec[]\n\nIf you have at least a Gold Subscription, using a dedicated monitoring cluster\nalso enables you to monitor multiple clusters from a central location.\n\nTo store monitoring data in a separate cluster:\n\n. Set up the {es} cluster you want to use as the monitoring cluster.\nFor example, you might set up a two host cluster with the nodes `es-mon-1` and\n`es-mon-2`.\n+\n--\n[IMPORTANT]\n===============================\n* Ideally the monitoring cluster and the production cluster run on the same\n{stack} version. However, a monitoring cluster on the latest release of\n{major-version} also works with production clusters that use the same major\nversion. Monitoring clusters that use {major-version} also work with production\nclusters that use the latest release of {prev-major-version}.\n* There must be at least one <<ingest,ingest node>> in the monitoring\ncluster; it does not need to be a dedicated ingest node.\n===============================\n--\n\n.. (Optional) Verify that the collection of monitoring data is disabled on the\nmonitoring cluster. By default, the `xpack.monitoring.collection.enabled` setting\nis `false`.\n+\n--\nFor example, you can use the following APIs to review and change this setting:\n\n[source,console]\n----------------------------------\nGET _cluster/settings\n\nPUT _cluster/settings\n{\n  \"persistent\": {\n    \"xpack.monitoring.collection.enabled\": false\n  }\n}\n----------------------------------\n// TEST[skip:security errs]\n--\n\n.. If the {es} {security-features} are enabled on the monitoring cluster, create\nusers that can send and retrieve monitoring data:\n+\n--\nNOTE: If you plan to use {kib} to view monitoring data, username and password\ncredentials must be valid on both the {kib} server and the monitoring cluster.\n\n--\n\n*** If you plan to use {agent},\ncreate a user that has the `remote_monitoring_collector`\n<<built-in-roles-remote-monitoring-agent,built-in role>> and that the\nmonitoring related {fleet-guide}/install-uninstall-integration-assets.html#install-integration-assets[integration assets have been installed]\non the remote monitoring cluster. \n\n*** If you plan to use {metricbeat},\ncreate a user that has the `remote_monitoring_collector` built-in role and a\nuser that has the `remote_monitoring_agent`\n<<built-in-roles-remote-monitoring-agent,built-in role>>. Alternatively, use the\n`remote_monitoring_user` <<built-in-users,built-in user>>.\n\n*** If you plan to use HTTP exporters to route data through your production\ncluster, create a user that has the `remote_monitoring_agent`\n<<built-in-roles-remote-monitoring-agent,built-in role>>.\n+\n--\nFor example, the\nfollowing request creates a `remote_monitor` user that has the\n`remote_monitoring_agent` role:\n\n[source,console]\n---------------------------------------------------------------\nPOST /_security/user/remote_monitor\n{\n  \"password\" : \"changeme\",\n  \"roles\" : [ \"remote_monitoring_agent\"],\n  \"full_name\" : \"Internal Agent For Remote Monitoring\"\n}\n---------------------------------------------------------------\n// TEST[skip:needs-gold+-license]\n\nAlternatively, use the `remote_monitoring_user` <<built-in-users,built-in user>>.\n--\n\n. Configure your production cluster to collect data and send it to the\nmonitoring cluster:\n** <<configuring-elastic-agent,{agent} collection methods>>\n** <<configuring-metricbeat,{metricbeat} collection methods>>\n** <<collecting-monitoring-data,Legacy collection methods>>\n\n. (Optional)\n{logstash-ref}/configuring-logstash.html[Configure {ls} to collect data and send it to the monitoring cluster].\n\n. (Optional) {enterprise-search-ref}/monitoring.html[Configure {ents} monitoring].\n\n. (Optional) Configure the {beats} to collect data and send it to the monitoring\ncluster. Skip this step for {beats} that are managed by {agent}.\n** {auditbeat-ref}/monitoring.html[Auditbeat]\n** {filebeat-ref}/monitoring.html[Filebeat]\n** {heartbeat-ref}/monitoring.html[Heartbeat]\n** {metricbeat-ref}/monitoring.html[Metricbeat]\n** {packetbeat-ref}/monitoring.html[Packetbeat]\n** {winlogbeat-ref}/monitoring.html[Winlogbeat]\n\n. (Optional) {apm-guide-ref}/monitor-apm.html[Configure APM Server monitoring]\n\n. (Optional) Configure {kib} to collect data and send it to the monitoring cluster:\n** {kibana-ref}/monitoring-elastic-agent.html[{agent} collection methods]\n** {kibana-ref}/monitoring-metricbeat.html[{metricbeat} collection methods]\n** {kibana-ref}/monitoring-kibana.html[Legacy collection methods]\n\n. (Optional) Create a dedicated {kib} instance for monitoring, rather than using\na single {kib} instance to access both your production cluster and monitoring\ncluster.\n+\n--\nNOTE: If you log in to {kib} using SAML, Kerberos, PKI, OpenID Connect, or token\nauthentication providers, a dedicated {kib} instance is *required*. The security\ntokens that are used in these contexts are cluster-specific; therefore you\ncannot use a single {kib} instance to connect to both production and monitoring\nclusters.\n\n--\n\n.. (Optional) Disable the collection of monitoring data in this {kib} instance.\nSet the `xpack.monitoring.kibana.collection.enabled` setting to `false` in the\n`kibana.yml` file. For more information about this setting, see\n{kibana-ref}/monitoring-settings-kb.html[Monitoring settings in {kib}].\n\n. {kibana-ref}/monitoring-data.html[Configure {kib} to retrieve and display the monitoring data].\n"
}