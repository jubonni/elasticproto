{
    "meta": {
        "timestamp": "2024-11-01T03:07:10.506271",
        "size": 9078,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-update-job.html",
        "type": "documentation",
        "role": [
            "xpack",
            "child_attributes"
        ],
        "has_code": true,
        "title": "ml-update-job",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[ml-update-job]]\n= Update {anomaly-jobs} API\n++++\n<titleabbrev>Update jobs</titleabbrev>\n++++\n\nUpdates certain properties of an {anomaly-job}.\n\n[[ml-update-job-request]]\n== {api-request-title}\n\n`POST _ml/anomaly_detectors/<job_id>/_update`\n\n[[ml-update-job-prereqs]]\n== {api-prereq-title}\n\nRequires the `manage_ml` cluster privilege. This privilege is included in the\n`machine_learning_admin` built-in role.\n\n[[ml-update-job-path-parms]]\n== {api-path-parms-title}\n\n`<job_id>`::\n(Required, string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=job-id-anomaly-detection]\n\n[role=\"child_attributes\"]\n[[ml-update-job-request-body]]\n== {api-request-body-title}\n\nThe following properties can be updated after the job is created:\n\n`allow_lazy_open`::\n(Boolean)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=allow-lazy-open]\n+\n--\nNOTE: If the job is open when you make the update, you must stop the {dfeed},\nclose the job, then reopen the job and restart the {dfeed} for the changes to take effect.\n\n--\n//Begin analysis_limits\n[[update-analysislimits]]`analysis_limits`::\n(Optional, object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=analysis-limits]\n+\nYou can update the `analysis_limits` only while the job is closed.\n+\n.Properties of `analysis_limits`\n[%collapsible%open]\n====\n`model_memory_limit`:::\n(long or string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=model-memory-limit-ad]\n+\n--\n[NOTE]\n=======\n* You cannot decrease the `model_memory_limit` value below the current usage. To\ndetermine the current usage, refer to the `model_bytes` value in\nthe <<ml-get-job-stats,get job stats>> API.\n* If the `memory_status` property in the\n<<modelsizestats,`model_size_stats` object>> has a value of\n`hard_limit`, this means that it was unable to process some data. You might want\nto re-run the job with an increased `model_memory_limit`.\n=======\n--\n====\n//End analysis_limits\n\n`background_persist_interval`::\n(<<time-units,time units>>)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=background-persist-interval]\n+\n--\nNOTE: If the job is open when you make the update, you must stop the {dfeed},\nclose the job, then reopen the job and restart the {dfeed} for the changes to take effect.\n\n--\n\n[[update-customsettings]]`custom_settings`::\n(object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=custom-settings]\n\n`daily_model_snapshot_retention_after_days`::\n(long)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=daily-model-snapshot-retention-after-days]\n\n`description`::\n(string) A description of the job.\n\n//Begin detectors\n`detectors`::\n(array) An array of detector update objects.\n+\n.Properties of `detectors`\n[%collapsible%open]\n====\n\n//Begin detectors.custom_rules\n`custom_rules`:::\n(array)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=custom-rules]\n+\n.Properties of `custom_rules`\n[%collapsible%open]\n=====\n\n`actions`:::\n(array)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=custom-rules-actions]\n\n//Begin analysis_config.detectors.custom_rules.params\n`params`:::\n(object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=custom-rules-params]\n+\n.Properties of `params`\n[%collapsible%open]\n=======\n[[force-time-shift-params]]\n`force_time_shift`::::\n(object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=custom-rules-params-force-time-shift]\n=======\n//End analysis_config.detectors.custom_rules.params\n\n// Begin detectors.custom_rules.conditions\n`conditions`:::\n(array)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=custom-rules-conditions]\n+\n.Properties of `conditions`\n[%collapsible%open]\n======\n\n`applies_to`::::\n(string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=custom-rules-conditions-applies-to]\n\n`operator`::::\n(string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=custom-rules-conditions-operator]\n\n`value`::::\n(double)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=custom-rules-conditions-value]\n======\n//End detectors.custom_rules.conditions\n\n//Begin detectors.custom_rules.scope\n`scope`:::\n(object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=custom-rules-scope]\n+\n.Properties of `scope`\n[%collapsible%open]\n======\n`filter_id`::::\n(string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=custom-rules-scope-filter-id]\n\n`filter_type`::::\n(string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=custom-rules-scope-filter-type]\n======\n//End detectors.custom_rules.scope\n=====\n//End detectors.custom_rules\n\n`description`:::\n(string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=detector-description]\n\n`detector_index`:::\n(integer)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=detector-index]\n+\n--\nIf you want to update a specific detector, you must use this identifier. You\ncannot, however, change the `detector_index` value for a detector.\n--\n====\n//End detectors\n\n`groups`::\n(array of strings)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=groups]\n\n//Begin model_plot_config\n`model_plot_config`::\n(object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=model-plot-config]\n+\n.Properties of `model_plot_config`\n[%collapsible%open]\n====\n`annotations_enabled`:::\n(Boolean)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=model-plot-config-annotations-enabled]\n\n`enabled`:::\n(Boolean)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=model-plot-config-enabled]\n\n`terms`:::\nexperimental[] (string)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=model-plot-config-terms]\n====\n//End model_plot_config\n\n`model_prune_window`::\n(<<time-units,time units>>)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=model-prune-window]\n\n`model_snapshot_retention_days`::\n(long)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=model-snapshot-retention-days]\n\n//Begin per_partition_categorization\n`per_partition_categorization`:::\n(object)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=per-partition-categorization]\n+\n.Properties of `per_partition_categorization`\n[%collapsible%open]\n====\n`enabled`:::\n(Boolean)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=per-partition-categorization-enabled]\n\n`stop_on_warn`:::\n(Boolean)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=per-partition-categorization-stop-on-warn]\n====\n//End per_partition_categorization\n\n`renormalization_window_days`::\n(long)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=renormalization-window-days]\n+\n--\nNOTE: If the job is open when you make the update, you must stop the {dfeed},\nclose the job, then reopen the job and restart the {dfeed} for the changes to take effect.\n\n--\n\n`results_retention_days`::\n(long)\ninclude::{es-ref-dir}/ml/ml-shared.asciidoc[tag=results-retention-days]\n\n\n[[ml-update-job-example]]\n== {api-examples-title}\n\n[source,console]\n--------------------------------------------------\nPOST _ml/anomaly_detectors/low_request_rate/_update\n{\n  \"description\":\"An updated job\",\n  \"detectors\": {\n    \"detector_index\": 0,\n    \"description\": \"An updated detector description\"\n  },\n  \"groups\": [\"kibana_sample_data\",\"kibana_sample_web_logs\"],\n  \"model_plot_config\": {\n    \"enabled\": true\n  },\n  \"renormalization_window_days\": 30,\n  \"background_persist_interval\": \"2h\",\n  \"model_snapshot_retention_days\": 7,\n  \"results_retention_days\": 60\n}\n--------------------------------------------------\n// TEST[skip:setup:Kibana sample data]\n\nWhen the {anomaly-job} is updated, you receive a summary of the job\nconfiguration information, including the updated property values. For example:\n\n[source,js]\n----\n{\n  \"job_id\" : \"low_request_rate\",\n  \"job_type\" : \"anomaly_detector\",\n  \"job_version\" : \"8.4.0\",\n  \"create_time\" : 1656105950893,\n  \"finished_time\" : 1656105965744,\n  \"model_snapshot_id\" : \"1656105964\",\n  \"custom_settings\" : {\n    \"created_by\" : \"ml-module-sample\",\n    \"custom_urls\" : [\n      {\n        \"url_name\" : \"Raw data\",\n        \"url_value\" : \"discover#/?_g=(time:(from:'$earliest$',mode:absolute,to:'$latest$'))&_a=(index:'90943e30-9a47-11e8-b64d-95841ca0b247')\"\n      },\n      {\n        \"url_name\" : \"Data dashboard\",\n        \"url_value\" : \"dashboards#/view/edf84fe0-e1a0-11e7-b6d5-4dc382ef7f5b?_g=(time:(from:'$earliest$',mode:absolute,to:'$latest$'))&_a=(filters:!(),query:(language:kuery,query:''))\"\n      }\n    ]\n  },\n  \"groups\" : [\n    \"kibana_sample_data\",\n    \"kibana_sample_web_logs\"\n  ],\n  \"description\" : \"An updated job\",\n  \"analysis_config\" : {\n    \"bucket_span\" : \"1h\",\n    \"summary_count_field_name\" : \"doc_count\",\n    \"detectors\" : [\n      {\n        \"detector_description\" : \"An updated detector description\",\n        \"function\" : \"low_count\",\n        \"detector_index\" : 0\n      }\n    ],\n    \"influencers\" : [ ],\n    \"model_prune_window\" : \"30d\"\n  },\n  \"analysis_limits\" : {\n    \"model_memory_limit\" : \"11mb\",\n    \"categorization_examples_limit\" : 4\n  },\n  \"data_description\" : {\n    \"time_field\" : \"timestamp\",\n    \"time_format\" : \"epoch_ms\"\n  },\n  \"model_plot_config\" : {\n    \"enabled\" : true,\n    \"annotations_enabled\" : true\n  },\n  \"renormalization_window_days\" : 30,\n  \"background_persist_interval\" : \"2h\",\n  \"model_snapshot_retention_days\" : 7,\n  \"daily_model_snapshot_retention_after_days\" : 1,\n  \"results_retention_days\" : 60,\n  \"results_index_name\" : \"custom-low_request_rate\",\n  \"allow_lazy_open\" : false\n}\n----\n"
}