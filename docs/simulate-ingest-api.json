{
    "meta": {
        "timestamp": "2024-11-01T03:02:53.545597",
        "size": 12387,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/simulate-ingest-api.html",
        "type": "documentation",
        "role": [
            "child_attributes"
        ],
        "has_code": false,
        "title": "simulate-ingest-api",
        "version": "8.15"
    },
    "doc": "\n[[simulate-ingest-api]]\n=== Simulate ingest API\n++++\n<titleabbrev>Simulate ingest</titleabbrev>\n++++\n\nExecutes ingest pipelines against a set of provided documents, optionally\nwith substitute pipeline definitions. This API is meant to be used for\ntroubleshooting or pipeline development, as it does not actually index any\ndata into {es}.\n\n////\n[source,console]\n----\nPUT /_ingest/pipeline/my-pipeline\n{\n  \"description\" : \"example pipeline to simulate\",\n      \"processors\": [\n      {\n        \"set\" : {\n          \"field\" : \"field1\",\n          \"value\" : \"value1\"\n        }\n      }\n    ]\n}\n\nPUT /_ingest/pipeline/my-final-pipeline\n{\n  \"description\" : \"example final pipeline to simulate\",\n      \"processors\": [\n      {\n        \"set\" : {\n          \"field\" : \"field2\",\n          \"value\" : \"value2\"\n        }\n      }\n    ]\n}\n\nPUT /my-index\n{\n  \"settings\": {\n    \"index\": {\n      \"default_pipeline\": \"my-pipeline\",\n      \"final_pipeline\": \"my-final-pipeline\"\n    }\n  }\n}\n----\n// TESTSETUP\n////\n\n[source,console]\n----\nPOST /_ingest/_simulate\n{\n  \"docs\": [\n    {\n      \"_index\": \"my-index\",\n      \"_id\": \"id\",\n      \"_source\": {\n        \"foo\": \"bar\"\n      }\n    },\n    {\n      \"_index\": \"my-index\",\n      \"_id\": \"id\",\n      \"_source\": {\n        \"foo\": \"rab\"\n      }\n    }\n  ],\n  \"pipeline_substitutions\": { <1>\n    \"my-pipeline\": {\n      \"processors\": [\n        {\n          \"set\": {\n            \"field\": \"field3\",\n            \"value\": \"value3\"\n          }\n        }\n      ]\n    }\n  },\n  \"component_template_substitutions\": { <2>\n    \"my-component-template\": {\n      \"template\": {\n        \"mappings\": {\n          \"dynamic\": \"true\",\n          \"properties\": {\n            \"field3\": {\n              \"type\": \"keyword\"\n            }\n          }\n        },\n        \"settings\": {\n          \"index\": {\n            \"default_pipeline\": \"my-pipeline\"\n          }\n        }\n      }\n    }\n  },\n  \"index_template_substitutions\": { <3>\n    \"my-index-template\": {\n      \"index_patterns\": [\"my-index-*\"],\n      \"composed_of\": [\"component_template_1\", \"component_template_2\"]\n    }\n  },\n  \"mapping_addition\": { <4>\n    \"dynamic\": \"strict\",\n    \"properties\": {\n      \"foo\": {\n        \"type\": \"keyword\"\n      }\n    }\n  }\n}\n----\n\n<1> This replaces the existing `my-pipeline` pipeline with the contents given here for the duration of this request.\n<2> This replaces the existing `my-component-template` component template with the contents given here for the duration of this request.\nThese templates can be used to change the pipeline(s) used, or to modify the mapping that will be used to validate the result.\n<3> This replaces the existing `my-index-template` index template with the contents given here for the duration of this request.\nThese templates can be used to change the pipeline(s) used, or to modify the mapping that will be used to validate the result.\n<4> This mapping is merged into the index's final mapping just before validation. It is used only for the duration of this request.\n\n[[simulate-ingest-api-request]]\n==== {api-request-title}\n\n`POST /_ingest/_simulate`\n\n`GET /_ingest/_simulate`\n\n`POST /_ingest/<target>/_simulate`\n\n`GET /_ingest/<target>/_simulate`\n\n[[simulate-ingest-api-prereqs]]\n==== {api-prereq-title}\n\n* If the {es} {security-features} are enabled, you must have the\n`index` or `create` <<privileges-list-indices,index privileges>>\nto use this API.\n\n[[simulate-ingest-api-desc]]\n==== {api-description-title}\n\nThe simulate ingest API simulates ingesting data into an index. It\nexecutes the default and final pipeline for that index against a set\nof documents provided in the body of the request. If a pipeline\ncontains a <<reroute-processor,reroute processor>>, it follows that\nreroute processor to the new index, executing that index's pipelines\nas well the same way that a non-simulated ingest would. No data is\nindexed into {es}. Instead, the transformed document is returned,\nalong with the list of pipelines that have been executed and the name\nof the index where the document would have been indexed if this were\nnot a simulation. The transformed document is validated against the\nmappings that would apply to this index, and any validation error is\nreported in the result.\n\nThis API differs from the\n<<simulate-pipeline-api,simulate pipeline API>> in that you specify a\nsingle pipeline for that API, and it only runs that one pipeline. The\nsimulate pipeline API is more useful for developing a single pipeline,\nwhile the simulate ingest API is more useful for troubleshooting the\ninteraction of the various pipelines that get applied when ingesting\ninto an index.\n\n\nBy default, the pipeline definitions that are currently in the system\nare used. However, you can supply substitute pipeline definitions in the\nbody of the request. These will be used in place of the pipeline\ndefinitions that are already in the system. This can be used to replace\nexisting pipeline definitions or to create new ones. The pipeline\nsubstitutions are only used within this request.\n\n[[simulate-ingest-api-path-params]]\n==== {api-path-parms-title}\n\n`<target>`::\n(Optional, string)\nThe index to simulate ingesting into. This can be overridden by specifying an index\non each document. If you provide a <target> in the request path, it is used for any\ndocuments that don\u2019t explicitly specify an index argument.\n\n[[simulate-ingest-api-query-params]]\n==== {api-query-parms-title}\n\n`pipeline`::\n(Optional, string)\nPipeline to use as the default pipeline. This can be used to override the default pipeline\nof the index being ingested into.\n\n\n[role=\"child_attributes\"]\n[[simulate-ingest-api-request-body]]\n==== {api-request-body-title}\n\n`docs`::\n(Required, array of objects)\nSample documents to test in the pipeline.\n+\n.Properties of `docs` objects\n[%collapsible%open]\n====\n`_id`::\n(Optional, string)\nUnique identifier for the document.\n\n`_index`::\n(Optional, string)\nName of the index that the document will be ingested into.\n\n`_source`::\n(Required, object)\nJSON body for the document.\n====\n\n`pipeline_substitutions`::\n(Optional, map of strings to objects)\nMap of pipeline IDs to substitute pipeline definition objects.\n+\n.Properties of pipeline definition objects\n[%collapsible%open]\n====\ninclude::put-pipeline.asciidoc[tag=pipeline-object]\n====\n\n`component_template_substitutions`::\n(Optional, map of strings to objects)\nMap of component template names to substitute component template definition objects.\n+\n.Properties of component template definition objects\n[%collapsible%open]\n\n====\n\ninclude::{es-ref-dir}/indices/put-component-template.asciidoc[tag=template]\n\n====\n\n`index_template_substitutions`::\n(Optional, map of strings to objects)\nMap of index template names to substitute index template definition objects.\n+\n.Properties of index template definition objects\n[%collapsible%open]\n\n====\n\ninclude::{es-ref-dir}/indices/put-index-template.asciidoc[tag=request-body]\n\n====\n\n`mapping_addition`::\n(Optional, <<mapping,mapping object>>)\nDefinition of a mapping that will be merged into the index's mapping for validation during the course of this request.\n\n[[simulate-ingest-api-example]]\n==== {api-examples-title}\n\n\n[[simulate-ingest-api-pre-existing-pipelines-ex]]\n===== Use pre-existing pipeline definitions\nIn this example the index `index` has a default pipeline called `my-pipeline` and a final\npipeline called `my-final-pipeline`. Since both documents are being ingested into `index`,\nboth pipelines are executed using the pipeline definitions that are already in the system.\n\n[source,console]\n----\nPOST /_ingest/_simulate\n{\n  \"docs\": [\n    {\n      \"_index\": \"my-index\",\n      \"_id\": \"123\",\n      \"_source\": {\n        \"foo\": \"bar\"\n      }\n    },\n    {\n      \"_index\": \"my-index\",\n      \"_id\": \"456\",\n      \"_source\": {\n        \"foo\": \"rab\"\n      }\n    }\n  ]\n}\n----\n\nThe API returns the following response:\n\n[source,console-result]\n----\n{\n   \"docs\": [\n      {\n         \"doc\": {\n            \"_id\": \"123\",\n            \"_index\": \"my-index\",\n            \"_version\": -3,\n            \"_source\": {\n               \"field1\": \"value1\",\n               \"field2\": \"value2\",\n               \"foo\": \"bar\"\n            },\n            \"executed_pipelines\": [\n               \"my-pipeline\",\n               \"my-final-pipeline\"\n            ]\n         }\n      },\n      {\n         \"doc\": {\n            \"_id\": \"456\",\n            \"_index\": \"my-index\",\n            \"_version\": -3,\n            \"_source\": {\n               \"field1\": \"value1\",\n               \"field2\": \"value2\",\n               \"foo\": \"rab\"\n            },\n            \"executed_pipelines\": [\n               \"my-pipeline\",\n               \"my-final-pipeline\"\n            ]\n         }\n      }\n   ]\n}\n----\n\n[[simulate-ingest-api-request-body-ex]]\n===== Specify a pipeline substitution in the request body\nIn this example the index `my-index` has a default pipeline called `my-pipeline` and a final\npipeline called `my-final-pipeline`. But a substitute definition of `my-pipeline` is\nprovided in `pipeline_substitutions`. The substitute `my-pipeline` will be used in place of\nthe `my-pipeline` that is in the system, and then the `my-final-pipeline` that is already\ndefined in the system will be executed.\n\n[source,console]\n----\nPOST /_ingest/_simulate\n{\n  \"docs\": [\n    {\n      \"_index\": \"my-index\",\n      \"_id\": \"123\",\n      \"_source\": {\n        \"foo\": \"bar\"\n      }\n    },\n    {\n      \"_index\": \"my-index\",\n      \"_id\": \"456\",\n      \"_source\": {\n        \"foo\": \"rab\"\n      }\n    }\n  ],\n  \"pipeline_substitutions\": {\n    \"my-pipeline\": {\n      \"processors\": [\n        {\n          \"uppercase\": {\n            \"field\": \"foo\"\n          }\n        }\n      ]\n    }\n  }\n}\n----\n\nThe API returns the following response:\n\n[source,console-result]\n----\n{\n   \"docs\": [\n      {\n         \"doc\": {\n            \"_id\": \"123\",\n            \"_index\": \"my-index\",\n            \"_version\": -3,\n            \"_source\": {\n               \"field2\": \"value2\",\n               \"foo\": \"BAR\"\n            },\n            \"executed_pipelines\": [\n               \"my-pipeline\",\n               \"my-final-pipeline\"\n            ]\n         }\n      },\n      {\n         \"doc\": {\n            \"_id\": \"456\",\n            \"_index\": \"my-index\",\n            \"_version\": -3,\n            \"_source\": {\n               \"field2\": \"value2\",\n               \"foo\": \"RAB\"\n            },\n            \"executed_pipelines\": [\n               \"my-pipeline\",\n               \"my-final-pipeline\"\n            ]\n         }\n      }\n   ]\n}\n----\n\n[[simulate-ingest-api-substitute-component-templates-ex]]\n===== Specify a component template substitution in the request body\nIn this example, imagine that the index `my-index` has a strict mapping with only the `foo`\nkeyword field defined. Say that field mapping came from a component template named\n`my-mappings-template`. We want to test adding a new field, `bar`. So a substitute definition of\n`my-mappings-template` is provided in `component_template_substitutions`. The substitute\n`my-mappings-template` will be used in place of the existing mapping for `my-index` and in place\nof the `my-mappings-template` that is in the system.\n\n[source,console]\n----\nPOST /_ingest/_simulate\n{\n  \"docs\": [\n    {\n      \"_index\": \"my-index\",\n      \"_id\": \"123\",\n      \"_source\": {\n        \"foo\": \"foo\"\n      }\n    },\n    {\n      \"_index\": \"my-index\",\n      \"_id\": \"456\",\n      \"_source\": {\n        \"bar\": \"rab\"\n      }\n    }\n  ],\n  \"component_template_substitutions\": {\n    \"my-mappings_template\": {\n      \"template\": {\n        \"mappings\": {\n          \"dynamic\": \"strict\",\n          \"properties\": {\n            \"foo\": {\n              \"type\": \"keyword\"\n            },\n            \"bar\": {\n              \"type\": \"keyword\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n----\n\nThe API returns the following response:\n\n[source,console-result]\n----\n{\n   \"docs\": [\n      {\n         \"doc\": {\n            \"_id\": \"123\",\n            \"_index\": \"my-index\",\n            \"_version\": -3,\n            \"_source\": {\n               \"foo\": \"foo\"\n            },\n            \"executed_pipelines\": []\n         }\n      },\n      {\n         \"doc\": {\n            \"_id\": \"456\",\n            \"_index\": \"my-index\",\n            \"_version\": -3,\n            \"_source\": {\n               \"bar\": \"rab\"\n            },\n            \"executed_pipelines\": []\n         }\n      }\n   ]\n}\n----\n\n////\n[source,console]\n----\nDELETE /my-index\n\nDELETE /_ingest/pipeline/*\n----\n\n[source,console-result]\n----\n{\n  \"acknowledged\": true\n}\n----\n////\n"
}