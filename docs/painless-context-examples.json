{
    "meta": {
        "timestamp": "2024-11-01T03:07:09.832273",
        "size": 5869,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/painless-context-examples.html",
        "type": "documentation",
        "role": [],
        "has_code": false,
        "title": "painless-context-examples",
        "version": "8.15"
    },
    "doc": "[[painless-context-examples]]\n=== Context example data\n\nComplete the following steps to index the `seat` sample data into {es}. You can\nrun any of the context examples against this sample data after you configure it.\n\nEach document in the `seat` data contains the following fields:\n\n`theatre` ({ref}/keyword.html[`keyword`])::\n        The name of the theater the play is in.\n`play` ({ref}/text.html[`keyword`])::\n        The name of the play.\n`actors` ({ref}/text.html[`keyword`])::\n        A list of actors in the play.\n`date` ({ref}/keyword.html[`keyword`])::\n        The date of the play as a keyword.\n`time` ({ref}/keyword.html[`keyword`])::\n                The time of the play as a keyword.\n`cost` ({ref}/number.html[`long`])::\n        The cost of the ticket for the seat.\n`row` ({ref}/number.html[`long`])::\n        The row of the seat.\n`number` ({ref}/number.html[`long`])::\n        The number of the seat within a row.\n`sold` ({ref}/boolean.html[`boolean`])::\n        Whether or not the seat is sold.\n`datetime` ({ref}/date.html[`date`])::\n        The date and time of the play as a date object.\n\n==== Prerequisites\nStart an {ref}/configuring-stack-security.html[{es} instance], and then access the\n{kibana-ref}/console-kibana.html[Console] in {kib}.\n\n==== Configure the `seat` sample data\n. From the {kib} Console, create {ref}/mapping.html[mappings] for the sample\ndata:\n+\n[source,console]\n----\nPUT /seats\n{\n  \"mappings\": {\n    \"properties\": {\n      \"theatre\":  { \"type\": \"keyword\" },\n      \"play\":     { \"type\": \"keyword\" },\n      \"actors\":   { \"type\": \"keyword\" },\n      \"date\":     { \"type\": \"keyword\" },\n      \"time\":     { \"type\": \"keyword\" },\n      \"cost\":     { \"type\": \"double\"  },\n      \"row\":      { \"type\": \"integer\" },\n      \"number\":   { \"type\": \"integer\" },\n      \"sold\":     { \"type\": \"boolean\" },\n      \"datetime\": { \"type\": \"date\"    }\n    }\n  }\n}\n----\n+\n\n. Configure a script ingest processor that parses each document as {es} ingests\nthe `seat` data. The following ingest script processes the `date` and `time`\nfields and stores the result in a `datetime` field:\n+\n[source,console]\n----\nPUT /_ingest/pipeline/seats\n{\n  \"description\": \"update datetime for seats\",\n  \"processors\": [\n    {\n      \"script\": {\n        \"source\": \"String[] dateSplit = ctx.date.splitOnToken('-'); String year = dateSplit[0].trim(); String month = dateSplit[1].trim(); if (month.length() == 1) { month = '0' + month; } String day = dateSplit[2].trim(); if (day.length() == 1) { day = '0' + day; } boolean pm = ctx.time.substring(ctx.time.length() - 2).equals('PM'); String[] timeSplit = ctx.time.substring(0, ctx.time.length() - 2).splitOnToken(':'); int hours = Integer.parseInt(timeSplit[0].trim()); int minutes = Integer.parseInt(timeSplit[1].trim()); if (pm) { hours += 12; } String dts = year + '-' + month + '-' + day + 'T' + (hours < 10 ? '0' + hours : '' + hours) + ':' + (minutes < 10 ? '0' + minutes : '' + minutes) + ':00+08:00'; ZonedDateTime dt = ZonedDateTime.parse(dts, DateTimeFormatter.ISO_OFFSET_DATE_TIME); ctx.datetime = dt.getLong(ChronoField.INSTANT_SECONDS)*1000L;\"\n      }\n    }\n  ]\n}\n----\n// TEST[continued]\n\n. Ingest some sample data using the `seats` ingest pipeline that you defined in\nthe previous step.\n+\n[source,console]\n----\nPOST seats/_bulk?pipeline=seats&refresh=true\n{\"create\":{\"_index\":\"seats\",\"_id\":\"1\"}}\n{\"theatre\":\"Skyline\",\"play\":\"Rent\",\"actors\":[\"James Holland\",\"Krissy Smith\",\"Joe Muir\",\"Ryan Earns\"],\"date\":\"2021-4-1\",\"time\":\"3:00PM\",\"cost\":37,\"row\":1,\"number\":7,\"sold\":false}\n{\"create\":{\"_index\":\"seats\",\"_id\":\"2\"}}\n{\"theatre\":\"Graye\",\"play\":\"Rent\",\"actors\":[\"Dave Christmas\"],\"date\":\"2021-4-1\",\"time\":\"3:00PM\",\"cost\":30,\"row\":3,\"number\":5,\"sold\":false}\n{\"create\":{\"_index\":\"seats\",\"_id\":\"3\"}}\n{\"theatre\":\"Graye\",\"play\":\"Rented\",\"actors\":[\"Dave Christmas\"],\"date\":\"2021-4-1\",\"time\":\"3:00PM\",\"cost\":33,\"row\":2,\"number\":6,\"sold\":false}\n{\"create\":{\"_index\":\"seats\",\"_id\":\"4\"}}\n{\"theatre\":\"Skyline\",\"play\":\"Rented\",\"actors\":[\"James Holland\",\"Krissy Smith\",\"Joe Muir\",\"Ryan Earns\"],\"date\":\"2021-4-1\",\"time\":\"3:00PM\",\"cost\":20,\"row\":5,\"number\":2,\"sold\":false}\n{\"create\":{\"_index\":\"seats\",\"_id\":\"5\"}}\n{\"theatre\":\"Down Port\",\"play\":\"Pick It Up\",\"actors\":[\"Joel Madigan\",\"Jessica Brown\",\"Baz Knight\",\"Jo Hangum\",\"Rachel Grass\",\"Phoebe Miller\"],\"date\":\"2018-4-2\",\"time\":\"8:00PM\",\"cost\":27.5,\"row\":3,\"number\":2,\"sold\":false}\n{\"create\":{\"_index\":\"seats\",\"_id\":\"6\"}}\n{\"theatre\":\"Down Port\",\"play\":\"Harriot\",\"actors\":[\"Phoebe Miller\",\"Sarah Notch\",\"Brayden Green\",\"Joshua Iller\",\"Jon Hittle\",\"Rob Kettleman\",\"Laura Conrad\",\"Simon Hower\",\"Nora Blue\",\"Mike Candlestick\",\"Jacey Bell\"],\"date\":\"2018-8-7\",\"time\":\"8:00PM\",\"cost\":30,\"row\":1,\"number\":10,\"sold\":false}\n{\"create\":{\"_index\":\"seats\",\"_id\":\"7\"}}\n{\"theatre\":\"Skyline\",\"play\":\"Auntie Jo\",\"actors\":[\"Jo Hangum\",\"Jon Hittle\",\"Rob Kettleman\",\"Laura Conrad\",\"Simon Hower\",\"Nora Blue\"],\"date\":\"2018-10-2\",\"time\":\"5:40PM\",\"cost\":22.5,\"row\":7,\"number\":10,\"sold\":false}\n{\"create\":{\"_index\":\"seats\",\"_id\":\"8\"}}\n{\"theatre\":\"Skyline\",\"play\":\"Test Run\",\"actors\":[\"Joe Muir\",\"Ryan Earns\",\"Joel Madigan\",\"Jessica Brown\"],\"date\":\"2018-8-5\",\"time\":\"7:30PM\",\"cost\":17.5,\"row\":11,\"number\":12,\"sold\":true}\n{\"create\":{\"_index\":\"seats\",\"_id\":\"9\"}}\n{\"theatre\":\"Skyline\",\"play\":\"Sunnyside Down\",\"actors\":[\"Krissy Smith\",\"Joe Muir\",\"Ryan Earns\",\"Nora Blue\",\"Mike Candlestick\",\"Jacey Bell\"],\"date\":\"2018-6-12\",\"time\":\"4:00PM\",\"cost\":21.25,\"row\":8,\"number\":15,\"sold\":true}\n{\"create\":{\"_index\":\"seats\",\"_id\":\"10\"}}\n{\"theatre\":\"Graye\",\"play\":\"Line and Single\",\"actors\":[\"Nora Blue\",\"Mike Candlestick\"],\"date\":\"2018-6-5\",\"time\":\"2:00PM\",\"cost\":30,\"row\":1,\"number\":2,\"sold\":false}\n{\"create\":{\"_index\":\"seats\",\"_id\":\"11\"}}\n{\"theatre\":\"Graye\",\"play\":\"Hamilton\",\"actors\":[\"Lin-Manuel Miranda\",\"Leslie Odom Jr.\"],\"date\":\"2018-6-5\",\"time\":\"2:00PM\",\"cost\":5000,\"row\":1,\"number\":20,\"sold\":true}\n----\n// TEST[continued]\n"
}