{
    "meta": {
        "size": 3639,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/configuring-authorization-delegation.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "configuring-authorization-delegation",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[configuring-authorization-delegation]]\n=== Configuring authorization delegation\n\nIn some cases, after the user has been authenticated by a realm, we may\nwant to delegate user lookup and assignment of roles to another realm.\nAny realm that supports <<user-lookup,user lookup>> (without needing the\nuser's credentials) can be used as an authorization realm.\n\nFor example, a user that is authenticated by the Kerberos realm can be looked up\nin the LDAP realm. The LDAP realm takes on responsibility for searching the user\nin LDAP and determining the role. In this case, the LDAP realm acts as an\n_authorization realm_.\n\n==== LDAP realm as an authorization realm\nFollowing is an example configuration for the LDAP realm that can be used as\nan _authorization realm_. This LDAP realm is configured in user search mode\nwith a specified filter.\n\nFor more information on configuring LDAP realms see <<ldap-realm>>.\n\n[source, yaml]\n------------------------------------------------------------\nxpack:\n  security:\n    authc:\n      realms:\n        ldap:\n          ldap1:\n            order: 0\n            authentication.enabled: true <1>\n            user_search:\n              base_dn: \"dc=example,dc=org\"\n              filter: \"(cn={0})\"\n            group_search:\n              base_dn: \"dc=example,dc=org\"\n            files:\n              role_mapping: \"ES_PATH_CONF/role_mapping.yml\"\n            unmapped_groups_as_roles: false\n------------------------------------------------------------\n\n<1> Here, we explicitly allow the LDAP realm to be used for authentication\n(that is, users can authenticate using their LDAP username and password).\nIf we wanted this LDAP realm to be used for authorization only, then we\n would set this to `false`.\n\n==== Kerberos realm configured to delegate authorization\n\nFollowing is an example configuration where the Kerberos realm authenticates a\nuser and then delegates authorization to the LDAP realm. The\nKerberos realm authenticates the user and extracts user principal name\n(usually of format `user@REALM`). In this example, we enable the `remove_realm_name`\nsetting to remove the `@REALM` part from the user principal name to get the username.\nThis username is used to do a user lookup by the configured authorization realms (in this case the LDAP realm).\n\nFor more information on Kerberos realm see <<kerberos-realm>>.\n\n[source, yaml]\n------------------------------------------------------------\nxpack:\n  security:\n    authc:\n      realms:\n        kerberos:\n          kerb1:\n            order: 1\n            keytab.path: \"ES_PATH_CONF/es.keytab\"\n            remove_realm_name: true\n            authorization_realms: ldap1\n------------------------------------------------------------\n\n==== PKI realm configured to delegate authorization\n\nWe can similarly configure PKI realm to delegate authorization to LDAP realm.\nThe user is authenticated by the PKI realm and the authorization is delegated to\nthe LDAP realm. In this example, the username is the common name (CN)\nextracted from the DN of the client certificate. The LDAP realm uses this\nusername to lookup user and assign the role.\n\nFor more information on PKI realms see <<pki-realm>>.\n\n[source, yaml]\n------------------------------------------------------------\nxpack:\n  security:\n    authc:\n      realms:\n        pki:\n          pki1:\n            order: 2\n            authorization_realms: ldap1\n------------------------------------------------------------\n\nSimilar to the above examples, we can configure realms to delegate authorization to\nauthorization realms (which have the capability to lookup users by the username and assign roles).\n"
}