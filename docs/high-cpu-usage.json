{
    "meta": {
        "timestamp": "2024-11-01T02:49:25.324066",
        "size": 3762,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/high-cpu-usage.html",
        "type": "documentation",
        "role": [],
        "has_code": false,
        "title": "high-cpu-usage",
        "version": "8.15"
    },
    "doc": "[[high-cpu-usage]]\n=== High CPU usage\n\n{es} uses <<modules-threadpool,thread pools>> to manage CPU resources for\nconcurrent operations. High CPU usage typically means one or more thread pools\nare running low.\n\nIf a thread pool is depleted, {es} will <<rejected-requests,reject requests>>\nrelated to the thread pool. For example, if the `search` thread pool is\ndepleted, {es} will reject search requests until more threads are available.\n\nYou might experience high CPU usage if a <<data-tiers,data tier>>, and therefore the nodes assigned to that tier, is experiencing more traffic than other tiers. This imbalance in resource utilization is also known as <<hotspotting,hot spotting>>.\n\n[discrete]\n[[diagnose-high-cpu-usage]]\n==== Diagnose high CPU usage\n\n**Check CPU usage**\n\nYou can check the CPU usage per node using the <<cat-nodes,cat nodes API>>:\n\n// tag::cpu-usage-cat-nodes[]\n[source,console]\n----\nGET _cat/nodes?v=true&s=cpu:desc\n----\n\nThe response's `cpu` column contains the current CPU usage as a percentage.\nThe `name` column contains the node's name. Elevated but transient CPU usage is\nnormal. However, if CPU usage is elevated for an extended duration, it should be\ninvestigated.\n\nTo track CPU usage over time, we recommend enabling monitoring:\n\ninclude::{es-ref-dir}/tab-widgets/cpu-usage-widget.asciidoc[]\n\n**Check hot threads**\n\nIf a node has high CPU usage, use the <<cluster-nodes-hot-threads,nodes hot\nthreads API>> to check for resource-intensive threads running on the node.\n\n[source,console]\n----\nGET _nodes/hot_threads\n----\n// TEST[s/\\/my-node,my-other-node//]\n\nThis API returns a breakdown of any hot threads in plain text. High CPU usage\nfrequently correlates to <<task-queue-backlog,a long-running task, or a\nbacklog of tasks>>.\n\n[discrete]\n[[reduce-cpu-usage]]\n==== Reduce CPU usage\n\nThe following tips outline the most common causes of high CPU usage and their\nsolutions.\n\n**Scale your cluster**\n\nHeavy indexing and search loads can deplete smaller thread pools. To better\nhandle heavy workloads, add more nodes to your cluster or upgrade your existing\nnodes to increase capacity.\n\n**Spread out bulk requests**\n\nWhile more efficient than individual requests, large <<docs-bulk,bulk indexing>>\nor <<search-multi-search,multi-search>> requests still require CPU resources. If\npossible, submit smaller requests and allow more time between them.\n\n**Cancel long-running searches**\n\nLong-running searches can block threads in the `search` thread pool. To check\nfor these searches, use the <<tasks,task management API>>.\n\n[source,console]\n----\nGET _tasks?actions=*search&detailed\n----\n\nThe response's `description` contains the search request and its queries.\n`running_time_in_nanos` shows how long the search has been running.\n\n[source,console-result]\n----\n{\n  \"nodes\" : {\n    \"oTUltX4IQMOUUVeiohTt8A\" : {\n      \"name\" : \"my-node\",\n      \"transport_address\" : \"127.0.0.1:9300\",\n      \"host\" : \"127.0.0.1\",\n      \"ip\" : \"127.0.0.1:9300\",\n      \"tasks\" : {\n        \"oTUltX4IQMOUUVeiohTt8A:464\" : {\n          \"node\" : \"oTUltX4IQMOUUVeiohTt8A\",\n          \"id\" : 464,\n          \"type\" : \"transport\",\n          \"action\" : \"indices:data/read/search\",\n          \"description\" : \"indices[my-index], search_type[QUERY_THEN_FETCH], source[{\\\"query\\\":...}]\",\n          \"start_time_in_millis\" : 4081771730000,\n          \"running_time_in_nanos\" : 13991383,\n          \"cancellable\" : true\n        }\n      }\n    }\n  }\n}\n----\n// TESTRESPONSE[skip: no way to get tasks]\n\nTo cancel a search and free up resources, use the API's `_cancel` endpoint.\n\n[source,console]\n----\nPOST _tasks/oTUltX4IQMOUUVeiohTt8A:464/_cancel\n----\n\nFor additional tips on how to track and avoid resource-intensive searches, see\n<<avoid-expensive-searches,Avoid expensive searches>>."
}