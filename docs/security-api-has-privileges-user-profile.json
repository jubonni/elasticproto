{
    "meta": {
        "timestamp": "2024-11-01T03:02:52.694585",
        "size": 5622,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-has-privileges-user-profile.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "security-api-has-privileges-user-profile",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[security-api-has-privileges-user-profile]]\n=== Has privileges user profile API\n++++\n<titleabbrev>Has privileges user profile</titleabbrev>\n++++\n\nNOTE: The user profile feature is designed only for use by {kib} and\nElastic\u2019s {observability}, {ents}, and {elastic-sec} solutions. Individual\nusers and external applications should not call this API directly. Elastic reserves\nthe right to change or remove this feature in future releases without prior notice.\n\nDetermines whether the users associated with the specified <<user-profile, user profile>> IDs\nhave all the requested privileges.\n\n[[security-api-has-privileges-user-profile-request]]\n==== {api-request-title}\n\n`GET /_security/profile/_has_privileges`\n\n`POST /_security/profile/_has_privileges`\n\n[[security-api-has-privileges-user-profile-prereqs]]\n==== {api-prereq-title}\n\nTo use this API, you must have _at least_ the `read_security`\n<<privileges-list-cluster,cluster privilege>> (or a greater privilege\nsuch as `manage_user_profile` or `manage_security`).\n\n[[security-api-has-privileges-user-profile-desc]]\n==== {api-description-title}\n\nThis API uses the profile IDs, as returned by <<security-api-activate-user-profile>>,\nto identify the users for which to check the privileges of.\nIt is similar to the <<security-api-has-privileges>> API, but unlike it, this API\nchecks the privileges of other users, not of the user that's calling it.\n\nSee <<security-privileges>> for the list of privileges that can be specified in this API.\n\nA successful call returns the subset list of profile IDs that have **all** the requested privileges.\n\n[[security-api-has-privileges-user-profile-request-body]]\n==== {api-request-body-title}\n\n`uids`:: (list) A list of <<security-api-activate-user-profile-response-body, profile IDs>>. The privileges are checked for associated users of the profiles.\n\n`privileges`:: The object containing all the privileges to be checked.\n`cluster`::: (list) A list of the cluster privileges that you want to check.\n`index`:::\n`names`:::: (list) A list of indices.\n`allow_restricted_indices`:::: (Boolean) This needs to be set to `true` (default\nis `false`) if using wildcards or regexps for patterns that cover restricted\nindices. Implicitly, restricted indices do not match index patterns because\nrestricted indices usually have limited privileges and including them in\npattern tests would render most such tests `false`. If restricted indices are\nexplicitly included in the `names` list, privileges will be checked against\nthem regardless of the value of `allow_restricted_indices`.\n`privileges`:::: (list) A list of the privileges that you want to check for the\nspecified indices.\n`application`:::\n`application`:::: (string) The name of the application.\n`privileges`:::: (list) A list of the privileges that you want to check for the\nspecified resources. May be either application privilege names, or the names of\nactions that are granted by those privileges.\n`resources`:::: (list) A list of resource names against which the privileges\nshould be checked.\n\nNote that the `privileges` section above is identical to the\n<<security-api-has-privileges-request-body, request body of the other Has Privileges API>>.\n\n[[security-api-has-privileges-user-profile-response-body]]\n==== {api-response-body-title}\n\nA successful has privileges user profile API call returns a JSON structure that contains\ntwo fields:\n\n`has_privilege_uids`:: (list) The subset of the requested profile IDs of the users that have\n**all** the requested privileges.\n\n`errors`:: (object) Errors encountered while fulfilling the request. This field is absent if there is no error.\nIt does **not** include the profile IDs of the users that do not have all the requested privileges.\n+\n.Properties of objects in `errors`\n[%collapsible%open]\n====\n`count`:: (number) Total number of errors\n\n`details`:: (object) The detailed error report with keys being profile IDs and values being the exact errors.\n====\n\n[[security-api-has-privileges-user-profile-example]]\n==== {api-examples-title}\n\nThe following example checks whether the two users associated with the specified profiles have all the\nrequested set of cluster, index, and application privileges:\n\n[source,console]\n--------------------------------------------------\nPOST /_security/profile/_has_privileges\n{\n  \"uids\": [\n    \"u_LQPnxDxEjIH0GOUoFkZr5Y57YUwSkL9Joiq-g4OCbPc_0\",\n    \"u_rzRnxDgEHIH0GOUoFkZr5Y27YUwSk19Joiq=g4OCxxB_1\",\n    \"u_does-not-exist_0\"\n  ],\n  \"privileges\": {\n    \"cluster\": [ \"monitor\", \"create_snapshot\", \"manage_ml\" ],\n    \"index\" : [\n      {\n        \"names\": [ \"suppliers\", \"products\" ],\n        \"privileges\": [ \"create_doc\"]\n      },\n      {\n        \"names\": [ \"inventory\" ],\n        \"privileges\" : [ \"read\", \"write\" ]\n      }\n    ],\n    \"application\": [\n      {\n        \"application\": \"inventory_manager\",\n        \"privileges\" : [ \"read\", \"data:write/inventory\" ],\n        \"resources\" : [ \"product/1852563\" ]\n      }\n    ]\n  }\n}\n--------------------------------------------------\n// TEST[skip:TODO setup and tests will be possible once the profile uid is predictable]\n\nThe following example output indicates that only one of the three users has all the privileges\nand one of them is not found:\n\n[source,js]\n--------------------------------------------------\n{\n  \"has_privilege_uids\": [\"u_rzRnxDgEHIH0GOUoFkZr5Y27YUwSk19Joiq=g4OCxxB_1\"],\n  \"errors\": {\n    \"count\": 1,\n    \"details\": {\n      \"u_does-not-exist_0\": {\n        \"type\": \"resource_not_found_exception\",\n        \"reason\": \"profile document not found\"\n      }\n    }\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n"
}