{
    "meta": {
        "size": 6653,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-oidc-prepare-authentication.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "security-api-oidc-prepare-authentication",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[security-api-oidc-prepare-authentication]]\n=== OpenID Connect prepare authentication API\n++++\n<titleabbrev>OpenID Connect prepare authentication</titleabbrev>\n++++\n\nCreates an oAuth 2.0 authentication request as a URL string based on the\nconfiguration of the respective OpenID Connect authentication realm in {es}.\n\n[[security-api-oidc-prepare-authentication-request]]\n==== {api-request-title}\n\n`POST /_security/oidc/prepare`\n\n//[[security-api-oidc-prepare-authentication-prereqs]]\n//==== {api-prereq-title}\n\n[[security-api-oidc-prepare-authentication-desc]]\n==== {api-description-title}\n\nThe response of this API is a URL pointing to the Authorization Endpoint of the\nconfigured OpenID Connect Provider and can be used to redirect the browser of\nthe user in order to continue the authentication process.\n\n{es} exposes all the necessary OpenID Connect related functionality via the\nOpenID Connect APIs. These APIs are used internally by {kib} in order to provide\nOpenID Connect based authentication, but can also be used by other, custom web\napplications or other clients. See also\n<<security-api-oidc-authenticate,OpenID Connect authenticate API>>\nand <<security-api-oidc-logout,OpenID Connect logout API>>.\n\n[[security-api-oidc-prepare-authentication-request-body]]\n==== {api-request-body-title}\n\nThe following parameters can be specified in the body of the request:\n\n`realm`::\n  (Optional, string) The name of the OpenID Connect realm in {es} the configuration of which should\nbe used in order to generate the authentication request. Cannot be specified\nwhen `iss` is specified. One of `realm`, `iss` is required.\n\n`state`::\n  (Optional, string) Value used to maintain state between the authentication request and the\nresponse, typically used as a Cross-Site Request Forgery mitigation. If the\ncaller of the API doesn't provide a value, {es} will generate one with\nsufficient entropy itself and return it in the response.\n\n`nonce`::\n  (Optional, string) Value used to associate a Client session with an ID Token and to mitigate\nreplay attacks. If the caller of the API doesn't provide a value, {es} will\ngenerate one with sufficient entropy itself and return it in the response.\n\n`iss`::\n  (Optional, string) In the case of a 3rd Party initiated Single Sign On, this is the Issuer\nIdentifier for the OP that the RP is to send the Authentication Request to.\nCannot be specified when `realm` is specified. One of `realm`, `iss` is required.\n\n`login_hint`::\n  (Optional, string) In the case of a 3rd Party initiated Single Sign On, a string value to be\nincluded in the authentication request, as the `login_hint` parameter. This\nparameter is not valid when `realm` is specified\n\n\n[[security-api-oidc-prepare-authentication-example]]\n==== {api-examples-title}\n\nThe following example generates an authentication request for the OpenID Connect\nRealm `oidc1`:\n\n[source,console]\n--------------------------------------------------\nPOST /_security/oidc/prepare\n{\n  \"realm\" : \"oidc1\"\n}\n--------------------------------------------------\n\nThe following example output of the response contains the URI pointing to the Authorization Endpoint of the OpenID Connect Provider with all the parameters of\nthe Authentication Request, as HTTP GET parameters:\n\n[source,console-result]\n--------------------------------------------------\n{\n  \"redirect\" : \"http://127.0.0.1:8080/c2id-login?scope=openid&response_type=id_token&redirect_uri=https%3A%2F%2Fmy.fantastic.rp%2Fcb&state=4dbrihtIAt3wBTwo6DxK-vdk-sSyDBV8Yf0AjdkdT5I&nonce=WaBPH0KqPVdG5HHdSxPRjfoZbXMCicm5v1OiAj0DUFM&client_id=elasticsearch-rp\",\n  \"state\" : \"4dbrihtIAt3wBTwo6DxK-vdk-sSyDBV8Yf0AjdkdT5I\",\n  \"nonce\" : \"WaBPH0KqPVdG5HHdSxPRjfoZbXMCicm5v1OiAj0DUFM\",\n  \"realm\" : \"oidc1\"\n}\n--------------------------------------------------\n// TESTRESPONSE[s/http:.*elasticsearch-rp/\\$\\{body.redirect\\}/]\n// TESTRESPONSE[s/4dbrihtIAt3wBTwo6DxK-vdk-sSyDBV8Yf0AjdkdT5I/\\$\\{body.state\\}/]\n// TESTRESPONSE[s/WaBPH0KqPVdG5HHdSxPRjfoZbXMCicm5v1OiAj0DUFM/\\$\\{body.nonce\\}/]\n\nThe following example generates an authentication request for the OpenID Connect\nRealm `oidc1`, where the values for the state and the nonce have been generated\nby the client:\n\n[source,console]\n--------------------------------------------------\nPOST /_security/oidc/prepare\n{\n  \"realm\" : \"oidc1\",\n  \"state\" : \"lGYK0EcSLjqH6pkT5EVZjC6eIW5YCGgywj2sxROO\",\n  \"nonce\" : \"zOBXLJGUooRrbLbQk5YCcyC8AXw3iloynvluYhZ5\"\n}\n--------------------------------------------------\n\nThe following example output of the response contains the URI pointing to the Authorization Endpoint of the OpenID Connect Provider with all the parameters of\nthe Authentication Request, as HTTP GET parameters:\n\n[source,console-result]\n--------------------------------------------------\n{\n  \"redirect\" : \"http://127.0.0.1:8080/c2id-login?scope=openid&response_type=id_token&redirect_uri=https%3A%2F%2Fmy.fantastic.rp%2Fcb&state=lGYK0EcSLjqH6pkT5EVZjC6eIW5YCGgywj2sxROO&nonce=zOBXLJGUooRrbLbQk5YCcyC8AXw3iloynvluYhZ5&client_id=elasticsearch-rp\",\n  \"state\" : \"lGYK0EcSLjqH6pkT5EVZjC6eIW5YCGgywj2sxROO\",\n  \"nonce\" : \"zOBXLJGUooRrbLbQk5YCcyC8AXw3iloynvluYhZ5\",\n  \"realm\" : \"oidc1\"\n}\n--------------------------------------------------\n// TESTRESPONSE[s/http:.*elasticsearch-rp/\\$\\{body.redirect\\}/]\n\nThe following example generates an authentication request for a 3rd party\ninitiated single sign on, specifying the issuer that should be used for matching\nthe appropriate OpenID Connect Authentication realm:\n\n[source,console]\n--------------------------------------------------\nPOST /_security/oidc/prepare\n{\n  \"iss\" : \"http://127.0.0.1:8080\",\n  \"login_hint\": \"this_is_an_opaque_string\"\n}\n--------------------------------------------------\n\nThe following example output of the response contains the URI pointing to the Authorization Endpoint of the OpenID Connect Provider with all the parameters of\nthe Authentication Request, as HTTP GET parameters:\n\n[source,console-result]\n--------------------------------------------------\n{\n  \"redirect\" : \"http://127.0.0.1:8080/c2id-login?login_hint=this_is_an_opaque_string&scope=openid&response_type=id_token&redirect_uri=https%3A%2F%2Fmy.fantastic.rp%2Fcb&state=4dbrihtIAt3wBTwo6DxK-vdk-sSyDBV8Yf0AjdkdT5I&nonce=WaBPH0KqPVdG5HHdSxPRjfoZbXMCicm5v1OiAj0DUFM&client_id=elasticsearch-rp\",\n  \"state\" : \"4dbrihtIAt3wBTwo6DxK-vdk-sSyDBV8Yf0AjdkdT5I\",\n  \"nonce\" : \"WaBPH0KqPVdG5HHdSxPRjfoZbXMCicm5v1OiAj0DUFM\",\n  \"realm\" : \"oidc1\"\n}\n--------------------------------------------------\n// TESTRESPONSE[s/4dbrihtIAt3wBTwo6DxK-vdk-sSyDBV8Yf0AjdkdT5I/\\$\\{body.state\\}/]\n// TESTRESPONSE[s/WaBPH0KqPVdG5HHdSxPRjfoZbXMCicm5v1OiAj0DUFM/\\$\\{body.nonce\\}/]\n"
}