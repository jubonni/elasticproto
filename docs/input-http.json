{
    "meta": {
        "timestamp": "2024-11-01T03:02:52.716578",
        "size": 11256,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/input-http.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "input-http",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[input-http]]\n=== {watcher} HTTP input\n++++\n<titleabbrev>HTTP input</titleabbrev>\n++++\n\nUse the `http` input to submit a request to an HTTP endpoint and load the\nresponse into the watch execution context when the watch is triggered. See\n<<http-input-attributes>> for all of the supported attributes.\n\nWith the `http` input, you can:\n\n* Query external Elasticsearch clusters. The `http` input provides a way \n  to submit search requests to clusters other than the one {watcher} is running \n  on. This is useful when you're running a dedicated {watcher} cluster or if you \n  need to search clusters that are running different Elasticsearch versions.\n\n* Query Elasticsearch APIs other than the search API. For example, you might want\n  to load data from the <<cluster-nodes-stats,nodes stats>>, \n  <<cluster-health,cluster health>> or <<cluster-state,cluster state>> APIs.\n\n* Query external web services. The `http` input enables you to load data from\n  any service that exposes an HTTP endpoint. This provides a bridge\n  between Elasticsearch clusters and other systems.\n\n==== Querying external Elasticsearch clusters\n\nTo query an external Elasticsearch cluster, you specify the cluster's\n`host` and `port` attributes and the index's search endpoint as the `path`. \nIf you omit the search body, the request returns all documents in the specified\nindex: \n\n[source,js]\n--------------------------------------------------\n\"input\" : {\n  \"http\" : {\n    \"request\" : {\n      \"host\" : \"example.com\",\n      \"port\" : 9200,\n      \"path\" : \"/idx/_search\"\n    }\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n\nYou can use the full Elasticsearch <<query-dsl,Query DSL>> to perform\nmore sophisticated searches. For example, the following `http` input retrieves \nall documents that contain `event` in the `category` field:\n\n[source,js]\n--------------------------------------------------\n\"input\" : {\n  \"http\" : {\n    \"request\" : {\n      \"host\" : \"host.domain\",\n      \"port\" : 9200,\n      \"path\" : \"/idx/_search\",\n      \"body\" :  \"{\\\"query\\\" :  {  \\\"match\\\" : { \\\"category\\\" : \\\"event\\\"}}}\"\n    }\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n\n==== Calling Elasticsearch APIs\n\nTo load the data from other Elasticsearch APIs, specify the API\nendpoint as the `path` attribute. Use the `params` attribute to specify\nquery string parameters. For example, the following `http` input \ncalls the <<cluster-stats,cluster stats>> API and enables the `human` attribute:\n\n[source,js]\n--------------------------------------------------\n\"input\" : {\n  \"http\" : {\n    \"request\" : {\n      \"host\" : \"host.domain\",\n      \"port\" : 9200,\n      \"path\" : \"/_cluster/stats\",\n      \"params\" : {\n        \"human\" : \"true\" <1>\n      }\n    }\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n<1> Enabling this attribute returns the `bytes` values in the response in human\n    readable format.\n\n[[input-http-auth-basic-example]]\n==== Calling external web services\n\nYou can use `http` input to get data from any external web service. The `http`\ninput supports basic authentication. For example, the following input provides\na username and password to access `myservice`:\n\n[source,js]\n--------------------------------------------------\n\"input\" : {\n  \"http\" : {\n    \"request\" : {\n      \"host\" : \"host.domain\",\n      \"port\" : 9200,\n      \"path\" : \"/myservice\",\n      \"auth\" : {\n        \"basic\" : {\n          \"username\" : \"user\",\n          \"password\" : \"pass\"\n        }\n      }\n    }\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n\nYou can also pass in service-specific API keys and other information\nthrough the `params` attribute. For example, the following `http` \ninput loads the current weather forecast for Amsterdam from the\nhttp://openweathermap.org/appid[OpenWeatherMap] service:\n\n[source,js]\n--------------------------------------------------\n\"input\" : {\n  \"http\" : {\n    \"request\" : {\n      \"url\" : \"http://api.openweathermap.org/data/2.5/weather\",\n      \"params\" : {\n        \"lat\" : \"52.374031\",\n        \"lon\" : \"4.88969\",\n        \"appid\" : \"<your openweathermap appid>\"\n      }\n    }\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n\n===== Using token-based authentication\n\nYou can also call an API using a `Bearer token` instead of basic authentication. The `request.headers` object contains the HTTP headers:\n\n[source,js]\n--------------------------------------------------\n\"input\" : {\n  \"http\" : {\n    \"request\" : {\n      \"url\": \"https://api.example.com/v1/something\",\n      \"headers\": {\n        \"authorization\" : \"Bearer ABCD1234...\",\n        \"content-type\": \"application/json\"\n        # other headers params..\n        },\n      \"connection_timeout\": \"30s\"\n    }\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n\n==== Using templates\n\nThe `http` input supports templating. You can use <<templates,templates>> when\nspecifying the `path`, `body`, header values, and parameter values.\n\nFor example, the following snippet uses templates to specify what index to query\nand restrict the results to documents added within the last five minutes:\n\n[source,js]\n--------------------------------------------------\n\"input\" : {\n  \"http\" : {\n    \"request\" : {\n      \"host\" : \"host.domain\",\n      \"port\" : 9200,\n      \"path\" : \"/{{ctx.watch_id}}/_search\",\n      \"body\" : \"{\\\"query\\\" : {\\\"range\\\": {\\\"@timestamp\\\" : {\\\"from\\\": \\\"{{ctx.trigger.triggered_time}}||-5m\\\",\\\"to\\\": \\\"{{ctx.trigger.triggered_time}}\\\"}}}}\"\n      }\n    }\n  }\n--------------------------------------------------\n// NOTCONSOLE\n\n==== Accessing the HTTP response\n\nIf the response body is formatted in JSON or YAML, it is parsed and loaded into\nthe execution context. If the response body is not formatted in JSON or YAML, it \nis loaded into the payload's `_value` field. \n\nConditions, transforms, and actions access the response data through the \nexecution context. For example, if the response contains a `message` \nobject, you can use `ctx.payload.message` to access the message data. \n\nIn addition all the headers from the response can be accessed using the\n`ctx.payload._headers` field as well as the HTTP status code of the response using\n`ctx.payload._status_code`.\n\n      \n[[http-input-attributes]]\n==== HTTP input attributes\n\n[cols=\",^,^,\", options=\"header\"]\n|======\n| Name                          | Required | Default | Description\n\n| `request.scheme`              | no       | http    | Url scheme. Valid values are: `http` or `https`.\n\n| `request.host`                | yes      | -       | The host to connect to.\n\n| `request.port`                | yes      | -       | The port the http service is listening on.\n\n| `request.path`                | no       | -       | The URL path. The path can be static text or contain `mustache`\n                                                       <<templates,templates>>. URL query string parameters must be\n                                                       specified via the `request.params` attribute.\n\n| `request.method`              | no       | get     | The HTTP method. Supported values are: `head`, `get`, `post`,\n                                                       `put` and `delete`.\n\n| `request.headers`             | no       | -       | The HTTP request headers. The header values can be static text\n                                                       or include `mustache` <<templates,templates>>.\n\n| `request.params`              | no       | -       | The URL query string parameters. The parameter values can be\n                                                       static text or contain `mustache` <<templates,templates>>.\n\n| `request.url`                 | no       | -       | Allows you to set `request.scheme`, `request.host`, `request.port`\n                                                       and `request.params` add once by specifying a real URL, like\n                                                       `https://www.example.org:1234/mypath?foo=bar`. May not be combined\n                                                       with on of those four parameters. As those parameters are set,\n                                                       specifying them individually might overwrite them.\n\n| `request.auth.basic.username` | no       | -       | HTTP basic authentication username\n\n| `request.auth.basic.password` | no       | -       | HTTP basic authentication password\n\n| `request.proxy.host`          | no       | -       | The proxy host to use when connecting to the host.\n\n| `request.proxy.port`          | no       | -       | The proxy port to use when connecting to the host.\n\n| `request.connection_timeout`  | no       | 10s     | The timeout for setting up the http connection. If the connection\n                                                       could not be set up within this time, the input will timeout and\n                                                       fail.\n\n| `request.read_timeout`        | no       | 10s     | The timeout for reading data from http connection. If no response\n                                                       was received within this time, the input will timeout and fail.\n                                                      \n\n| `request.body`                | no       | -       | The HTTP request body. The body can be static text or include\n                                                       `mustache` <<templates,templates>>.\n\n| `extract`                     | no       | -       | A array of JSON keys to extract from the input response and\n                                                       use as payload. In cases when an input generates a large\n                                                       response this can be used to filter the relevant piece of\n                                                       the response to be used as payload.\n\n| `response_content_type`       | no       | json    | The expected content type the response body will contain.\n                                                       Supported values are `json`, `yaml` and `text`. If the\n                                                       format is `text` the `extract` attribute cannot exist.\n                                                       Note that this overrides the header that is returned in the\n                                                       HTTP response. If this is set to `text` the body of the\n                                                       response will be assigned and accessible to/via the `_value`\n                                                       variable of the payload.\n|======\n\nYou can reference the following variables in the execution context when\nspecifying the `path`, `params`, `headers` and `body` values:\n\n[options=\"header\"]\n|======\n| Name                         | Description\n| `ctx.watch_id`               | The id of the watch that is currently executing.\n| `ctx.execution_time`         | The time execution of this watch started.\n| `ctx.trigger.triggered_time` | The time this watch was triggered.\n| `ctx.trigger.scheduled_time` | The time this watch was supposed to be triggered.\n| `ctx.metadata.*`             | Any metadata associated with the watch.\n|======\n"
}