{
    "meta": {
        "timestamp": "2024-11-01T03:02:52.126579",
        "size": 6623,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-cartesian-centroid-aggregation.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "search-aggregations-metrics-cartesian-centroid-aggregation",
        "version": "8.15"
    },
    "doc": "[[search-aggregations-metrics-cartesian-centroid-aggregation]]\n=== Cartesian-centroid aggregation\n\n++++\n<titleabbrev>Cartesian-centroid</titleabbrev>\n++++\n\nA metric aggregation that computes the weighted {wikipedia}/Centroid[centroid] from all coordinate values for point and shape fields.\n\nExample:\n\n[source,console]\n--------------------------------------------------\nPUT /museums\n{\n  \"mappings\": {\n    \"properties\": {\n      \"location\": {\n        \"type\": \"point\"\n      }\n    }\n  }\n}\n\nPOST /museums/_bulk?refresh\n{\"index\":{\"_id\":1}}\n{\"location\": \"POINT (491.2350 5237.4081)\", \"city\": \"Amsterdam\", \"name\": \"NEMO Science Museum\"}\n{\"index\":{\"_id\":2}}\n{\"location\": \"POINT (490.1618 5236.9219)\", \"city\": \"Amsterdam\", \"name\": \"Museum Het Rembrandthuis\"}\n{\"index\":{\"_id\":3}}\n{\"location\": \"POINT (491.4722 5237.1667)\", \"city\": \"Amsterdam\", \"name\": \"Nederlands Scheepvaartmuseum\"}\n{\"index\":{\"_id\":4}}\n{\"location\": \"POINT (440.5200 5122.2900)\", \"city\": \"Antwerp\", \"name\": \"Letterenhuis\"}\n{\"index\":{\"_id\":5}}\n{\"location\": \"POINT (233.6389 4886.1111)\", \"city\": \"Paris\", \"name\": \"Mus\u00e9e du Louvre\"}\n{\"index\":{\"_id\":6}}\n{\"location\": \"POINT (232.7000 4886.0000)\", \"city\": \"Paris\", \"name\": \"Mus\u00e9e d'Orsay\"}\n\nPOST /museums/_search?size=0\n{\n  \"aggs\": {\n    \"centroid\": {\n      \"cartesian_centroid\": {\n        \"field\": \"location\" <1>\n      }\n    }\n  }\n}\n--------------------------------------------------\n\n<1> The `cartesian_centroid` aggregation specifies the field to use for computing the centroid, which must be a <<point>> or a <<shape>> type.\n\nThe above aggregation demonstrates how one would compute the centroid of the location field for all museums' documents.\n\nThe response for the above aggregation:\n\n[source,console-result]\n--------------------------------------------------\n{\n  ...\n  \"aggregations\": {\n    \"centroid\": {\n      \"location\": {\n        \"x\": 396.6213124593099,\n        \"y\": 5100.982991536458\n      },\n      \"count\": 6\n    }\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/\\.\\.\\./\"took\": $body.took,\"_shards\": $body._shards,\"hits\":$body.hits,\"timed_out\":false,/]\n\nThe `cartesian_centroid` aggregation is more interesting when combined as a sub-aggregation to other bucket aggregations.\n\nExample:\n\n[source,console]\n--------------------------------------------------\nPOST /museums/_search?size=0\n{\n  \"aggs\": {\n    \"cities\": {\n      \"terms\": { \"field\": \"city.keyword\" },\n      \"aggs\": {\n        \"centroid\": {\n          \"cartesian_centroid\": { \"field\": \"location\" }\n        }\n      }\n    }\n  }\n}\n--------------------------------------------------\n// TEST[continued]\n\nThe above example uses `cartesian_centroid` as a sub-aggregation to a\n<<search-aggregations-bucket-terms-aggregation, terms>> bucket aggregation for finding the central location for museums in each city.\n\nThe response for the above aggregation:\n\n[source,console-result]\n--------------------------------------------------\n{\n  ...\n  \"aggregations\": {\n    \"cities\": {\n      \"sum_other_doc_count\": 0,\n      \"doc_count_error_upper_bound\": 0,\n      \"buckets\": [\n        {\n          \"key\": \"Amsterdam\",\n          \"doc_count\": 3,\n          \"centroid\": {\n            \"location\": {\n              \"x\": 490.9563293457031,\n              \"y\": 5237.16552734375\n            },\n            \"count\": 3\n          }\n        },\n        {\n          \"key\": \"Paris\",\n          \"doc_count\": 2,\n          \"centroid\": {\n            \"location\": {\n              \"x\": 233.16944885253906,\n              \"y\": 4886.0556640625\n            },\n            \"count\": 2\n          }\n        },\n        {\n          \"key\": \"Antwerp\",\n          \"doc_count\": 1,\n          \"centroid\": {\n            \"location\": {\n              \"x\": 440.5199890136719,\n              \"y\": 5122.2900390625\n            },\n            \"count\": 1\n          }\n        }\n      ]\n    }\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/\\.\\.\\./\"took\": $body.took,\"_shards\": $body._shards,\"hits\":$body.hits,\"timed_out\":false,/]\n\n\n[discrete]\n[role=\"xpack\"]\n[[cartesian-centroid-aggregation-geo-shape]]\n==== Cartesian Centroid Aggregation on `shape` fields\n\nThe centroid metric for shapes is more nuanced than for points.\nThe centroid of a specific aggregation bucket containing shapes is the centroid of the highest-dimensionality shape type in the bucket.\nFor example, if a bucket contains shapes consisting of polygons and lines, then the lines do not contribute to the centroid metric.\nEach type of shape's centroid is calculated differently.\nEnvelopes and circles ingested via the <<ingest-circle-processor>> are treated as polygons.\n\n|===\n|Geometry Type | Centroid Calculation\n\n|[Multi]Point\n|equally weighted average of all the coordinates\n\n|[Multi]LineString\n|a weighted average of all the centroids of each segment, where the weight of each segment is its length in the same units as the coordinates\n\n|[Multi]Polygon\n|a weighted average of all the centroids of all the triangles of a polygon where the triangles are formed by every two consecutive vertices and the starting-point.\nholes have negative weights. weights represent the area of the triangle is calculated in the square of the units of the coordinates\n\n|GeometryCollection\n|The centroid of all the underlying geometries with the highest dimension. If Polygons and Lines and/or Points, then lines and/or points are ignored.\nIf Lines and Points, then points are ignored\n|===\n\nExample:\n\n[source,console]\n--------------------------------------------------\nPUT /places\n{\n  \"mappings\": {\n    \"properties\": {\n      \"geometry\": {\n        \"type\": \"shape\"\n      }\n    }\n  }\n}\n\nPOST /places/_bulk?refresh\n{\"index\":{\"_id\":1}}\n{\"name\": \"NEMO Science Museum\", \"geometry\": \"POINT(491.2350 5237.4081)\" }\n{\"index\":{\"_id\":2}}\n{\"name\": \"Sportpark De Weeren\", \"geometry\": { \"type\": \"Polygon\", \"coordinates\": [ [ [ 496.5305328369141, 5239.347642069457 ], [ 496.6979026794433, 5239.1721758934835 ], [ 496.9425201416015, 5239.238958618537 ], [ 496.7944622039794, 5239.420969150824 ], [ 496.5305328369141, 5239.347642069457 ] ] ] } }\n\nPOST /places/_search?size=0\n{\n  \"aggs\": {\n    \"centroid\": {\n      \"cartesian_centroid\": {\n        \"field\": \"geometry\"\n      }\n    }\n  }\n}\n--------------------------------------------------\n// TEST\n\n[source,console-result]\n--------------------------------------------------\n{\n  ...\n  \"aggregations\": {\n    \"centroid\": {\n      \"location\": {\n        \"x\": 496.74041748046875,\n        \"y\": 5239.29638671875\n      },\n      \"count\": 2\n    }\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/\\.\\.\\./\"took\": $body.took,\"_shards\": $body._shards,\"hits\":$body.hits,\"timed_out\":false,/]\n"
}