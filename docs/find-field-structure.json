{
    "meta": {
        "size": 12235,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/find-field-structure.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": false,
        "title": "find-field-structure",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[find-field-structure]]\n= Find field structure API\n\nFinds the structure of a field in an Elasticsearch index.\n\n[discrete]\n[[find-field-structure-request]]\n== {api-request-title}\n\n`GET _text_structure/find_field_structure`\n\n[discrete]\n[[find-field-structure-prereqs]]\n== {api-prereq-title}\n\n* If the {es} {security-features} are enabled, you must have `monitor_text_structure` or\n`monitor` cluster privileges to use this API. See\n<<security-privileges>>.\n\n[discrete]\n[[find-field-structure-desc]]\n== {api-description-title}\n\nThis API provides a starting point for extracting further information from log messages\nalready ingested into {es}. For example, if you have ingested data into a very simple\nindex that has just `@timestamp` and `message` fields, you can use this API to\nsee what common structure exists in the `message` field.\n\nThe response from the API contains:\n\n* Sample messages.\n* Statistics that reveal the most common values for all fields detected within\nthe text and basic numeric statistics for numeric fields.\n* Information about the structure of the text, which is useful when you write\ningest configurations to index it or similarly formatted text.\n* Appropriate mappings for an {es} index, which you could use to ingest the text.\n\nAll this information can be calculated by the structure finder with no guidance.\nHowever, you can optionally override some of the decisions about the text\nstructure by specifying one or more query parameters.\n\nDetails of the output can be seen in the <<find-field-structure-examples,examples>>.\n\nIf the structure finder produces unexpected results,\nspecify the `explain` query parameter and an `explanation` will appear in\nthe response. It helps determine why the returned structure was\nchosen.\n\n[discrete]\n[[find-field-structure-query-parms]]\n== {api-query-parms-title}\n\n`index`::\n(Required, string) The name of the index containing the field.\n\n`field`::\n(Required, string) The name of the field that's analyzed.\n\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-column-names]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-delimiter]\n\n`documents_to_sample`::\n(Optional, unsigned integer) The number of documents to include in the structural\nanalysis. The minimum is 2; the default is 1000.\n\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-explain]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-format]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-grok-pattern]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-ecs-compatibility]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-quote]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-should-trim-fields]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-timeout]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-timestamp-field]\ninclude::{es-ref-dir}/text-structure/apis/find-structure-shared.asciidoc[tag=param-timestamp-format]\n\n[discrete]\n[[find-field-structure-examples]]\n== {api-examples-title}\n\n[discrete]\n[[find-field-structure-example]]\n=== Analyzing Elasticsearch log files\n\nSuppose you have a list of {es} log messages in an index.\nYou can analyze them with the `find_field_structure` endpoint as follows:\n\n[source,console]\n----\nPOST _bulk?refresh=true\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:36,256][INFO ][o.a.l.u.VectorUtilPanamaProvider] [laptop] Java vector incubator API enabled; uses preferredBitSize=128\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,038][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [repository-url]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,042][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [rest-root]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,043][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [x-pack-core]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,043][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [x-pack-redact]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,043][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [ingest-user-agent]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,044][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [x-pack-monitoring]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,044][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [repository-s3]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,044][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [x-pack-analytics]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,044][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [x-pack-ent-search]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,044][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [x-pack-autoscaling]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,044][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [lang-painless]]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,059][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [lang-expression]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:41,059][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [x-pack-eql]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:43,291][INFO ][o.e.e.NodeEnvironment    ] [laptop] heap size [16gb], compressed ordinary object pointers [true]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:46,098][INFO ][o.e.x.s.Security         ] [laptop] Security is enabled\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:47,227][INFO ][o.e.x.p.ProfilingPlugin  ] [laptop] Profiling is enabled\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:47,259][INFO ][o.e.x.p.ProfilingPlugin  ] [laptop] profiling index templates will not be installed or reinstalled\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:47,755][INFO ][o.e.i.r.RecoverySettings ] [laptop] using rate limit [40mb] with [default=40mb, read=0b, write=0b, max=0b]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:47,787][INFO ][o.e.d.DiscoveryModule    ] [laptop] using discovery type [multi-node] and seed hosts providers [settings]\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:49,188][INFO ][o.e.n.Node               ] [laptop] initialized\"}\n{\"index\":{\"_index\":\"test-logs\"}}\n{\"message\":\"[2024-03-05T10:52:49,199][INFO ][o.e.n.Node               ] [laptop] starting ...\"}\n\nGET _text_structure/find_field_structure?index=test-logs&field=message\n----\n// TEST\n\nIf the request does not encounter errors, you receive the following result:\n\n[source,console-result]\n----\n{\n  \"num_lines_analyzed\" : 22,\n  \"num_messages_analyzed\" : 22,\n  \"sample_start\" : \"[2024-03-05T10:52:36,256][INFO ][o.a.l.u.VectorUtilPanamaProvider] [laptop] Java vector incubator API enabled; uses preferredBitSize=128\\n[2024-03-05T10:52:41,038][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [repository-url]\\n\", <3>\n  \"charset\" : \"UTF-8\",\n  \"format\" : \"semi_structured_text\",\n  \"multiline_start_pattern\" : \"^\\\\[\\\\b\\\\d{4}-\\\\d{2}-\\\\d{2}[T ]\\\\d{2}:\\\\d{2}\",\n  \"grok_pattern\" : \"\\\\[%{TIMESTAMP_ISO8601:timestamp}\\\\]\\\\[%{LOGLEVEL:loglevel} \\\\]\\\\[.*\",\n  \"ecs_compatibility\" : \"disabled\",\n  \"timestamp_field\" : \"timestamp\",\n  \"joda_timestamp_formats\" : [\n    \"ISO8601\"\n  ],\n  \"java_timestamp_formats\" : [\n    \"ISO8601\"\n  ],\n  \"need_client_timezone\" : true,\n  \"mappings\" : {\n    \"properties\" : {\n      \"@timestamp\" : {\n        \"type\" : \"date\"\n      },\n      \"loglevel\" : {\n        \"type\" : \"keyword\"\n      },\n      \"message\" : {\n        \"type\" : \"text\"\n      }\n    }\n  },\n  \"ingest_pipeline\" : {\n    \"description\" : \"Ingest pipeline created by text structure finder\",\n    \"processors\" : [\n      {\n        \"grok\" : {\n          \"field\" : \"message\",\n          \"patterns\" : [\n            \"\\\\[%{TIMESTAMP_ISO8601:timestamp}\\\\]\\\\[%{LOGLEVEL:loglevel} \\\\]\\\\[.*\"\n          ],\n          \"ecs_compatibility\" : \"disabled\"\n        }\n      },\n      {\n        \"date\" : {\n          \"field\" : \"timestamp\",\n          \"timezone\" : \"{{ event.timezone }}\",\n          \"formats\" : [\n            \"ISO8601\"\n          ]\n        }\n      },\n      {\n        \"remove\" : {\n          \"field\" : \"timestamp\"\n        }\n      }\n    ]\n  },\n  \"field_stats\" : {\n    \"loglevel\" : {\n      \"count\" : 22,\n      \"cardinality\" : 1,\n      \"top_hits\" : [\n        {\n          \"value\" : \"INFO\",\n          \"count\" : 22\n        }\n      ]\n    },\n    \"message\" : {\n      \"count\" : 22,\n      \"cardinality\" : 22,\n      \"top_hits\" : [\n        {\n          \"value\" : \"[2024-03-05T10:52:36,256][INFO ][o.a.l.u.VectorUtilPanamaProvider] [laptop] Java vector incubator API enabled; uses preferredBitSize=128\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"[2024-03-05T10:52:41,038][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [repository-url]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"[2024-03-05T10:52:41,042][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [rest-root]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"[2024-03-05T10:52:41,043][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [ingest-user-agent]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"[2024-03-05T10:52:41,043][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [x-pack-core]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"[2024-03-05T10:52:41,043][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [x-pack-redact]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"[2024-03-05T10:52:41,044][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [lang-painless]]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"[2024-03-05T10:52:41,044][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [repository-s3]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"[2024-03-05T10:52:41,044][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [x-pack-analytics]\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"[2024-03-05T10:52:41,044][INFO ][o.e.p.PluginsService     ] [laptop] loaded module [x-pack-autoscaling]\",\n          \"count\" : 1\n        }\n      ]\n    },\n    \"timestamp\" : {\n      \"count\" : 22,\n      \"cardinality\" : 14,\n      \"earliest\" : \"2024-03-05T10:52:36,256\",\n      \"latest\" : \"2024-03-05T10:52:49,199\",\n      \"top_hits\" : [\n        {\n          \"value\" : \"2024-03-05T10:52:41,044\",\n          \"count\" : 6\n        },\n        {\n          \"value\" : \"2024-03-05T10:52:41,043\",\n          \"count\" : 3\n        },\n        {\n          \"value\" : \"2024-03-05T10:52:41,059\",\n          \"count\" : 2\n        },\n        {\n          \"value\" : \"2024-03-05T10:52:36,256\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2024-03-05T10:52:41,038\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2024-03-05T10:52:41,042\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2024-03-05T10:52:43,291\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2024-03-05T10:52:46,098\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2024-03-05T10:52:47,227\",\n          \"count\" : 1\n        },\n        {\n          \"value\" : \"2024-03-05T10:52:47,259\",\n          \"count\" : 1\n        }\n      ]\n    }\n  }\n}\n----\n// TESTRESPONSE[s/\"sample_start\" : \".*\",/\"sample_start\" : \"$body.sample_start\",/]\n// The substitution is because the text is pre-processed by the test harness,\n// so the fields may get reordered in the JSON the endpoint sees\n\nFor a detailed description of the response format, or for additional examples\non ingesting delimited text (such as CSV) or newline-delimited JSON, refer to the\n<<find-structure-examples,examples of the find text structure endpoint>>.\n"
}