{
    "meta": {
        "timestamp": "2024-11-01T03:07:10.350272",
        "size": 5745,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-string-stats-aggregation.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "search-aggregations-metrics-string-stats-aggregation",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[search-aggregations-metrics-string-stats-aggregation]]\n=== String stats aggregation\n++++\n<titleabbrev>String stats</titleabbrev>\n++++\n\nA `multi-value` metrics aggregation that computes statistics over string values extracted from the aggregated documents.\nThese values can be retrieved either from specific `keyword` fields.\n\nThe string stats aggregation returns the following results:\n\n* `count` - The number of non-empty fields counted.\n* `min_length` - The length of the shortest term.\n* `max_length` - The length of the longest term.\n* `avg_length` - The average length computed over all terms.\n* `entropy` - The {wikipedia}/Entropy_(information_theory)[Shannon Entropy] value computed over all terms collected by\nthe aggregation. Shannon entropy quantifies the amount of information contained in the field. It is a very useful metric for\nmeasuring a wide range of properties of a data set, such as diversity, similarity, randomness etc.\n\nFor example:\n\n[source,console]\n--------------------------------------------------\nPOST /my-index-000001/_search?size=0\n{\n  \"aggs\": {\n    \"message_stats\": { \"string_stats\": { \"field\": \"message.keyword\" } }\n  }\n}\n--------------------------------------------------\n// TEST[setup:messages]\n\nThe above aggregation computes the string statistics for the `message` field in all documents. The aggregation type\nis `string_stats` and the `field` parameter defines the field of the documents the stats will be computed on.\nThe above will return the following:\n\n[source,console-result]\n--------------------------------------------------\n{\n  ...\n\n  \"aggregations\": {\n    \"message_stats\": {\n      \"count\": 5,\n      \"min_length\": 24,\n      \"max_length\": 30,\n      \"avg_length\": 28.8,\n      \"entropy\": 3.94617750050791\n    }\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/\\.\\.\\./\"took\": $body.took,\"timed_out\": false,\"_shards\": $body._shards,\"hits\": $body.hits,/]\n\nThe name of the aggregation (`message_stats` above) also serves as the key by which the aggregation result can be retrieved from\nthe returned response.\n\n==== Character distribution\n\nThe computation of the Shannon Entropy value is based on the probability of each character appearing in all terms collected\nby the aggregation. To view the probability distribution for all characters, we can add the `show_distribution` (default: `false`) parameter.\n\n[source,console]\n--------------------------------------------------\nPOST /my-index-000001/_search?size=0\n{\n  \"aggs\": {\n    \"message_stats\": {\n      \"string_stats\": {\n        \"field\": \"message.keyword\",\n        \"show_distribution\": true  <1>\n      }\n    }\n  }\n}\n--------------------------------------------------\n// TEST[setup:messages]\n\n<1> Set the `show_distribution` parameter to `true`, so that probability distribution for all characters is returned in the results.\n\n[source,console-result]\n--------------------------------------------------\n{\n  ...\n\n  \"aggregations\": {\n    \"message_stats\": {\n      \"count\": 5,\n      \"min_length\": 24,\n      \"max_length\": 30,\n      \"avg_length\": 28.8,\n      \"entropy\": 3.94617750050791,\n      \"distribution\": {\n        \" \": 0.1527777777777778,\n        \"e\": 0.14583333333333334,\n        \"s\": 0.09722222222222222,\n        \"m\": 0.08333333333333333,\n        \"t\": 0.0763888888888889,\n        \"h\": 0.0625,\n        \"a\": 0.041666666666666664,\n        \"i\": 0.041666666666666664,\n        \"r\": 0.041666666666666664,\n        \"g\": 0.034722222222222224,\n        \"n\": 0.034722222222222224,\n        \"o\": 0.034722222222222224,\n        \"u\": 0.034722222222222224,\n        \"b\": 0.027777777777777776,\n        \"w\": 0.027777777777777776,\n        \"c\": 0.013888888888888888,\n        \"E\": 0.006944444444444444,\n        \"l\": 0.006944444444444444,\n        \"1\": 0.006944444444444444,\n        \"2\": 0.006944444444444444,\n        \"3\": 0.006944444444444444,\n        \"4\": 0.006944444444444444,\n        \"y\": 0.006944444444444444\n      }\n    }\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/\\.\\.\\./\"took\": $body.took,\"timed_out\": false,\"_shards\": $body._shards,\"hits\": $body.hits,/]\n\nThe `distribution` object shows the probability of each character appearing in all terms. The characters are sorted by descending probability.\n\n==== Script\n\nIf you need to get the `string_stats` for something more complex than a single\nfield, run the aggregation on a <<runtime,runtime field>>.\n\n[source,console]\n----\nPOST /my-index-000001/_search\n{\n  \"size\": 0,\n  \"runtime_mappings\": {\n    \"message_and_context\": {\n      \"type\": \"keyword\",\n      \"script\": \"\"\"\n        emit(doc['message.keyword'].value + ' ' + doc['context.keyword'].value)\n      \"\"\"\n    }\n  },\n  \"aggs\": {\n    \"message_stats\": {\n      \"string_stats\": { \"field\": \"message_and_context\" }\n    }\n  }\n}\n----\n// TEST[setup:messages]\n// TEST[s/_search/_search?filter_path=aggregations/]\n\n////\n[source,console-result]\n----\n{\n  \"aggregations\": {\n    \"message_stats\": {\n      \"count\": 5,\n      \"min_length\": 28,\n      \"max_length\": 34,\n      \"avg_length\": 32.8,\n      \"entropy\": 3.9797778402765784\n    }\n  }\n}\n----\n////\n\n==== Missing value\n\nThe `missing` parameter defines how documents that are missing a value should be treated.\nBy default they will be ignored but it is also possible to treat them as if they had a value.\n\n[source,console]\n--------------------------------------------------\nPOST /my-index-000001/_search?size=0\n{\n  \"aggs\": {\n    \"message_stats\": {\n      \"string_stats\": {\n        \"field\": \"message.keyword\",\n        \"missing\": \"[empty message]\" <1>\n      }\n    }\n  }\n}\n--------------------------------------------------\n// TEST[setup:messages]\n\n<1> Documents without a value in the `message` field will be treated as documents that have the value `[empty message]`.\n"
}