{
    "meta": {
        "timestamp": "2024-11-01T03:07:09.221276",
        "size": 8365,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/field-usage-stats.html",
        "type": "documentation",
        "role": [
            "child_attributes"
        ],
        "has_code": true,
        "title": "field-usage-stats",
        "version": "8.15"
    },
    "doc": "[[field-usage-stats]]\n=== Field usage stats API\n++++\n<titleabbrev>Field usage stats</titleabbrev>\n++++\n\nexperimental[]\n\nReturns field usage information for each shard and field\nof an index.\nField usage statistics are automatically captured when\nqueries are running on a cluster. A shard-level search\nrequest that accesses a given field, even if multiple times\nduring that request, is counted as a single use.\n\n[source,console]\n--------------------------------------------------\nGET /my-index-000001/_field_usage_stats\n--------------------------------------------------\n// TEST[setup:messages]\n\n[[field-usage-stats-api-request]]\n==== {api-request-title}\n\n`GET /<index>/_field_usage_stats`\n\n[[field-usage-stats-api-request-prereqs]]\n==== {api-prereq-title}\n\n* If the {es} {security-features} are enabled, you must have the `manage`\n<<privileges-list-indices,index privilege>> for the target index or index alias.\n\n[[field-usage-stats-api-path-params]]\n==== {api-path-parms-title}\n\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=index]\n\n[[field-usage-stats-api-query-params]]\n==== {api-query-parms-title}\n\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=allow-no-indices]\n\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=expand-wildcards]\n\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=index-ignore-unavailable]\n\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=wait_for_active_shards]\n\n`fields`::\n+\n--\n(Optional, string)\nComma-separated list or wildcard expressions of fields\nto include in the statistics.\n--\n\n[role=\"child_attributes\"]\n[[field-usage-stats-api-response-body]]\n==== {api-response-body-title}\nThe response body reports the per-shard usage count of the data structures that back the fields in the index.\nA given request will increment each count by a maximum value of 1, even if the request accesses the same field multiple times.\n\n`any`::\n(integer)\nDenotes any kind of use of the field (e.g. via the _inverted index_, _stored fields_, _doc values_, etc.)\nsuch that any usage is counted once for a given search request.\n\n`inverted_index`::\n(object)\nThe _inverted index_ is enabled by the <<mapping-index,`index`>> mapping parameter and configured by setting the <<index-options,`index_options`>> for the field.\n+\n.Properties of `inverted_index`:\n[%collapsible%open]\n====\n`terms`::\n(integer)\nDenotes the usages of _terms_ in the _inverted index_, answering the question \"Is this field's inverted index used?\".\n\n`postings`::\n(integer)\nDenotes the usage of the _posting list_ which contains the document ids for a given term.\n\n`proximity`::\n(integer)\nDenotes any kind of usage of either _positions_, _offsets_ or _payloads_ in the _inverted index_\nsuch that any usage is counted once for a given search request.\n\n`positions`::\n(integer)\nDenotes the usage of _position_ data (order of the term) in the _inverted index_.\n\n`term_frequencies`::\n(integer)\nDenotes the usage of the _term frequencies_ in the _inverted index_ which are used to calculate scores.\n\n`offsets`::\n(integer)\nDenotes the usage of the _offsets_ in the _inverted index_ which store the start and end character offsets of the terms.\n\n`payloads`::\n(integer)\nDenotes the usage of _payloads_ in the _inverted index_,\ne.g. via the <<analysis-delimited-payload-tokenfilter, delimited payload token filter>>, or by user-defined analysis components and plugins.\n\n====\n\n`stored_fields`::\n(integer)\nDenotes the usage of _stored fields_. These are enabled via the <<mapping-store,`store`>> mapping option,\nand accessed by specifying the <<stored-fields, `stored_fields`>> query option.\nNote that the <<mapping-source-field,`_source`>> and <<mapping-id-field, `_id`>> fields are stored by default and their usage is counted here.\n\n`doc_values`::\n(integer)\nDenotes the usage of _doc values_, which are primarily used for sorting and aggregations. These are enabled via the <<doc-values,`doc_values`>> mapping parameter.\n\n`points`::\n(integer)\nDenotes the usage of the Lucene _PointValues_ which are the basis of most numeric _field data types_, including <<spatial_datatypes, spacial data types>>, <<number,numbers>>, <<_core_datatypes,dates>>, and more.\nThese are used by queries/aggregations for ranges, counts, bucketing, min/max, histograms, spacial, etc.\n\n`norms`::\n(integer)\nDenotes the usage of <<norms,_norms_>> which contain index-time boost values used for scoring.\n\n`term_vectors`::\n(integer)\nDenotes the usage of <<term-vector,_term vectors_>> which allow for a document's terms to be retrieved at search time.\nUsages include <<highlighting,highlighting>> and the <<query-dsl-mlt-query,More Like This Query>>.\n\n`knn_vectors`::\n(integer)\nDenotes the usage of the <<dense-vector,_knn_vectors_>> field type,\nprimarily used for <<knn-search,k-nearest neighbor (kNN) search>>.\n\n[[field-usage-stats-api-example]]\n==== {api-examples-title}\n\n//////////////////////////\n\n[source,console]\n--------------------------------------------------\nPOST /my-index-000001/_search\n{\n  \"query\" : {\n    \"match\" : { \"context\" : \"bar\" }\n  },\n  \"aggs\": {\n    \"message_stats\": {\n      \"string_stats\": {\n        \"field\": \"message.keyword\",\n        \"show_distribution\": true\n      }\n    }\n  }\n}\n--------------------------------------------------\n// TEST[setup:messages]\n\n//////////////////////////\n\nThe following request retrieves field usage information of index `my-index-000001`\non the currently available shards.\n\n[source,console]\n--------------------------------------------------\nGET /my-index-000001/_field_usage_stats\n--------------------------------------------------\n// TEST[continued]\n\nThe API returns the following response:\n\n[source,console-response]\n--------------------------------------------------\n{\n    \"_shards\": {\n        \"total\": 1,\n        \"successful\": 1,\n        \"failed\": 0\n    },\n    \"my-index-000001\": {\n        \"shards\": [\n            {\n                \"tracking_id\": \"MpOl0QlTQ4SYYhEe6KgJoQ\",\n                \"tracking_started_at_millis\": 1625558985010,\n                \"routing\": {\n                    \"state\": \"STARTED\",\n                    \"primary\": true,\n                    \"node\": \"gA6KeeVzQkGURFCUyV-e8Q\",\n                    \"relocating_node\": null\n                },\n                \"stats\" : {\n                    \"all_fields\": { <1>\n                        \"any\": \"6\",\n                        \"inverted_index\": {\n                            \"terms\" : 1,\n                            \"postings\" : 1,\n                            \"proximity\" : 1,\n                            \"positions\" : 0,\n                            \"term_frequencies\" : 1,\n                            \"offsets\" : 0,\n                            \"payloads\" : 0\n                        },\n                        \"stored_fields\" : 2,\n                        \"doc_values\" : 1,\n                        \"points\" : 0,\n                        \"norms\" : 1,\n                        \"term_vectors\" : 0,\n                        \"knn_vectors\" : 0\n                    },\n                    \"fields\": {\n                        \"_id\": { <2>\n                            \"any\" : 1,\n                            \"inverted_index\": {\n                                \"terms\" : 1,\n                                \"postings\" : 1,\n                                \"proximity\" : 1,\n                                \"positions\" : 0,\n                                \"term_frequencies\" : 1,\n                                \"offsets\" : 0,\n                                \"payloads\" : 0\n                            },\n                            \"stored_fields\" : 1,\n                            \"doc_values\" : 0,\n                            \"points\" : 0,\n                            \"norms\" : 0,\n                            \"term_vectors\" : 0,\n                            \"knn_vectors\" : 0\n                        },\n                        \"_source\": {...},\n                        \"context\": {...},\n                        \"message.keyword\": {...}\n                    }\n                }\n            }\n        ]\n    }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/: \\{\\.\\.\\.\\}/: $body.$_path/]\n// TESTRESPONSE[s/: (\\-)?[0-9]+/: $body.$_path/]\n// TESTRESPONSE[s/: \"[^\"]*\"/: $body.$_path/]\n<1> Reports the sums of the usage-counts for all fields in the index (on the listed shard).\n<2> The field name for which the following usage-counts are reported (on the listed shard).\n"
}