{
    "meta": {
        "timestamp": "2024-11-01T03:07:08.837275",
        "size": 4260,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-change-point-aggregation.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "search-aggregations-change-point-aggregation",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[search-aggregations-change-point-aggregation]]\n=== Change point aggregation\n++++\n<titleabbrev>Change point</titleabbrev>\n++++\n\nexperimental::[]\n\nA sibling pipeline that detects, spikes, dips, and change points in a metric. \nGiven a distribution of values provided by the sibling multi-bucket aggregation, \nthis aggregation indicates the bucket of any spike or dip and/or the bucket at \nwhich the largest change in the distribution of values, if they are \nstatistically significant. \n\nTIP: It is recommended to use the change point aggregation to detect changes in \ntime-based data, however, you can use any metric to create buckets.\n\n\n\n[[change-point-agg-syntax]]\n==== Parameters\n\n`buckets_path`::\n(Required, string)\nPath to the buckets that contain one set of values in which to detect a change \npoint. There must be at least 22 bucketed values. Fewer than 1,000 is preferred.\nFor syntax, see <<buckets-path-syntax>>.\n\n==== Syntax\n\nA `change_point` aggregation looks like this in isolation:\n\n[source,js]\n--------------------------------------------------\n{\n  \"change_point\": {\n    \"buckets_path\": \"date_histogram>_count\" <1>\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n<1> The buckets containing the values to test against.\n\n[[change-point-agg-response]]\n==== Response body\n\n`bucket`::\n(Optional, object)\nValues of the bucket that indicates the discovered change point. Not returned if \nno change point was found. All the aggregations in the bucket are returned as \nwell.\n+\n.Properties of bucket\n[%collapsible%open]\n====\n`key`:::\n(value)\nThe key of the bucket matched. Could be string or numeric.\n\n`doc_count`:::\n(number)\nThe document count of the bucket.\n====\n\n`type`::\n(object)\nThe found change point type and its related values. Possible types:\n+\n--\n* `dip`: a significant dip occurs at this change point\n* `distribution_change`: the overall distribution of the values has changed \nsignificantly\n* `non_stationary`: there is no change point, but the values are not from a \nstationary distribution\n* `spike`: a significant spike occurs at this point\n* `stationary`: no change point found\n* `step_change`: the change indicates a statistically significant step up or \ndown in value distribution\n* `trend_change`: there is an overall trend change occurring at this point\n--\n\n==== Example\n\n\nThe following example uses the Kibana sample data logs data set.\n\n[source,js]\n--------------------------------------------------\nGET kibana_sample_data_logs/_search\n{\n  \"aggs\": {\n    \"date\":{ <1>\n      \"date_histogram\": {\n        \"field\": \"@timestamp\",\n        \"fixed_interval\": \"1d\"\n      },\n      \"aggs\": {\n        \"avg\": { <2>\n          \"avg\": {\n            \"field\": \"bytes\"\n          }\n        }\n      }\n    },\n    \"change_points_avg\": { <3>\n      \"change_point\": {\n        \"buckets_path\": \"date>avg\" <4>\n      }\n    }\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n<1> A date histogram aggregation that creates buckets with one day long \ninterval.\n<2> A sibling aggregation of the `date` aggregation that calculates the average \nvalue of the `bytes` field within every bucket.\n<3> The change point detection aggregation configuration object.\n<4> The path of the aggregation values to detect change points. In this case, \nthe input of the change point aggregation is the value of `avg` which is a \nsibling aggregation of `date`.\n\n\nThe request returns a response that is similar to the following: \n\n[source,js]\n--------------------------------------------------\n    \"change_points_avg\" : {\n      \"bucket\" : {\n        \"key\" : \"2023-04-29T00:00:00.000Z\", <1>\n        \"doc_count\" : 329, <2>\n        \"avg\" : { <3>\n          \"value\" : 4737.209726443769\n        }\n      },\n      \"type\" : { <4>\n        \"dip\" : {\n          \"p_value\" : 3.8999455212466465e-10, <5>\n          \"change_point\" : 41 <6>\n        }\n      }\n    }\n--------------------------------------------------\n// NOTCONSOLE\n<1> The bucket key that is the change point.\n<2> The number of documents in that bucket.\n<3> Aggregated values in the bucket.\n<4> Type of change found.\n<5> The `p_value` indicates how extreme the change is; lower values indicate \ngreater change.\n<6> The specific bucket where the change occurs (indexing starts at `0`).\n"
}