{
    "meta": {
        "timestamp": "2024-11-01T03:07:10.476281",
        "size": 5591,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/tutorial-manage-new-data-stream.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "tutorial-manage-new-data-stream",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[tutorial-manage-new-data-stream]]\n=== Tutorial: Create a data stream with a lifecycle\n\nTo create a data stream with a built-in lifecycle, follow these steps:\n\n. <<create-index-template-with-lifecycle>>\n. <<create-data-stream-with-lifecycle>>\n. <<retrieve-lifecycle-information>>\n\n[discrete]\n[[create-index-template-with-lifecycle]]\n==== Create an index template\n\nA data stream requires a matching <<index-templates,index template>>. You can configure the data stream lifecycle by\nsetting the `lifecycle` field in the index template the same as you do for mappings and index settings. You can define an\nindex template that sets a lifecycle as follows:\n\n* Include the `data_stream` object to enable data streams.\n\n* Define the lifecycle in the template section or include a composable template that defines the lifecycle.\n\n* Use a priority higher than `200` to avoid collisions with built-in templates.\nSee <<avoid-index-pattern-collisions>>.\n\nYou can use the <<indices-put-template,create index template API>>.\n\n[source,console]\n--------------------------------------------------\nPUT _index_template/my-index-template\n{\n  \"index_patterns\": [\"my-data-stream*\"],\n  \"data_stream\": { },\n  \"priority\": 500,\n  \"template\": {\n    \"lifecycle\": {\n      \"data_retention\": \"7d\"\n    }\n  },\n  \"_meta\": {\n    \"description\": \"Template with data stream lifecycle\"\n  }\n}\n--------------------------------------------------\n\n[discrete]\n[[create-data-stream-with-lifecycle]]\n==== Create a data stream\n\nYou can create a data stream in two ways:\n\n. By manually creating the stream using the <<indices-create-data-stream,create data stream API>>. The stream's name must\nstill match one of your template's index patterns.\n+\n[source,console]\n--------------------------------------------------\nPUT _data_stream/my-data-stream\n--------------------------------------------------\n// TEST[continued]\n\n. By <<add-documents-to-a-data-stream,indexing requests>> that\ntarget the stream's name. This name must match one of your index template's index patterns.\n+\n[source,console]\n--------------------------------------------------\nPUT my-data-stream/_bulk\n{ \"create\":{ } }\n{ \"@timestamp\": \"2099-05-06T16:21:15.000Z\", \"message\": \"192.0.2.42 - - [06/May/2099:16:21:15 +0000] \\\"GET /images/bg.jpg HTTP/1.0\\\" 200 24736\" }\n{ \"create\":{ } }\n{ \"@timestamp\": \"2099-05-06T16:25:42.000Z\", \"message\": \"192.0.2.255 - - [06/May/2099:16:25:42 +0000] \\\"GET /favicon.ico HTTP/1.0\\\" 200 3638\" }\n--------------------------------------------------\n// TEST[continued]\n\n[discrete]\n[[retrieve-lifecycle-information]]\n==== Retrieve lifecycle information\n\nYou can use the <<data-streams-get-lifecycle,get data stream lifecycle API>> to see the data stream lifecycle of your data stream and\nthe <<data-streams-explain-lifecycle,explain data stream lifecycle API>> to see the exact state of each backing index.\n\n[source,console]\n--------------------------------------------------\nGET _data_stream/my-data-stream/_lifecycle\n--------------------------------------------------\n// TEST[continued]\n\nThe result will look like this:\n\n[source,console-result]\n--------------------------------------------------\n{\n  \"data_streams\": [\n    {\n      \"name\": \"my-data-stream\",                                     <1>\n      \"lifecycle\": {\n        \"enabled\": true,                                            <2>\n        \"data_retention\": \"7d\",                                     <3>\n        \"effective_retention\": \"7d\",                                <4>\n        \"retention_determined_by\": \"data_stream_configuration\"\n      }\n    }\n  ],\n  \"global_retention\": {}\n}\n--------------------------------------------------\n<1> The name of your data stream.\n<2> Shows if the data stream lifecycle is enabled for this data stream.\n<3> The retention period of the data indexed in this data stream, as configured by the user.\n<4> The retention period that will be applied by the data stream lifecycle. This means that the data in this data stream will\n    be kept at least for 7 days. After that {es} can delete it at its own discretion.\n\nIf you want to see more information about how the data stream lifecycle is applied on individual backing indices use the\n<<data-streams-explain-lifecycle,explain data stream lifecycle API>>:\n\n[source,console]\n--------------------------------------------------\nGET .ds-my-data-stream-*/_lifecycle/explain\n--------------------------------------------------\n// TEST[continued]\nThe result will look like this:\n\n[source,console-result]\n--------------------------------------------------\n{\n  \"indices\": {\n    \".ds-my-data-stream-2023.04.19-000001\": {\n      \"index\": \".ds-my-data-stream-2023.04.19-000001\",      <1>\n      \"managed_by_lifecycle\": true,                               <2>\n      \"index_creation_date_millis\": 1681918009501,\n      \"time_since_index_creation\": \"1.6m\",                  <3>\n      \"lifecycle\": {                                        <4>\n        \"enabled\": true,\n        \"data_retention\": \"7d\"\n      }\n    }\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[skip:the result is for illustrating purposes only]\n<1> The name of the backing index.\n<2> If it is managed by the built-in data stream lifecycle.\n<3> Time since the index was created.\n<4> The lifecycle configuration that is applied on this backing index.\n\n//////////////////////////\n[source,console]\n--------------------------------------------------\nDELETE _data_stream/my-data-stream\nDELETE _index_template/my-index-template\n--------------------------------------------------\n// TEST[continued]\n\n//////////////////////////\n"
}