{
    "meta": {
        "size": 5993,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/example-using-index-lifecycle-policy.html",
        "type": "documentation",
        "role": [
            "screenshot",
            "screenshot",
            "screenshot",
            "screenshot",
            "screenshot"
        ],
        "has_code": true,
        "title": "example-using-index-lifecycle-policy",
        "version": "8.15"
    },
    "doc": "[[example-using-index-lifecycle-policy]]\n=== Tutorial: Customize built-in {ilm-init} policies\n\n++++\n<titleabbrev>Tutorial: Customize built-in policies</titleabbrev>\n++++\n\n{es} includes the following built-in {ilm-init} policies:\n\n- `logs@lifecycle`\n- `metrics@lifecycle`\n- `synthetics@lifecycle`\n\n{agent} uses these policies to manage backing indices for its data streams.\nThis tutorial shows you how to use {kib}\u2019s **Index Lifecycle Policies** to\ncustomize these policies based on your application's performance, resilience,\nand retention requirements.\n\n\n[discrete]\n[[example-using-index-lifecycle-policy-scenario]]\n==== Scenario\n\nYou want to send log files to an {es} cluster so you can visualize and analyze\nthe data. This data has the following retention requirements:\n\n* When the write index reaches 50GB or is 30 days old, roll over to a new index.\n* After rollover, keep indices in the hot data tier for 30 days.\n* 30 days after rollover:\n** Move indices to the warm data tier.\n** Set replica shards to 1.\n** <<indices-forcemerge, Force merge>> multiple index segments to free up the\nspace used by deleted documents.\n* Delete indices 90 days after rollover.\n\n\n[discrete]\n[[example-using-index-lifecycle-policy-prerequisites]]\n==== Prerequisites\n\nTo complete this tutorial, you'll need:\n\n* An {es} cluster with hot and warm data tiers.\n\n** {ess}:\nElastic Stack deployments on {ess} include a hot tier by default. To add a warm\ntier, edit your deployment and click **Add capacity** for the warm data tier.\n+\n[role=\"screenshot\"]\nimage::images/ilm/tutorial-ilm-ess-add-warm-data-tier.png[Add a warm data tier to your deployment]\n\n** Self-managed cluster:\nAssign `data_hot` and `data_warm` roles to nodes as described in\n<<data-tiers>>.\n+\nFor example, include the `data_warm` node role in the `elasticsearch.yml` file\nof each node in the warm tier:\n+\n[source,yaml]\n----\nnode.roles: [ data_warm ]\n----\n\n* A host with {agent} installed and configured to send logs to your {es}\ncluster.\n\n[discrete]\n[[example-using-index-lifecycle-policy-duplicate-ilm-policy]]\n==== Duplicate the policy\n\n{agent} uses data streams with an index pattern of `logs-*-*` to store log\nmonitoring data. The managed `logs@lifecycle` {ilm-init} policy automatically manages\nbacking indices for these data streams. \n\nIf you don't want to use the policy defaults, then you can customize the managed policy and then save it as a new policy. You can then use the new policy in related component templates and index templates.\n\nCAUTION: You should never edit managed policies directly. Changes to managed policies might be rolled back or overwritten.\n\nTo save the `logs@lifecycle` policy as a new policy in {kib}:\n\n. Open the menu and go to **Stack Management** > **Index Lifecycle Policies**.\n. Toggle **Include managed system policies**.\n. Select the `logs@lifecycle` policy.\n. On the **Edit policy logs** page, toggle **Save as new policy**, and then provide a new name for the policy, for example, `logs-custom`.\n\nThe `logs@lifecycle` policy uses the recommended rollover defaults: Start writing to a new\nindex when the current write index reaches 50GB or becomes 30 days old.\n\nTo view or change the rollover settings, click **Advanced settings** for the hot\nphase. Then disable **Use recommended defaults** to display the rollover\nsettings.\n\n[role=\"screenshot\"]\nimage::images/ilm/tutorial-ilm-hotphaserollover-default.png[View rollover defaults]\n\n[discrete]\n[[ilm-ex-modify-policy]]\n==== Modify the policy\n\nThe default `logs@lifecycle` policy is designed to prevent the creation of many tiny daily\nindices. You can modify your copy of the policy to meet your performance requirements and\nmanage resource usage.\n\n. Activate the warm phase and click **Advanced settings**.\n+\n--\n.. Set **Move data into phase when** to **30 days old**. This moves indices to\nthe warm tier 30 days after rollover.\n\n.. Enable **Set replicas** and change **Number of replicas** to **1**.\n\n.. Enable **Force merge data** and set **Number of segments** to **1**.\n\n[role=\"screenshot\"]\nimage::images/ilm/tutorial-ilm-modify-default-warm-phase-rollover.png[Add a warm phase with custom settings]\n--\n\n. In the warm phase, click the trash icon to enable the delete phase.\n+\n[role=\"screenshot\"]\nimage::images/ilm/tutorial-ilm-enable-delete-phase.png[Enable the delete phase]\n+\nIn the delete phase, set **Move data into phase when** to **90 days old**. This\ndeletes indices 90 days after rollover.\n+\n[role=\"screenshot\"]\nimage::images/ilm/tutorial-ilm-delete-rollover.png[Add a delete phase]\n\n. Click **Save as new policy**.\n\nTIP:  Copies of managed {ilm-init} policies are also marked as **Managed**. You can use the <<ilm-put-lifecycle,Create or update lifecycle policy API>> to update the `_meta.managed` parameter to `false`.\n\n[discrete]\n[[example-using-index-lifecycle-policy-apply-policy]]\n==== Apply the policy\n\nTo apply your new {ilm-init} policy to the `logs` index template, create or edit the `logs@custom` component template. \n\nA `*@custom` component template allows you to customize the mappings and settings of managed index templates, without having to override managed index templates or component templates. This type of component template is automatically picked up by the index template. <<put-component-template-api-path-params,Learn more>>.\n\n. Click on the **Component Template** tab and click **Create component template**.\n. Under **Logistics**, name the component template `logs@custom`.\n. Under **Index settings**, set the {ilm-init} policy name created in the previous step:\n+\n[source,JSON]\n--------------------------------------------------\n{\n    \"index\": {\n        \"lifecycle\": {\n            \"name\": \"logs-custom\"\n        }\n    }\n}\n--------------------------------------------------\n+\n. Continue to **Review**, and then click **Save component template**.\n. Click the **Index Templates**, tab, and then select the `logs` index template.\n. In the summary, view the **Component templates** list. `logs@custom` should be listed."
}