{
    "meta": {
        "timestamp": "2024-11-01T03:02:53.817582",
        "size": 6175,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/update-connector-filtering-api.html",
        "type": "documentation",
        "role": [
            "child_attributes"
        ],
        "has_code": true,
        "title": "update-connector-filtering-api",
        "version": "8.15"
    },
    "doc": "[[update-connector-filtering-api]]\n=== Update connector filtering API\n++++\n<titleabbrev>Update connector filtering</titleabbrev>\n++++\n\nbeta::[]\n\nUpdates the draft `filtering` configuration of a connector and marks the draft validation state as `edited`. The filtering draft is activated once validated by the running Elastic connector service.\n\nThe filtering property is used to configure sync rules (both basic and advanced) for a connector. Learn more in the <<es-sync-rules>>.\n\nTo get started with Connector APIs, check out <<es-connectors-tutorial-api, our tutorial>>.\n\n\n[[update-connector-filtering-api-request]]\n==== {api-request-title}\n\n`PUT _connector/<connector_id>/_filtering`\n\n[[update-connector-filtering-api-prereq]]\n==== {api-prereq-title}\n\n* To sync data using self-managed connectors, you need to deploy the <<es-connectors-deploy-connector-service,Elastic connector service>>. on your own infrastructure. This service runs automatically on Elastic Cloud for Elastic managed connectors.\n* The `connector_id` parameter should reference an existing connector.\n* Filtering draft is activated once validated by the running Elastic connector service, the `draft.validation.state` must be `valid`.\n* If, after a validation attempt, the `draft.validation.state` equals to `invalid`, inspect `draft.validation.errors` and fix any issues.\n\n[[update-connector-filtering-api-path-params]]\n==== {api-path-parms-title}\n\n`<connector_id>`::\n(Required, string)\n\n[role=\"child_attributes\"]\n[[update-connector-filtering-api-request-body]]\n==== {api-request-body-title}\n\n`rules`::\n(Optional, array of objects)\nAn array of <<es-sync-rules-basic, basic sync rules>>, each with the following sub-attributes:\n* `id` (Required, string) +\nA unique identifier for the rule.\n* `policy` (Required, string) +\nSpecifies the policy, such as `include` or `exclude`.\n* `field` (Required, string) +\nThe field in the document to which this rule applies.\n* `rule` (Required, string) +\nThe type of rule, such as `regex`, `starts_with`, `ends_with`, `contains`, `equals`, `<`, `>`, etc.\n* `value` (Required, string) +\nThe value to be used in conjunction with the rule for matching the contents of the document's field.\n* `order` (Required, number) +\nThe order in which the rules are applied. The first rule to match has its policy applied.\n* `created_at` (Optional, datetime) +\nThe timestamp when the rule was added. Defaults to `now` UTC timestamp.\n* `updated_at` (Optional, datetime) +\nThe timestamp when the rule was last edited. Defaults to `now` UTC timestamp.\n\n`advanced_snippet`::\n(Optional, object)\nUsed for <<es-sync-rules-advanced, advanced filtering>> at query time, with the following sub-attributes:\n* `value` (Required, object or array) +\nA JSON object/array passed directly to the connector for advanced filtering.\n* `created_at` (Optional, datetime) +\nThe timestamp when this JSON object was created. Defaults to `now` UTC timestamp.\n* `updated_at` (Optional, datetime) +\nThe timestamp when this JSON object was last edited. Defaults to `now` UTC timestamp.\n\n\n[[update-connector-filtering-api-response-codes]]\n==== {api-response-codes-title}\n\n`200`::\nConnector draft filtering was successfully updated.\n\n`400`::\nThe `connector_id` was not provided or the request payload was malformed.\n\n`404` (Missing resources)::\nNo connector matching `connector_id` could be found.\n\n[[update-connector-filtering-api-example]]\n==== {api-examples-title}\n\nThe following example updates the draft <<es-sync-rules-basic, basic sync rules>> for a Google Drive connector with ID `my-g-drive-connector`. All Google Drive files with `.txt` extension will be skipped:\n\n////\n[source, console]\n--------------------------------------------------\nPUT _connector/my-g-drive-connector\n{\n  \"index_name\": \"search-google-drive\",\n  \"name\": \"My Connector\",\n  \"service_type\": \"google_drive\"\n}\n\nPUT _connector/my-sql-connector\n{\n  \"index_name\": \"search-sql\",\n  \"name\": \"My SQL Connector\",\n  \"service_type\": \"google_drive\"\n}\n\n--------------------------------------------------\n// TESTSETUP\n\n[source,console]\n--------------------------------------------------\nDELETE _connector/my-g-drive-connector\nDELETE _connector/my-sql-connector\n--------------------------------------------------\n// TEARDOWN\n////\n\n[source,console]\n----\nPUT _connector/my-g-drive-connector/_filtering\n{\n    \"rules\": [\n         {\n            \"field\": \"file_extension\",\n            \"id\": \"exclude-txt-files\",\n            \"order\": 0,\n            \"policy\": \"exclude\",\n            \"rule\": \"equals\",\n            \"value\": \"txt\"\n        },\n        {\n            \"field\": \"_\",\n            \"id\": \"DEFAULT\",\n            \"order\": 1,\n            \"policy\": \"include\",\n            \"rule\": \"regex\",\n            \"value\": \".*\"\n        }\n    ]\n}\n----\n\n[source,console-result]\n----\n{\n    \"result\": \"updated\"\n}\n----\n\nThe following example updates the draft advanced sync rules for a MySQL connector with id `my-sql-connector`. Advanced sync rules are specific to each connector type. Refer to the references for connectors that support <<es-sync-rules-advanced, advanced sync rules>> for syntax and examples.\n\n[source,console]\n----\nPUT _connector/my-sql-connector/_filtering\n{\n    \"advanced_snippet\": {\n        \"value\": [{\n            \"tables\": [\n                \"users\",\n                \"orders\"\n            ],\n            \"query\": \"SELECT users.id AS id, orders.order_id AS order_id FROM users JOIN orders ON users.id = orders.user_id\"\n        }]\n    }\n}\n----\n\n[source,console-result]\n----\n{\n    \"result\": \"updated\"\n}\n----\n\n\n////\n[source, console]\n--------------------------------------------------\nPUT _connector/my-sql-connector/_filtering/_validation\n{\n  \"validation\": {\n    \"state\": \"valid\",\n    \"errors\": []\n  }\n}\n--------------------------------------------------\n// TEST[continued]\n////\n\n\nNote, you can also update draft `rules` and `advanced_snippet` in a single request.\n\nOnce the draft is updated, its validation state is set to `edited`. The connector service will then validate the rules and report the validation state as either `invalid` or `valid`. If the state is `valid`, the draft filtering will be activated by the running Elastic connector service.\n"
}