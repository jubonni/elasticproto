{
    "meta": {
        "timestamp": "2024-11-01T03:02:52.431578",
        "size": 3761,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-doc-count-field.html",
        "type": "documentation",
        "role": [],
        "has_code": true,
        "title": "mapping-doc-count-field",
        "version": "8.15"
    },
    "doc": "[[mapping-doc-count-field]]\n=== `_doc_count` field\n\nBucket aggregations always return a field named `doc_count` showing the number of documents that were aggregated and partitioned\nin each bucket. Computation of the value of `doc_count` is very simple. `doc_count` is incremented by 1 for every document collected\nin each bucket.\n\nWhile this simple approach is effective when computing aggregations over individual documents, it fails to accurately represent\ndocuments that store pre-aggregated data (such as `histogram` or `aggregate_metric_double` fields), because one summary field may\nrepresent multiple documents.\n\nTo allow for correct computation of the number of documents when working with pre-aggregated data, we have introduced a\nmetadata field type named `_doc_count`. `_doc_count` must always be a positive integer representing the number of documents\naggregated in a single summary field.\n\nWhen field `_doc_count` is added to a document, all bucket aggregations will respect its value and increment the bucket `doc_count`\nby the value of the field. If a document does not contain any `_doc_count` field, `_doc_count = 1` is implied by default.\n\n[IMPORTANT]\n========\n* A `_doc_count` field can only store a single positive integer per document. Nested arrays are not allowed.\n* If a document contains no `_doc_count` fields, aggregators will increment by 1, which is the default behavior.\n========\n\n[[mapping-doc-count-field-example]]\n==== Example\n\nThe following <<indices-create-index, create index>> API request creates a new index with the following field mappings:\n\n* `my_histogram`, a `histogram` field used to store percentile data\n* `my_text`, a `keyword` field used to store a title for the histogram\n\n[source,console]\n--------------------------------------------------\nPUT my_index\n{\n  \"mappings\" : {\n    \"properties\" : {\n      \"my_histogram\" : {\n        \"type\" : \"histogram\"\n      },\n      \"my_text\" : {\n        \"type\" : \"keyword\"\n      }\n    }\n  }\n}\n--------------------------------------------------\n\nThe following <<docs-index_,index>> API requests store pre-aggregated data for\ntwo histograms: `histogram_1` and `histogram_2`.\n\n[source,console]\n--------------------------------------------------\nPUT my_index/_doc/1\n{\n  \"my_text\" : \"histogram_1\",\n  \"my_histogram\" : {\n      \"values\" : [0.1, 0.2, 0.3, 0.4, 0.5],\n      \"counts\" : [3, 7, 23, 12, 6]\n   },\n  \"_doc_count\": 45 <1>\n}\n\nPUT my_index/_doc/2\n{\n  \"my_text\" : \"histogram_2\",\n  \"my_histogram\" : {\n      \"values\" : [0.1, 0.25, 0.35, 0.4, 0.45, 0.5],\n      \"counts\" : [8, 17, 8, 7, 6, 2]\n   },\n  \"_doc_count\": 62 <1>\n}\n--------------------------------------------------\n<1> Field `_doc_count` must be a positive integer storing the number of documents aggregated to produce each histogram.\n\nIf we run the following <<search-aggregations-bucket-terms-aggregation, terms aggregation>> on `my_index`:\n\n[source,console]\n--------------------------------------------------\nGET /_search\n{\n    \"aggs\" : {\n        \"histogram_titles\" : {\n            \"terms\" : { \"field\" : \"my_text\" }\n        }\n    }\n}\n--------------------------------------------------\n\nWe will get the following response:\n\n[source,console-result]\n--------------------------------------------------\n{\n    ...\n    \"aggregations\" : {\n        \"histogram_titles\" : {\n            \"doc_count_error_upper_bound\": 0,\n            \"sum_other_doc_count\": 0,\n            \"buckets\" : [\n                {\n                    \"key\" : \"histogram_2\",\n                    \"doc_count\" : 62\n                },\n                {\n                    \"key\" : \"histogram_1\",\n                    \"doc_count\" : 45\n                }\n            ]\n        }\n    }\n}\n--------------------------------------------------\n// TESTRESPONSE[skip:test not setup]\n"
}