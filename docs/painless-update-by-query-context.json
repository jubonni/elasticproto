{
    "meta": {
        "timestamp": "2024-11-01T02:49:25.881068",
        "size": 2319,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/painless-update-by-query-context.html",
        "type": "documentation",
        "role": [],
        "has_code": true,
        "title": "painless-update-by-query-context",
        "version": "8.15"
    },
    "doc": "[[painless-update-by-query-context]]\n=== Update by query context\n\nUse a Painless script in an\n{ref}/docs-update-by-query.html[update by query] operation to add,\nmodify, or delete fields within each of a set of documents collected as the\nresult of query.\n\n*Variables*\n\n`params` (`Map`, read-only)::\n        User-defined parameters passed in as part of the query.\n\n`ctx['op']` (`String`)::\n        The name of the operation.\n\n{ref}/mapping-routing-field.html[`ctx['_routing']`] (`String`, read-only)::\n        The value used to select a shard for document storage.\n\n{ref}/mapping-index-field.html[`ctx['_index']`] (`String`, read-only)::\n        The name of the index.\n\n{ref}/mapping-id-field.html[`ctx['_id']`] (`String`, read-only)::\n        The unique document id.\n\n`ctx['_version']` (`int`, read-only)::\n        The current version of the document.\n\n{ref}/mapping-source-field.html[`ctx['_source']`] (`Map`)::\n        Contains extracted JSON in a `Map` and `List` structure for the fields\n        existing in a stored document.\n\n*Side Effects*\n\n`ctx['op']`::\n        Use the default of `index` to update a document. Set to `none` to\n        specify no operation or `delete` to delete the current document from\n        the index.\n\n{ref}/mapping-source-field.html[`ctx['_source']`]::\n        Modify the values in the `Map/List` structure to add, modify, or delete\n        the fields of a document.\n\n*Return*\n\n`void`::\n        No expected return value.\n\n*API*\n\nThe standard <<painless-api-reference-shared, Painless API>> is available.\n\n*Example*\n\nTo run this example, first follow the steps in\n<<painless-context-examples, context examples>>.\n\nThe following query finds all seats in a specific section that have not been\nsold and lowers the price by 2:\n\n[source,console]\n--------------------------------------------------\nPOST /seats/_update_by_query\n{\n  \"query\": {\n    \"bool\": {\n      \"filter\": [\n        {\n          \"range\": {\n            \"row\": {\n              \"lte\": 3\n            }\n          }\n        },\n        {\n          \"match\": {\n            \"sold\": false\n          }\n        }\n      ]\n    }\n  },\n  \"script\": {\n    \"source\": \"ctx._source.cost -= params.discount\",\n    \"lang\": \"painless\",\n    \"params\": {\n      \"discount\": 2\n    }\n  }\n}\n--------------------------------------------------\n// TEST[setup:seats]\n"
}