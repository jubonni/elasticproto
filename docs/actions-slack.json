{
    "meta": {
        "size": 8293,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/actions-slack.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "actions-slack",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[actions-slack]]\n=== {watcher} Slack Action\n++++\n<titleabbrev>Slack action</titleabbrev>\n++++\n\nUse the `slack` action to send messages to a https://slack.com/[Slack]\nteam's channels or users. To send Slack messages, you need to \n<<configuring-slack,configure at least one Slack account>> in \n`elasticsearch.yml`. \n\n[[configuring-slack-actions]]\n==== Configuring Slack actions\n\nYou configure Slack actions in the `actions` array. Action-specific attributes\nare specified using the `slack` keyword.\n\nThe following snippet shows a simple slack action definition:\n\n[source,js]\n--------------------------------------------------\n\"actions\" : {\n  \"notify-slack\" : {\n    \"transform\" : { ... },\n    \"throttle_period\" : \"5m\",\n    \"slack\" : {\n      \"message\" : {\n        \"to\" : [ \"#admins\", \"@chief-admin\" ], <1>\n        \"text\" : \"Encountered  {{ctx.payload.hits.total}} errors in the last 5 minutes (facepalm)\" <2>\n      }\n    }\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n<1> The channels and users you want to send the message to.\n<2> The content of the message.\n\n\n[[formatting-slack-messages]]\n==== Using attachments to format Slack messages\n\nIn addition to sending simple text-based messages, you can use the Slack\nhttps://api.slack.com/docs/attachments[attachment] mechanism to send formatted\nmessages. {watcher} leverages Slack attachments to enable you to dynamically\npopulate templated messages from the execution context payload.\n\nThe following snippet shows a standard message attachment:\n\n[source,js]\n--------------------------------------------------\n\"actions\" : {\n  \"notify-slack\" : {\n    \"throttle_period\" : \"5m\",\n    \"slack\" : {\n      \"account\" : \"team1\",\n      \"message\" : {\n        \"from\" : \"watcher\",\n        \"to\" : [ \"#admins\", \"@chief-admin\" ],\n        \"text\" : \"System X Monitoring\",\n        \"attachments\" : [\n          {\n            \"title\" : \"Errors Found\",\n            \"text\" : \"Encountered  {{ctx.payload.hits.total}} errors in the last 5 minutes (facepalm)\",\n            \"color\" : \"danger\"\n          }\n        ]\n      }\n    }\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n\n[[slack-dynamic-attachment]]\n\nTo define an attachment template that is dynamically populated from the payload,\nyou specify `dynamic_attachments` in the watch action. For example, a dynamic\nattachment could reference histogram buckets in the payload and build an\nattachment per bucket.\n\nIn the following example, the watch input executes a search with a date histogram\naggregation and the Slack action:\n\n. Transforms the payload to a list where each item in the list holds the month,\n  the user count for that month, and the color that represents the sentiment\n  associated with that count (danger or bad).\n\n. Defines an attachment template that references items in the list generated by\n  the transform.\n\n[source,js]\n--------------------------------------------------\n\"input\" : {\n  \"search\" : {\n    \"request\" : {\n      \"body\" : {\n        \"aggs\" : {\n          \"users_per_month\" : {\n            \"date_histogram\" : {\n              \"field\" : \"@timestamp\",\n              \"interval\" : \"month\"\n            }\n          }\n        }\n      }\n    }\n  }\n},\n...\n\"actions\" : {\n  \"notify-slack\" : {\n    \"throttle_period\" : \"5m\",\n    \"transform\" : {\n      \"script\" : {\n        \"source\" : \"['items': ctx.payload.aggregations.users_per_month.buckets.collect(bucket -> ['count': bucket.doc_count, 'name': bucket.key_as_string, 'color': bucket.doc_count < 100 ? 'danger' : 'good'])]\",\n        \"lang\" : \"painless\"\n      }\n    },\n    \"slack\" : {\n      \"account\" : \"team1\",\n      \"message\" : {\n        \"from\" : \"watcher\",\n        \"to\" : [ \"#admins\", \"@chief-admin\" ],\n        \"text\" : \"System X Monitoring\",\n        \"dynamic_attachments\" : {\n          \"list_path\" : \"ctx.payload.items\" <1>\n          \"attachment_template\" : {\n            \"title\" : \"{{month}}\", <2>\n            \"text\" : \"Users Count: {{count}}\",\n            \"color\" : \"{{color}}\"\n          }\n        }\n      }\n    }\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n<1> The list generated by the action's transform.\n<2> The parameter placeholders refer to attributes in each item of the list\n    generated by the transform.\n\n[[slack-action-attributes]]\n==== Slack action attributes\n\n[cols=\",^,\", options=\"header\"]\n|======\n| Name                          |Required | Description\n\n| `message.from`                | no      | The sender name to display in the Slack message.\n                                    Overrides the incoming webhook's configured name.\n\n| `message.to`                  | yes     | The channels and users you want to send the message\n                                    to. Channel names must start with `#` and user names\n                                    must start with `@`. Accepts a string value or an\n                                    array of string values.\n\n| `message.icon`                | no      | The icon to display in the Slack messages. Overrides\n                                    the incoming webhook's configured icon. Accepts a\n                                    public URL to an image.\n\n| `message.text`                | yes     | The message content.\n\n| `message.attachments`         | no      | Slack message attachments. Message attachments enable\n                                    you to create more richly-formatted messages. Specified\n                                    array as defined in the\n                                    https://api.slack.com/docs/attachments[Slack attachments documentation].\n\n| `message.dynamic_attachments` | no      | Slack message attachments that can be populated\n                                    dynamically based on the current watch payload. For\n                                    more information, see\n                                    <<slack-dynamic-attachment>>.\n\n| `proxy.host`      | no        | The proxy host to use (only in combination with `proxy.port`)\n\n| `proxy.port`      | no        | The proxy port to use (only in combination with `proxy.host`)\n|======\n\n[[configuring-slack]]\n==== Configuring Slack Accounts\n\nYou configure the accounts {watcher} can use to communicate with Slack in the\n`xpack.notification.slack` namespace in `elasticsearch.yml`.\n\nYou need a Slack App with the https://api.slack.com/messaging/webhooks[Incoming Webhooks feature] \nto configure a Slack account. Use the generated webhook URL to set up your Slack account in {es}.\n\nTo configure a Slack account, at a minimum you need to specify the account \nname and webhook URL in the {es} keystore (see {ref}/secure-settings.html[secure settings]):\n\n[source,shell]\n--------------------------------------------------\nbin/elasticsearch-keystore add xpack.notification.slack.account.monitoring.secure_url\n--------------------------------------------------\n\n[WARNING]\n======\nYou can no longer configure Slack accounts using `elasticsearch.yml` settings.\nPlease use {es}'s secure <<secure-settings,keystore>> method instead.\n======\n\nYou can specify defaults for the\n<<slack-account-attributes,Slack notification attributes>>:\n\n[source,yaml]\n--------------------------------------------------\nxpack.notification.slack:\n  account:\n    monitoring:\n      message_defaults:\n        from: x-pack\n        to: notifications\n        icon: http://example.com/images/watcher-icon.jpg\n        attachment: \n          fallback: \"X-Pack Notification\"\n          color: \"#36a64f\"\n          title: \"X-Pack Notification\"\n          title_link: \"https://www.elastic.co/guide/en/x-pack/current/index.html\"\n          text: \"One of your watches generated this notification.\"\n          mrkdwn_in: \"pretext, text\"\n--------------------------------------------------\n\nTo notify multiple channels, create a webhook URL for each channel in Slack \nand multiple Slack accounts in {es} (one for each webhook URL).\n\nIf you configure multiple Slack accounts, you either need to configure a default \naccount or specify which account the notification should be sent with in the\n<<actions-slack,`slack`>> action. \n\n[source,yaml]\n--------------------------------------------------\nxpack.notification.slack:\n  default_account: team1\n  account:\n    team1:\n      ...\n    team2:\n      ...\n--------------------------------------------------\n"
}