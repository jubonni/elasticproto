{
    "meta": {
        "timestamp": "2024-11-01T03:02:53.131580",
        "size": 2915,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/painless-runtime-fields.html",
        "type": "documentation",
        "role": [],
        "has_code": false,
        "title": "painless-runtime-fields",
        "version": "8.15"
    },
    "doc": "[[painless-runtime-fields]]\n=== Use Painless scripts in runtime fields\nA runtime field is a field that is evaluated at query time. When you define a\nruntime field, you can immediately use it in search requests, aggregations,\nfiltering, and sorting.\n\nWhen defining a runtime field, you can include a Painless script that is\nevaluated at query time. This script has access to the entire context of a\ndocument, including the original document {ref}/modules-scripting-fields.html[`_source` field]\nand any mapped fields plus their values. At query time, the script runs and\ngenerates values for each scripted field that is included in the query.\n\nYou can map a runtime field in the `runtime` section under the mapping\ndefinition, or define runtime fields that exist only as part of a search\nrequest. The script syntax is the same, regardless of where you define the\nruntime field.\n\nIMPORTANT: When defining a Painless script to use with runtime fields, you must\ninclude `emit` to return calculated values.\n\n[discrete]\n[[painless-runtime-fields-mapping]]\n==== Define a runtime field in the mapping\nAdd a `runtime` section under the {ref}/runtime-mapping-fields.html[mapping definition] to explore your data without indexing fields.\n\nThe script in the following request extracts the day of the week from the\n`@timestamp` field, which is defined as a `date` type. The script calculates\nthe day of the week based on the value of `@timestamp`, and uses `emit` to\nreturn the calculated value.\n\n[source,console]\n----\nPUT my-index/\n{\n  \"mappings\": {\n    \"runtime\": {\n      \"day_of_week\": {\n        \"type\": \"keyword\",\n        \"script\": {\n          \"source\":\n          \"\"\"emit(doc['@timestamp'].value.dayOfWeekEnum\n          .getDisplayName(TextStyle.FULL, Locale.ROOT))\"\"\"\n        }\n      }\n    },\n    \"properties\": {\n      \"@timestamp\": {\"type\": \"date\"}\n    }\n  }\n}\n----\n\n[discrete]\n[[painless-runtime-fields-query]]\n==== Define a runtime field only in a search request\nUse runtime fields in a search request to create a field that exists\n{ref}/runtime-search-request.html[only as part of the query]. You can also {ref}/runtime-override-values.html[override field values] at query time for existing fields without\nmodifying the field itself.\n\nThis flexibility allows you to experiment with your data schema and fix\nmistakes in your index mapping without reindexing your data.\n\nIn the following request, the values for the `day_of_week` field are calculated\ndynamically, and only within the context of this search request:\n\n[source,console]\n----\nGET my-index/_search\n{\n  \"runtime_mappings\": {\n    \"day_of_week\": {\n      \"type\": \"keyword\",\n      \"script\": {\n        \"source\":\n        \"\"\"emit(doc['@timestamp'].value.dayOfWeekEnum\n        .getDisplayName(TextStyle.FULL, Locale.ROOT))\"\"\"\n      }\n    }\n  },\n  \"aggs\": {\n    \"day_of_week\": {\n      \"terms\": {\n        \"field\": \"day_of_week\"\n      }\n    }\n  }\n}\n----\n//TEST[continued]\n"
}