{
    "meta": {
        "timestamp": "2024-11-01T03:02:52.815582",
        "size": 7292,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-invalidate-api-key.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "security-api-invalidate-api-key",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[security-api-invalidate-api-key]]\n=== Invalidate API key API\n++++\n<titleabbrev>Invalidate API key</titleabbrev>\n++++\n\nInvalidates one or more API keys.\n\n[[security-api-invalidate-api-key-request]]\n==== {api-request-title}\n\n`DELETE /_security/api_key`\n\n[[security-api-invalidate-api-key-prereqs]]\n==== {api-prereq-title}\n\n* To use this API, you must have at least the `manage_security`, `manage_api_key`, or `manage_own_api_key` cluster privilege.\nThe `manage_security` privilege allows deleting any API key, including both REST and <<security-api-create-cross-cluster-api-key,cross cluster API keys>>.\nThe `manage_api_key` privilege allows deleting any REST API key, but not cross cluster API keys.\nThe `manage_own_api_key` only allows deleting REST API keys owned by the user.\nIn addition, with the `manage_own_api_key` privilege, an invalidation request must be issued\nin one of the three formats:\n1. Set the parameter `owner=true`\n2. Or, set both `username` and `realm_name` to match the user's identity.\n3. Or, if the request is issued by an API key, i.e. an API key invalidates itself, specify its ID in the `ids` field.\n\n[[security-api-invalidate-api-key-desc]]\n==== {api-description-title}\n\nThis API invalidates API keys created by the <<security-api-create-api-key,create API key>> or <<security-api-grant-api-key,grant API key>>\nAPIs.\nInvalidated API keys fail authentication, but they can still be viewed using the\n<<security-api-get-api-key,get API key information>> and <<security-api-query-api-key,query API key information>> APIs,\nfor at least the <<api-key-service-settings-delete-retention-period,configured retention period>>, until they are automatically deleted.\n\n\n[[security-api-invalidate-api-key-request-body]]\n==== {api-request-body-title}\n\nThe following parameters can be specified in the body of a DELETE request and\npertain to invalidating api keys:\n\n`ids`::\n(Optional, array of string) A list of API key ids. This parameter cannot be used\nwhen any of `name`, `realm_name`, `username` are used\n\n`name`::\n(Optional, string) An API key name. This parameter cannot be used with any of\n`ids`, `realm_name` or `username` are used.\n\n`realm_name`::\n(Optional, string) The name of an authentication realm. This parameter cannot be\nused with either `ids` or `name` or when `owner` flag is set to `true`.\n\n`username`::\n(Optional, string) The username of a user. This parameter cannot be used with\neither `ids` or `name` or when `owner` flag is set to `true`.\n\n`owner`::\n(Optional, Boolean) A boolean flag that can be used to query API keys owned\nby the currently authenticated user. Defaults to false.\nThe 'realm_name' or 'username' parameters cannot be specified when this\nparameter is set to 'true' as they are assumed to be the currently authenticated ones.\n\nNOTE: At least one of \"ids\", \"name\", \"username\" and \"realm_name\" must be specified\n if \"owner\" is \"false\" (default).\n\n[[security-api-invalidate-api-key-response-body]]\n==== {api-response-body-title}\n\nA successful call returns a JSON structure that contains the ids of the API keys\nthat were invalidated, the ids of the API keys that had already been invalidated,\nand potentially a list of errors encountered while invalidating specific api\nkeys.\n\n[[security-api-invalidate-api-key-example]]\n==== {api-examples-title}\n\nIf you create an API key as follows:\n\n[source,console]\n------------------------------------------------------------\nPOST /_security/api_key\n{\n  \"name\": \"my-api-key\"\n}\n------------------------------------------------------------\n\nA successful call returns a JSON structure that provides\nAPI key information. For example:\n\n[source,console-result]\n--------------------------------------------------\n{\n  \"id\": \"VuaCfGcBCdbkQm-e5aOx\",\n  \"name\": \"my-api-key\",\n  \"api_key\": \"ui2lp2axTNmsyakw9tvNnw\",\n  \"encoded\": \"VnVhQ2ZHY0JDZGJrUW0tZTVhT3g6dWkybHAyYXhUTm1zeWFrdzl0dk5udw==\"\n}\n--------------------------------------------------\n// TESTRESPONSE[s/VuaCfGcBCdbkQm-e5aOx/$body.id/]\n// TESTRESPONSE[s/ui2lp2axTNmsyakw9tvNnw/$body.api_key/]\n// TESTRESPONSE[s/VnVhQ2ZHY0JDZGJrUW0tZTVhT3g6dWkybHAyYXhUTm1zeWFrdzl0dk5udw==/$body.encoded/]\n\nThe following example invalidates the API key identified by specified `ids`\nimmediately:\n\n[source,console]\n--------------------------------------------------\nDELETE /_security/api_key\n{\n  \"ids\" : [ \"VuaCfGcBCdbkQm-e5aOx\" ]\n}\n--------------------------------------------------\n// TEST[s/VuaCfGcBCdbkQm-e5aOx/$body.id/]\n// TEST[continued]\n\nThe following example invalidates the API key identified by specified `name`\nimmediately:\n\n[source,console]\n--------------------------------------------------\nDELETE /_security/api_key\n{\n  \"name\" : \"my-api-key\"\n}\n--------------------------------------------------\n\nThe following example invalidates all API keys for the `native1` realm\nimmediately:\n\n[source,console]\n--------------------------------------------------\nDELETE /_security/api_key\n{\n  \"realm_name\" : \"native1\"\n}\n--------------------------------------------------\n\nThe following example invalidates all API keys for the user `myuser` in all\nrealms immediately:\n\n[source,console]\n--------------------------------------------------\nDELETE /_security/api_key\n{\n  \"username\" : \"myuser\"\n}\n--------------------------------------------------\n\nThe following example invalidates the API key identified by the specified `ids` if\n it is owned by the currently authenticated user immediately:\n\n[source,console]\n--------------------------------------------------\nDELETE /_security/api_key\n{\n  \"ids\" : [\"VuaCfGcBCdbkQm-e5aOx\"],\n  \"owner\" : \"true\"\n}\n--------------------------------------------------\n\nThe following example invalidates all API keys owned by the currently authenticated\n user immediately:\n\n[source,console]\n--------------------------------------------------\nDELETE /_security/api_key\n{\n  \"owner\" : \"true\"\n}\n--------------------------------------------------\n\nFinally, the following example invalidates all API keys for the user `myuser` in\n the `native1` realm immediately:\n\n[source,console]\n--------------------------------------------------\nDELETE /_security/api_key\n{\n  \"username\" : \"myuser\",\n  \"realm_name\" : \"native1\"\n}\n--------------------------------------------------\n\n[source,js]\n--------------------------------------------------\n{\n  \"invalidated_api_keys\": [ <1>\n    \"api-key-id-1\"\n  ],\n  \"previously_invalidated_api_keys\": [ <2>\n    \"api-key-id-2\",\n    \"api-key-id-3\"\n  ],\n  \"error_count\": 2, <3>\n  \"error_details\": [ <4>\n    {\n      \"type\": \"exception\",\n      \"reason\": \"error occurred while invalidating api keys\",\n      \"caused_by\": {\n        \"type\": \"illegal_argument_exception\",\n        \"reason\": \"invalid api key id\"\n      }\n    },\n    {\n      \"type\": \"exception\",\n      \"reason\": \"error occurred while invalidating api keys\",\n      \"caused_by\": {\n        \"type\": \"illegal_argument_exception\",\n        \"reason\": \"invalid api key id\"\n      }\n    }\n  ]\n}\n--------------------------------------------------\n// NOTCONSOLE\n\n<1> The IDs of the API keys that were invalidated as part of this request.\n<2> The IDs of the API keys that were already invalidated.\n<3> The number of errors that were encountered when invalidating the API keys.\n<4> Details about these errors. This field is not present in the response when\n    `error_count` is 0.\n"
}