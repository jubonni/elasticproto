{
    "meta": {
        "timestamp": "2024-11-01T02:49:24.633065",
        "size": 2179,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/clean-up-snapshot-repo-api.html",
        "type": "documentation",
        "role": [
            "child_attributes"
        ],
        "has_code": false,
        "title": "clean-up-snapshot-repo-api",
        "version": "8.15"
    },
    "doc": "[[clean-up-snapshot-repo-api]]\n=== Clean up snapshot repository API\n++++\n<titleabbrev>Clean up snapshot repository</titleabbrev>\n++++\n\nTriggers the review of a snapshot repository's contents and deletes any stale\ndata that is not referenced by existing snapshots. See\n<<snapshots-repository-cleanup>>.\n\n////\n[source,console]\n-----------------------------------\nPUT /_snapshot/my_repository\n{\n  \"type\": \"fs\",\n  \"settings\": {\n    \"location\": \"my_backup_location\"\n  }\n}\n-----------------------------------\n// TESTSETUP\n////\n\n[source,console]\n----\nPOST /_snapshot/my_repository/_cleanup\n----\n\n[[clean-up-snapshot-repo-api-request]]\n==== {api-request-title}\n\n`POST /_snapshot/<repository>/_cleanup`\n\n[[clean-up-snapshot-repo-api-prereqs]]\n==== {api-prereq-title}\n\n* If the {es} {security-features} are enabled, you must have the `manage`\n<<privileges-list-cluster,cluster privilege>> to use this API.\n\n[[clean-up-snapshot-repo-api-path-params]]\n==== {api-path-parms-title}\n\n`<repository>`::\n(Required, string)\nName of the snapshot repository to review and clean up.\n\n[[clean-up-snapshot-repo-api-query-params]]\n==== {api-query-parms-title}\n\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=timeoutparms]\n\n[role=\"child_attributes\"]\n[[clean-up-snapshot-repo-api-response-body]]\n==== {api-response-body-title}\n\n`results`::\n(object)\nContains statistics for cleanup operations.\n+\n.Properties of `results`\n[%collapsible%open]\n====\n`deleted_bytes`::\n(integer)\nNumber of bytes freed by cleanup operations.\n\n`deleted_blobs`::\n(integer)\nNumber of binary large objects (blobs) removed from the snapshot repository\nduring cleanup operations. Any non-zero value implies that unreferenced blobs\nwere found and subsequently cleaned up.\n====\n\n[[clean-up-snapshot-repo-api-example]]\n==== {api-examples-title}\n\n[source,console]\n----\nPOST /_snapshot/my_repository/_cleanup\n----\n\nThe API returns the following response:\n\n[source,console-result]\n----\n{\n  \"results\": {\n    \"deleted_bytes\": 20,\n    \"deleted_blobs\": 5\n  }\n}\n----\n// TEST[s/\"deleted_bytes\": 20/\"deleted_bytes\": 0/]\n// TEST[s/\"deleted_blobs\": 5/\"deleted_blobs\": 0/]\n\n////\n[source,console]\n----\nDELETE /_snapshot/my_repository\n----\n////"
}