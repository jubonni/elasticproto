{
    "meta": {
        "timestamp": "2024-11-01T03:07:09.599272",
        "size": 3918,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/match-enrich-policy-type.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "match-enrich-policy-type",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[match-enrich-policy-type]]\n=== Example: Enrich your data based on exact values\n\n`match` <<enrich-policy,enrich policies>> match enrich data to incoming\ndocuments based on an exact value, such as a email address or ID, using a\n<<query-dsl-term-query,`term` query>>.\n\nThe following example creates a `match` enrich policy that adds user name and\ncontact information to incoming documents based on an email address. It then\nadds the `match` enrich policy to a processor in an ingest pipeline.\n\nUse the <<indices-create-index, create index API>> or <<docs-index_,index\nAPI>> to create a source index.\n\nThe following index API request creates a source index and indexes a\nnew document to that index.\n\n[source,console]\n----\nPUT /users/_doc/1?refresh=wait_for\n{\n  \"email\": \"mardy.brown@asciidocsmith.com\",\n  \"first_name\": \"Mardy\",\n  \"last_name\": \"Brown\",\n  \"city\": \"New Orleans\",\n  \"county\": \"Orleans\",\n  \"state\": \"LA\",\n  \"zip\": 70116,\n  \"web\": \"mardy.asciidocsmith.com\"\n}\n----\n\nUse the create enrich policy API to create an enrich policy with the\n`match` policy type. This policy must include:\n\n* One or more source indices\n* A `match_field`,\n  the field from the source indices used to match incoming documents\n* Enrich fields from the source indices you'd like to append to incoming\n  documents\n\n[source,console]\n----\nPUT /_enrich/policy/users-policy\n{\n  \"match\": {\n    \"indices\": \"users\",\n    \"match_field\": \"email\",\n    \"enrich_fields\": [\"first_name\", \"last_name\", \"city\", \"zip\", \"state\"]\n  }\n}\n----\n// TEST[continued]\n\nUse the <<execute-enrich-policy-api,execute enrich policy API>> to create an\nenrich index for the policy.\n\n[source,console]\n----\nPOST /_enrich/policy/users-policy/_execute?wait_for_completion=false\n----\n// TEST[s/\\?wait_for_completion=false//]\n// TEST[continued]\n\n\nUse the <<put-pipeline-api,create or update pipeline API>> to create an ingest\npipeline. In the pipeline, add an <<enrich-processor,enrich processor>> that\nincludes:\n\n* Your enrich policy.\n* The `field` of incoming documents used to match documents\n  from the enrich index.\n* The `target_field` used to store appended enrich data for incoming documents.\n  This field contains the `match_field` and `enrich_fields` specified in your\n  enrich policy.\n\n[source,console]\n----\nPUT /_ingest/pipeline/user_lookup\n{\n  \"processors\" : [\n    {\n      \"enrich\" : {\n        \"description\": \"Add 'user' data based on 'email'\",\n        \"policy_name\": \"users-policy\",\n        \"field\" : \"email\",\n        \"target_field\": \"user\",\n        \"max_matches\": \"1\"\n      }\n    }\n  ]\n}\n----\n// TEST[continued]\n\nUse the ingest pipeline to index a document. The incoming document should\ninclude the `field` specified in your enrich processor.\n\n[source,console]\n----\nPUT /my-index-000001/_doc/my_id?pipeline=user_lookup\n{\n  \"email\": \"mardy.brown@asciidocsmith.com\"\n}\n----\n// TEST[continued]\n\nTo verify the enrich processor matched and appended the appropriate field data,\nuse the <<docs-get,get API>> to view the indexed document.\n\n[source,console]\n----\nGET /my-index-000001/_doc/my_id\n----\n// TEST[continued]\n\nThe API returns the following response:\n\n[source,console-result]\n----\n{\n  \"found\": true,\n  \"_index\": \"my-index-000001\",\n  \"_id\": \"my_id\",\n  \"_version\": 1,\n  \"_seq_no\": 55,\n  \"_primary_term\": 1,\n  \"_source\": {\n    \"user\": {\n      \"email\": \"mardy.brown@asciidocsmith.com\",\n      \"first_name\": \"Mardy\",\n      \"last_name\": \"Brown\",\n      \"zip\": 70116,\n      \"city\": \"New Orleans\",\n      \"state\": \"LA\"\n    },\n    \"email\": \"mardy.brown@asciidocsmith.com\"\n  }\n}\n----\n// TESTRESPONSE[s/\"_seq_no\": \\d+/\"_seq_no\" : $body._seq_no/ s/\"_primary_term\":1/\"_primary_term\" : $body._primary_term/]\n\n////\n[source,console]\n--------------------------------------------------\nDELETE /_ingest/pipeline/user_lookup\nDELETE /_enrich/policy/users-policy\nDELETE /my-index-000001\nDELETE /users\n--------------------------------------------------\n// TEST[continued]\n////\n"
}