{
    "meta": {
        "timestamp": "2024-11-01T02:49:24.667066",
        "size": 7684,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/collecting-monitoring-data.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "collecting-monitoring-data",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[collecting-monitoring-data]]\n== Collecting monitoring data using legacy collectors\n++++\n<titleabbrev>Legacy collection methods</titleabbrev>\n++++\n\ninclude::{es-ref-dir}/settings/monitoring-settings.asciidoc[tag=monitoring-deprecation-notice]\n\nThis method for collecting metrics about {es} involves sending the metrics to\nthe monitoring cluster by using exporters.\n\nAdvanced monitoring settings enable you to control how frequently data is\ncollected, configure timeouts, and set the retention period for locally-stored\nmonitoring indices. You can also adjust how monitoring data is displayed.\n\nTo learn about monitoring in general, see <<monitor-elasticsearch-cluster>>.\n\n. Configure your cluster to collect monitoring data:\n\n.. Verify that the `xpack.monitoring.elasticsearch.collection.enabled` setting\nis `true`, which is its default value, on each node in the cluster.\n+\n--\nNOTE: You can specify this setting in either the `elasticsearch.yml` on each\nnode or across the cluster as a dynamic cluster setting. If {es}\n{security-features} are enabled, you must have `monitor` cluster privileges to\nview the cluster settings and `manage` cluster privileges to change them.\n\nFor more information, see <<monitoring-settings>> and <<cluster-update-settings>>.\n--\n\n.. Set the `xpack.monitoring.collection.enabled` setting to `true` on each\nnode in the cluster. By default, it is disabled (`false`).\n+\n--\nNOTE: You can specify this setting in either the `elasticsearch.yml` on each\nnode or across the cluster as a dynamic cluster setting. If {es}\n{security-features} are enabled, you must have `monitor` cluster privileges to\nview the cluster settings and `manage` cluster privileges to change them.\n\nFor example, use the following APIs to review and change this setting:\n\n[source,console]\n----------------------------------\nGET _cluster/settings\n----------------------------------\n\n[source,console]\n----------------------------------\nPUT _cluster/settings\n{\n  \"persistent\": {\n    \"xpack.monitoring.collection.enabled\": true\n  }\n}\n----------------------------------\n// TEST[warning:[xpack.monitoring.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release.]\n\nAlternatively, you can enable this setting in {kib}. In the side navigation,\nclick *Monitoring*. If data collection is disabled, you are prompted to turn it\non.\n\nFor more\ninformation, see <<monitoring-settings>> and <<cluster-update-settings>>.\n--\n\n.. Optional: Specify which indices you want to monitor.\n+\n--\nBy default, the monitoring agent collects data from all {es} indices.\nTo collect data from particular indices, configure the\n`xpack.monitoring.collection.indices` setting. You can specify multiple indices\nas a comma-separated list or use an index pattern to match multiple indices. For\nexample:\n\n[source,yaml]\n----------------------------------\nxpack.monitoring.collection.indices: logstash-*, index1, test2\n----------------------------------\n\nYou can prepend `-` to explicitly exclude index names or\npatterns. For example, to include all indices that start with `test` except\n`test3`, you could specify `test*,-test3`. To include system indices such as\n.security and .kibana, add `.*` to the list of included names.\nFor example `.*,test*,-test3`\n--\n\n.. Optional: Specify how often to collect monitoring data. The default value for\nthe `xpack.monitoring.collection.interval` setting 10 seconds. See\n<<monitoring-settings>>.\n\n. Identify where to store monitoring data.\n+\n--\nBy default, the data is stored on the same cluster by using a\n<<local-exporter,`local` exporter>>. Alternatively, you can use an <<http-exporter,`http` exporter>> to send data to\na separate _monitoring cluster_.\n\nIMPORTANT: The {es} {monitor-features} use ingest pipelines, therefore the\ncluster that stores the monitoring data must have at least one\n<<ingest,ingest node>>.\n\nFor more information about typical monitoring architectures,\nsee <<how-monitoring-works>>.\n--\n\n. If you choose to use an `http` exporter:\n\n.. On the cluster that you want to monitor (often called the _production cluster_),\nconfigure each node to send metrics to your monitoring cluster. Configure an\nHTTP exporter in the `xpack.monitoring.exporters` settings in the\n`elasticsearch.yml` file. For example:\n+\n--\n[source,yaml]\n--------------------------------------------------\nxpack.monitoring.exporters:\n  id1:\n    type: http\n    host: [\"http://es-mon-1:9200\", \"http://es-mon-2:9200\"]\n--------------------------------------------------\n--\n\n.. If the Elastic {security-features} are enabled on the monitoring cluster, you\nmust provide appropriate credentials when data is shipped to the monitoring cluster:\n\n... Create a user on the monitoring cluster that has the\n<<built-in-roles,`remote_monitoring_agent` built-in role>>.\nAlternatively, use the\n<<built-in-users,`remote_monitoring_user` built-in user>>.\n\n... Add the user ID and password settings to the HTTP exporter settings in the\n`elasticsearch.yml` file and keystore on each node. +\n+\n--\nFor example:\n\n[source,yaml]\n--------------------------------------------------\nxpack.monitoring.exporters:\n  id1:\n    type: http\n    host: [\"http://es-mon-1:9200\", \"http://es-mon-2:9200\"]\n    auth.username: remote_monitoring_user\n    # \"xpack.monitoring.exporters.id1.auth.secure_password\" must be set in the keystore\n--------------------------------------------------\n--\n\n.. If you configured the monitoring cluster to use\n<<encrypt-internode-communication,encrypted communications>>, you must use the HTTPS protocol in\nthe `host` setting. You must also specify the trusted CA certificates that will\nbe used to verify the identity of the nodes in the monitoring cluster.\n\n*** To add a CA certificate to an {es} node's trusted certificates, you can\nspecify the location of the PEM encoded certificate with the\n`certificate_authorities` setting. For example:\n+\n--\n[source,yaml]\n--------------------------------------------------\nxpack.monitoring.exporters:\n  id1:\n    type: http\n    host: [\"https://es-mon1:9200\", \"https://es-mon-2:9200\"]\n    auth:\n      username: remote_monitoring_user\n      # \"xpack.monitoring.exporters.id1.auth.secure_password\" must be set in the keystore\n    ssl:\n      certificate_authorities: [ \"/path/to/ca.crt\" ]\n--------------------------------------------------\n--\n\n*** Alternatively, you can configure trusted certificates using a truststore\n(a Java Keystore file that contains the certificates). For example:\n+\n--\n[source,yaml]\n--------------------------------------------------\nxpack.monitoring.exporters:\n  id1:\n    type: http\n    host: [\"https://es-mon1:9200\", \"https://es-mon-2:9200\"]\n    auth:\n      username: remote_monitoring_user\n      # \"xpack.monitoring.exporters.id1.auth.secure_password\" must be set in the keystore\n    ssl:\n      truststore.path: /path/to/file\n      truststore.password: password\n--------------------------------------------------\n--\n\n. Configure your cluster to route monitoring data from sources such as {kib},\nBeats, and {ls} to the monitoring cluster. For information about configuring\neach product to collect and send monitoring data, see <<monitor-elasticsearch-cluster>>.\n\n. If you updated settings in the `elasticsearch.yml` files on your production\ncluster, restart {es}. See <<stopping-elasticsearch>> and <<starting-elasticsearch>>.\n+\n--\nTIP: You may want to temporarily {ref}/modules-cluster.html[disable shard\nallocation] before you restart your nodes to avoid unnecessary shard\nreallocation during the install process.\n\n--\n\n. Optional:\n<<config-monitoring-indices,Configure the indices that store the monitoring data>>.\n\n. {kibana-ref}/monitoring-data.html[View the monitoring data in {kib}].\n"
}