{
    "meta": {
        "timestamp": "2024-11-01T02:49:25.730082",
        "size": 4378,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/multi-search-template.html",
        "type": "documentation",
        "role": [
            "child_attributes"
        ],
        "has_code": false,
        "title": "multi-search-template",
        "version": "8.15"
    },
    "doc": "[[multi-search-template]]\n=== Multi search template API\n++++\n<titleabbrev>Multi search template</titleabbrev>\n++++\n\nRuns multiple <<run-multiple-templated-searches,templated searches>> with a single\nrequest.\n\n////\n[source,console]\n----\nPUT _scripts/my-search-template\n{\n  \"script\": {\n    \"lang\": \"mustache\",\n    \"source\": {\n      \"query\": {\n        \"match\": {\n          \"message\": \"{{query_string}}\"\n        }\n      },\n      \"from\": \"{{from}}\",\n      \"size\": \"{{size}}\"\n    }\n  }\n}\n\nPUT my-index/_doc/1?refresh\n{\n  \"message\": \"hello world\"\n}\n----\n// TESTSETUP\n////\n\n[source,console]\n----\nGET my-index/_msearch/template\n{ }\n{ \"id\": \"my-search-template\", \"params\": { \"query_string\": \"hello world\", \"from\": 0, \"size\": 10 }}\n{ }\n{ \"id\": \"my-other-search-template\", \"params\": { \"query_type\": \"match_all\" }}\n----\n// TEST[s/my-other-search-template/my-search-template/]\n\n[[multi-search-template-api-request]]\n==== {api-request-title}\n\n`GET <target>/_msearch/template`\n\n`GET _msearch/template`\n\n`POST <target>/_msearch/template`\n\n`POST _msearch/template`\n\n[[multi-search-template-api-prereqs]]\n==== {api-prereq-title}\n\n* If the {es} {security-features} are enabled, you must have the `read`\n<<privileges-list-indices,index privilege>> for the target data stream, index,\nor alias. For cross-cluster search, see <<remote-clusters>>.\n\n[[multi-search-template-api-path-params]]\n==== {api-path-parms-title}\n\n`<target>`::\n(Optional, string) Comma-separated list of data streams, indices, and aliases to\nsearch. Supports wildcards (`*`). To search all data streams and indices, omit\nthis parameter or use `*`.\n\n[[multi-search-template-api-query-params]]\n==== {api-query-parms-title}\n\n`ccs_minimize_roundtrips`::\n(Optional, Boolean) If `true`, network round-trips are minimized for\ncross-cluster search requests. Defaults to `true`.\n\n`max_concurrent_searches`::\n(Optional, integer) Maximum number of concurrent searches the API can run.\nDefaults to +max(1, (# of <<data-node,data nodes>> *\nmin(<<search-threadpool,search thread pool size>>, 10)))+.\n\n`rest_total_hits_as_int`::\n(Optional, Boolean) If `true`, the response returns `hits.total` as an integer.\nIf false, it returns `hits.total` as an object. Defaults to `false`.\n\ninclude::{es-ref-dir}/rest-api/common-parms.asciidoc[tag=search_type]\n\n`typed_keys`::\n(Optional, Boolean) If `true`, the response prefixes aggregation and suggester\nnames with their respective types. Defaults to `false`.\n\n[role=\"child_attributes\"]\n[[multi-search-template-api-request-body]]\n==== {api-request-body-title}\n\nThe request body must be newline-delimited JSON (NDJSON) in the following\nformat:\n\n[source,js]\n----\n<header>\\n\n<body>\\n\n<header>\\n\n<body>\\n\n----\n// NOTCONSOLE\n\nEach `<header>` and `<body>` pair represents a search request.\n\nThe `<header>` supports the same parameters as the <<search-multi-search,multi\nsearch API>>'s `<header>`. The `<body>` supports the same parameters as the\n<<search-search-api-request-body,search template API>>'s request body.\n\ninclude::multi-search.asciidoc[tag=header-params]\n\n`<body>`::\n(Request, object) Parameters for the search.\n+\n=====\ninclude::search-template-api.asciidoc[tag=body-params]\n=====\n\n[[multi-search-template-api-response-codes]]\n==== {api-response-codes-title}\n\nThe API returns a `400` status code only if the request itself fails. If one or\nmore searches in the request fail, the API returns a `200` status code with an\n`error` object for each failed search in the response.\n\n[[multi-search-template-api-response-body]]\n==== {api-response-body-title}\n\n`responses`::\n(array of objects) Results for each search, returned in the order submitted.\nEach object uses the same properties as the <<search-search,search API>>'s\nresponse.\n+\nIf a search fails, the response includes an `error` object containing an error\nmessage.\n\n[[multi-search-template-api-curl-requests]]\n==== curl requests\n\nIf a providing text file or text input to `curl`, use the `--data-binary` flag\ninstead of `-d` to preserve newlines.\n\n[source,sh]\n----\n$ cat requests\n{ \"index\": \"my-index\" }\n{ \"id\": \"my-search-template\", \"params\": { \"query_string\": \"hello world\", \"from\": 0, \"size\": 10 }}\n{ \"index\": \"my-other-index\" }\n{ \"id\": \"my-other-search-template\", \"params\": { \"query_type\": \"match_all\" }}\n\n$ curl -H \"Content-Type: application/x-ndjson\" -XGET localhost:9200/_msearch/template --data-binary \"@requests\"; echo\n----\n// NOTCONSOLE\n"
}