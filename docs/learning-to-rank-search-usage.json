{
    "meta": {
        "size": 2369,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/learning-to-rank-search-usage.html",
        "type": "documentation",
        "role": [],
        "has_code": false,
        "title": "learning-to-rank-search-usage",
        "version": "8.15"
    },
    "doc": "[[learning-to-rank-search-usage]]\n=== Search using Learning To Rank\n++++\n<titleabbrev>Search using LTR</titleabbrev>\n++++\n\nNOTE: This feature was introduced in version 8.12.0 and is only available to certain subscription levels.\nFor more information, see {subscriptions}.\n\n[discrete]\n[[learning-to-rank-rescorer]]\n==== Learning To Rank as a rescorer\n\nOnce your LTR model is trained and deployed in {es}, it can be used as a <<rescore, rescorer>> in the <<search-your-data, search API>>:\n\n[source,console]\n----\nGET my-index/_search\n{\n  \"query\": { <1>\n    \"multi_match\": {\n      \"fields\": [\"title\", \"content\"],\n      \"query\": \"the quick brown fox\"\n    }\n  },\n  \"rescore\": {\n    \"learning_to_rank\": {\n      \"model_id\": \"ltr-model\", <2>\n      \"params\": { <3>\n        \"query_text\": \"the quick brown fox\"\n      }\n    },\n    \"window_size\": 100 <4>\n  }\n}\n----\n// TEST[skip:TBD]\n<1> First pass query providing documents to be rescored.\n<2> The unique identifier of the trained model uploaded to {es}.\n<3> Named parameters to be passed to the query templates used for feature.\n<4> The number of documents that should be examined by the rescorer on each shard.\n\n[discrete]\n[[learning-to-rank-rescorer-limitations]]\n===== Known limitations\n\n[discrete]\n[[learning-to-rank-rescorer-limitations-window-size]]\n====== Rescore window size\n\nScores returned by LTR models are usually not comparable with the scores issued by the first pass query and can be lower than the non-rescored score. This can cause the non-rescored result document to be ranked higher than the rescored document. To prevent this, the `window_size` parameter is mandatory for LTR rescorers and should be greater than or equal to `from + size`.\n\n[discrete]\n[[learning-to-rank-rescorer-limitations-pagination]]\n====== Pagination\n\nWhen exposing pagination to users, `window_size` should remain constant as each page is progressed by passing different `from` values. Changing the `window_size` can alter the top hits causing results to confusingly shift as the user steps through pages.\n\n[discrete]\n[[learning-to-rank-rescorer-limitations-negative-scores]]\n====== Negative scores\n\nDepending on how your model is trained, it\u2019s possible that the model will return negative scores for documents. While negative scores are not allowed from first-stage retrieval and ranking, it is possible to use them in the LTR rescorer.\n"
}