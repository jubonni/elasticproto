{
    "meta": {
        "timestamp": "2024-11-01T03:07:10.124271",
        "size": 3008,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-rule-query.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "query-dsl-rule-query",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[query-dsl-rule-query]]\n=== Rule query\n\n++++\n<titleabbrev>Rule</titleabbrev>\n++++\n\n[WARNING]\n====\n`rule_query` was renamed to `rule` in 8.15.0.\nThe old syntax using `rule_query` and `ruleset_id` is deprecated and will be removed in a future release, so it is strongly advised to migrate existing rule queries to the new API structure.\n====\n\nApplies <<query-rules-apis,query rules>> to the query before returning results.\nQuery rules can be used to promote documents in the manner of a <<query-dsl-pinned-query>> based on matching defined rules, or to identify specific documents to exclude from a contextual result set.\nIf no matching query rules are defined, the \"organic\" matches for the query are returned.\nAll matching rules are applied in the order in which they appear in the query ruleset.\nIf the same document matches both an `exclude` rule and a `pinned` rule, the document will be excluded.\n\n[NOTE]\n====\nTo use the rule query, you first need a defined set of query rules.\nUse the <<query-rules-apis, query rules management APIs>> to create and manage query rules.\nFor more information and examples see <<search-using-query-rules>>.\n====\n\n==== Example request\n\n////\n\n[source,console]\n--------------------------------------------------\nPUT _query_rules/my-ruleset\n{\n  \"rules\": [\n    {\n      \"rule_id\": \"my-rule1\",\n      \"type\": \"pinned\",\n      \"criteria\": [\n        {\n          \"type\": \"exact\",\n          \"metadata\": \"user_query\",\n          \"values\": [\"puggles\"]\n        }\n      ],\n      \"actions\": {\n        \"ids\": [ \"id1\" ]\n      }\n    }\n  ]\n}\n--------------------------------------------------\n// TESTSETUP\n\n[source,console]\n--------------------------------------------------\nDELETE _query_rules/my-ruleset\n--------------------------------------------------\n// TEARDOWN\n\n////\n\n[source,console]\n--------------------------------------------------\nGET /_search\n{\n  \"query\": {\n    \"rule\": {\n      \"match_criteria\": {\n        \"user_query\": \"pugs\"\n      },\n      \"ruleset_ids\": [\"my-ruleset\"],\n      \"organic\": {\n        \"match\": {\n          \"description\": \"puggles\"\n        }\n      }\n    }\n  }\n}\n--------------------------------------------------\n\n[[rule-query-top-level-parameters]]\n==== Top-level parameters for `rule_query`\n\n`ruleset_ids`::\n(Required, array) An array of one or more unique <<query-rules-apis, query ruleset>> ID with query-based rules to match and apply as applicable.\nRulesets and their associated rules are evaluated in the order in which they are specified in the query and ruleset.\nThe maximum number of rulesets to specify is 10.\n`match_criteria`::\n(Required, object) Defines the match criteria to apply to rules in the given query ruleset.\nMatch criteria should match the keys defined in the `criteria.metadata` field of the rule.\n`organic`::\n(Required, object) Any choice of <<query-dsl, query>> used to return results, that may be modified by matching query rules.\nIf no query rules are matched and applied, this query will be executed with no modification.\n"
}