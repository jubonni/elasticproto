{
    "meta": {
        "size": 4359,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-pipeline-extended-stats-bucket-aggregation.html",
        "type": "documentation",
        "role": [],
        "has_code": true,
        "title": "search-aggregations-pipeline-extended-stats-bucket-aggregation",
        "version": "8.15"
    },
    "doc": "[[search-aggregations-pipeline-extended-stats-bucket-aggregation]]\n=== Extended stats bucket aggregation\n++++\n<titleabbrev>Extended stats bucket</titleabbrev>\n++++\n\nA sibling pipeline aggregation which calculates a variety of stats across all bucket of a specified metric in a sibling aggregation.\nThe specified metric must be numeric and the sibling aggregation must be a multi-bucket aggregation.\n\nThis aggregation provides a few more statistics (sum of squares, standard deviation, etc) compared to the `stats_bucket` aggregation.\n\n==== Syntax\n\nA `extended_stats_bucket` aggregation looks like this in isolation:\n\n[source,js]\n--------------------------------------------------\n{\n  \"extended_stats_bucket\": {\n    \"buckets_path\": \"the_sum\"\n  }\n}\n--------------------------------------------------\n// NOTCONSOLE\n\n[[extended-stats-bucket-params]]\n.`extended_stats_bucket` Parameters\n[options=\"header\"]\n|===\n|Parameter Name |Description |Required |Default Value\n|`buckets_path` |The path to the buckets we wish to calculate stats for (see <<buckets-path-syntax>> for more\n details) |Required |\n|`gap_policy` |The policy to apply when gaps are found in the data (see <<gap-policy>> for more\n details)|Optional | `skip`\n|`format` |{javadoc}/java.base/java/text/DecimalFormat.html[DecimalFormat pattern] for the\noutput value. If specified, the formatted value is returned in the aggregation's\n`value_as_string` property |Optional | `null`\n|`sigma` |The number of standard deviations above/below the mean to display |Optional | 2\n|===\n\nThe following snippet calculates the extended stats for monthly `sales` bucket:\n\n[source,console]\n--------------------------------------------------\nPOST /sales/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"sales_per_month\": {\n      \"date_histogram\": {\n        \"field\": \"date\",\n        \"calendar_interval\": \"month\"\n      },\n      \"aggs\": {\n        \"sales\": {\n          \"sum\": {\n            \"field\": \"price\"\n          }\n        }\n      }\n    },\n    \"stats_monthly_sales\": {\n      \"extended_stats_bucket\": {\n        \"buckets_path\": \"sales_per_month>sales\" <1>\n      }\n    }\n  }\n}\n--------------------------------------------------\n// TEST[setup:sales]\n\n<1> `bucket_paths` instructs this `extended_stats_bucket` aggregation that we want the calculate stats for the `sales` aggregation in the\n`sales_per_month` date histogram.\n\nAnd the following may be the response:\n\n[source,console-result]\n--------------------------------------------------\n{\n   \"took\": 11,\n   \"timed_out\": false,\n   \"_shards\": ...,\n   \"hits\": ...,\n   \"aggregations\": {\n      \"sales_per_month\": {\n         \"buckets\": [\n            {\n               \"key_as_string\": \"2015/01/01 00:00:00\",\n               \"key\": 1420070400000,\n               \"doc_count\": 3,\n               \"sales\": {\n                  \"value\": 550.0\n               }\n            },\n            {\n               \"key_as_string\": \"2015/02/01 00:00:00\",\n               \"key\": 1422748800000,\n               \"doc_count\": 2,\n               \"sales\": {\n                  \"value\": 60.0\n               }\n            },\n            {\n               \"key_as_string\": \"2015/03/01 00:00:00\",\n               \"key\": 1425168000000,\n               \"doc_count\": 2,\n               \"sales\": {\n                  \"value\": 375.0\n               }\n            }\n         ]\n      },\n      \"stats_monthly_sales\": {\n         \"count\": 3,\n         \"min\": 60.0,\n         \"max\": 550.0,\n         \"avg\": 328.3333333333333,\n         \"sum\": 985.0,\n         \"sum_of_squares\": 446725.0,\n         \"variance\": 41105.55555555556,\n         \"variance_population\": 41105.55555555556,\n         \"variance_sampling\": 61658.33333333334,\n         \"std_deviation\": 202.74505063146563,\n         \"std_deviation_population\": 202.74505063146563,\n         \"std_deviation_sampling\": 248.3109609609156,\n         \"std_deviation_bounds\": {\n           \"upper\": 733.8234345962646,\n           \"lower\": -77.15676792959795,\n           \"upper_population\" : 733.8234345962646,\n           \"lower_population\" : -77.15676792959795,\n           \"upper_sampling\" : 824.9552552551645,\n           \"lower_sampling\" : -168.28858858849787\n         }\n      }\n   }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/\"took\": 11/\"took\": $body.took/]\n// TESTRESPONSE[s/\"_shards\": \\.\\.\\./\"_shards\": $body._shards/]\n// TESTRESPONSE[s/\"hits\": \\.\\.\\./\"hits\": $body.hits/]\n"
}