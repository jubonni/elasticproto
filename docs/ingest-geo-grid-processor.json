{
    "meta": {
        "size": 9403,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/ingest-geo-grid-processor.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "ingest-geo-grid-processor",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[ingest-geo-grid-processor]]\n=== Geo-grid processor\n++++\n<titleabbrev>Geo-grid</titleabbrev>\n++++\n\nConverts geo-grid definitions of grid tiles or cells to regular bounding boxes or polygons which describe their shape.\nThis is useful if there is a need to interact with the tile shapes as spatially indexable fields.\nFor example the `geotile` field value `\"4/8/3\"` could be indexed as a string field, but that would not enable\nany spatial operations on it.\nInstead, convert it to the value\n`\"POLYGON ((0.0 40.979898069620134, 22.5 40.979898069620134, 22.5 55.77657301866769, 0.0 55.77657301866769, 0.0 40.979898069620134))\"`,\nwhich can be indexed as a <<geo-shape,`geo_shape`>> field.\n\n[[geo-grid-processor-options]]\n.geo_grid processor options\n[options=\"header\"]\n|======\n| Name                        | Required  | Default   | Description\n| `field`                     | yes       | -         | The field to interpret as a geo-tile. The field format is determined by the `tile_type`.\n| `tile_type`                 | yes       | -         | Three tile formats are understood: `geohash`, `geotile` and `geohex`.\n| `target_field`              | no        | `field`   | The field to assign the polygon shape to, by default `field` is updated in-place.\n| `parent_field`              | no        | -         | If specified and a parent tile exists, save that tile address to this field.\n| `children_field`            | no        | -         | If specified and children tiles exist, save those tile addresses to this field as an array of strings.\n| `non_children_field`        | no        | -         | If specified and intersecting non-child tiles exist, save their addresses to this field as an array of strings.\n| `precision_field`           | no        | -         | If specified, save the tile precision (zoom) as an integer to this field.\n| `ignore_missing`            | no        | -         | If `true` and `field` does not exist, the processor quietly exits without modifying the document.\n| `target_format`             | no        | \"GeoJSON\" | Which format to save the generated polygon in. Either `WKT` or `GeoJSON`.\ninclude::common-options.asciidoc[]\n|======\n\nTo demonstrate the usage of this ingest processor, consider an index called `geocells`\nwith a mapping for a field `geocell` of type `geo_shape`.\nIn order to populate that index using `geotile` and `geohex` fields, define\ntwo ingest processors:\n\n[source,console]\n--------------------------------------------------\nPUT geocells\n{\n  \"mappings\": {\n    \"properties\": {\n      \"geocell\": {\n        \"type\": \"geo_shape\"\n      }\n    }\n  }\n}\n\nPUT _ingest/pipeline/geotile2shape\n{\n  \"description\": \"translate rectangular z/x/y geotile to bounding box\",\n  \"processors\": [\n    {\n      \"geo_grid\": {\n        \"field\": \"geocell\",\n        \"tile_type\": \"geotile\"\n      }\n    }\n  ]\n}\n\nPUT _ingest/pipeline/geohex2shape\n{\n  \"description\": \"translate H3 cell to polygon\",\n  \"processors\": [\n    {\n      \"geo_grid\": {\n        \"field\": \"geocell\",\n        \"tile_type\": \"geohex\",\n        \"target_format\": \"wkt\"\n      }\n    }\n  ]\n}\n--------------------------------------------------\n\nThese two pipelines can be used to index documents into the `geocells` index.\nThe `geocell` field will be the string version of either a rectangular tile with format `z/x/y` or an H3 cell address,\ndepending on which ingest processor we use when indexing the document.\nThe resulting geometry will be represented and indexed as a <<geo-shape,`geo_shape`>> field in either\nhttp://geojson.org[GeoJSON] or the https://docs.opengeospatial.org/is/12-063r5/12-063r5.html[Well-Known Text] format.\n\n==== Example: Rectangular geotile with envelope in GeoJSON\n\nIn this example a `geocell` field with a value defined in `z/x/y` format is indexed as a\nhttp://geojson.org[GeoJSON Envelope] since the ingest-processor above was defined with default `target_format`.\n\n[source,console]\n--------------------------------------------------\nPUT geocells/_doc/1?pipeline=geotile2shape\n{\n  \"geocell\": \"4/8/5\"\n}\n\nGET geocells/_doc/1\n--------------------------------------------------\n// TEST[continued]\n\nThe response shows how the ingest-processor has replaced the `geocell` field with an indexable `geo_shape`:\n\n[source,console-result]\n--------------------------------------------------\n{\n \"_index\": \"geocells\",\n  \"_id\": \"1\",\n  \"_version\": 1,\n  \"_seq_no\": 0,\n  \"_primary_term\": 1,\n  \"found\": true,\n  \"_source\": {\n    \"geocell\": {\n      \"type\": \"Envelope\",\n      \"coordinates\": [\n        [ 0.0, 55.77657301866769 ],\n        [ 22.5, 40.979898069620134 ]\n      ]\n    }\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/\"_version\": \\d+/\"_version\": $body._version/ s/\"_seq_no\": \\d+/\"_seq_no\": $body._seq_no/ s/\"_primary_term\": 1/\"_primary_term\": $body._primary_term/]\n\nimage:images/spatial/geogrid_tile.png[Kibana map with showing the geotile at 4/8/5 and its four child cells]\n\n==== Example: Hexagonal geohex with polygon in WKT format\n\nIn this example a `geocell` field with an H3 string address is indexed as a\nhttps://docs.opengeospatial.org/is/12-063r5/12-063r5.html[WKT Polygon], since this ingest processor explicitly\ndefined the `target_format`.\n\n[source,console]\n--------------------------------------------------\nPUT geocells/_doc/1?pipeline=geohex2shape\n{\n  \"geocell\": \"811fbffffffffff\"\n}\n\nGET geocells/_doc/1\n--------------------------------------------------\n// TEST[continued]\n\nThe response shows how the ingest-processor has replaced the `geocell` field with an indexable `geo_shape`:\n\n[source,console-result]\n--------------------------------------------------\n{\n \"_index\": \"geocells\",\n  \"_id\": \"1\",\n  \"_version\": 1,\n  \"_seq_no\": 0,\n  \"_primary_term\": 1,\n  \"found\": true,\n  \"_source\": {\n    \"geocell\": \"POLYGON ((1.1885095294564962 49.470279179513454, 2.0265689212828875 45.18424864858389, 7.509948452934623 43.786609335802495, 12.6773177459836 46.40695743262768, 12.345747342333198 50.55427505169064, 6.259687012061477 51.964770150370896, 3.6300085578113794 50.610463307239115, 1.1885095294564962 49.470279179513454))\"\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/\"_version\": \\d+/\"_version\": $body._version/ s/\"_seq_no\": \\d+/\"_seq_no\": $body._seq_no/ s/\"_primary_term\": 1/\"_primary_term\": $body._primary_term/]\n\nimage:images/spatial/geogrid_h3.png[Kibana map with showing an H3 cell, and its seven child cells]\n\n==== Example: Enriched tile details\n\nAs described in <<geo-grid-processor-options,geo_grid processor options>>,\nthere are many other fields that can be set, which will enrich the information available.\nFor example, with H3 tiles there are 7 child tiles, but only the first is fully contained by the parent.\nThe remaining six are only partially overlapping the parent, and there exist a further six non-child tiles\nthat overlap the parent.\nThis can be investigated by adding parent and child additional fields to the ingest-processor:\n\n[source,console]\n--------------------------------------------------\nPUT _ingest/pipeline/geohex2shape\n{\n  \"description\": \"translate H3 cell to polygon with enriched fields\",\n  \"processors\": [\n    {\n      \"geo_grid\": {\n        \"description\": \"Ingest H3 cells like '811fbffffffffff' and create polygons\",\n        \"field\": \"geocell\",\n        \"tile_type\": \"geohex\",\n        \"target_format\": \"wkt\",\n        \"target_field\": \"shape\",\n        \"parent_field\": \"parent\",\n        \"children_field\": \"children\",\n        \"non_children_field\": \"nonChildren\",\n        \"precision_field\": \"precision\"\n      }\n    }\n  ]\n}\n--------------------------------------------------\n\nIndex the document to see a different result:\n\n[source,console]\n--------------------------------------------------\nPUT geocells/_doc/1?pipeline=geohex2shape\n{\n  \"geocell\": \"811fbffffffffff\"\n}\n\nGET geocells/_doc/1\n--------------------------------------------------\n// TEST[continued]\n\nThe response from this index request:\n\n[source,console-result]\n--------------------------------------------------\n{\n  \"_index\": \"geocells\",\n  \"_id\": \"1\",\n  \"_version\": 1,\n  \"_seq_no\": 0,\n  \"_primary_term\": 1,\n  \"found\": true,\n  \"_source\": {\n    \"parent\": \"801ffffffffffff\",\n    \"geocell\": \"811fbffffffffff\",\n    \"precision\": 1,\n    \"shape\": \"POLYGON ((1.1885095294564962 49.470279179513454, 2.0265689212828875 45.18424864858389, 7.509948452934623 43.786609335802495, 12.6773177459836 46.40695743262768, 12.345747342333198 50.55427505169064, 6.259687012061477 51.964770150370896, 3.6300085578113794 50.610463307239115, 1.1885095294564962 49.470279179513454))\",\n    \"children\": [\n      \"821f87fffffffff\",\n      \"821f8ffffffffff\",\n      \"821f97fffffffff\",\n      \"821f9ffffffffff\",\n      \"821fa7fffffffff\",\n      \"821faffffffffff\",\n      \"821fb7fffffffff\"\n    ],\n    \"nonChildren\": [\n      \"821ea7fffffffff\",\n      \"82186ffffffffff\",\n      \"82396ffffffffff\",\n      \"821f17fffffffff\",\n      \"821e37fffffffff\",\n      \"82194ffffffffff\"\n    ]\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/\"_version\": \\d+/\"_version\": $body._version/ s/\"_seq_no\": \\d+/\"_seq_no\": $body._seq_no/ s/\"_primary_term\": 1/\"_primary_term\": $body._primary_term/]\n\nThis additional information will then enable, for example, creating a visualization of the H3 cell,\nits children and its intersecting non-children cells.\n\nimage:images/spatial/geogrid_h3_children.png[Kibana map with three H3 layers: cell, children and intersecting non-children]\n"
}