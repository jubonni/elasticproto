{
    "meta": {
        "timestamp": "2024-11-01T03:02:52.682579",
        "size": 2077,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-global-aggregation.html",
        "type": "documentation",
        "role": [],
        "has_code": true,
        "title": "search-aggregations-bucket-global-aggregation",
        "version": "8.15"
    },
    "doc": "[[search-aggregations-bucket-global-aggregation]]\n=== Global aggregation\n++++\n<titleabbrev>Global</titleabbrev>\n++++\n\nDefines a single bucket of all the documents within the search execution\ncontext. This context is defined by the indices and the document types you're\nsearching on, but is *not* influenced by the search query itself.\n\nNOTE:   Global aggregators can only be placed as top level aggregators because\n        it doesn't make sense to embed a global aggregator within another\n        bucket aggregator.\n\nExample:\n\n[source,console,id=global-aggregation-example]\n--------------------------------------------------\nPOST /sales/_search?size=0\n{\n  \"query\": {\n    \"match\": { \"type\": \"t-shirt\" }\n  },\n  \"aggs\": {\n    \"all_products\": {\n      \"global\": {}, <1>\n      \"aggs\": {     <2>\n      \"avg_price\": { \"avg\": { \"field\": \"price\" } }\n      }\n    },\n    \"t_shirts\": { \"avg\": { \"field\": \"price\" } }\n  }\n}\n--------------------------------------------------\n// TEST[setup:sales]\n\n<1> The `global` aggregation has an empty body\n<2> The sub-aggregations that are registered for this `global` aggregation\n\nThe above aggregation demonstrates how one would compute aggregations\n(`avg_price` in this example) on all the documents in the search context,\nregardless of the query (in our example, it will compute the average price over\nall products in our catalog, not just on the \"shirts\").\n\nThe response for the above aggregation:\n\n[source,console-result]\n--------------------------------------------------\n{\n  ...\n  \"aggregations\": {\n    \"all_products\": {\n      \"doc_count\": 7, <1>\n      \"avg_price\": {\n        \"value\": 140.71428571428572 <2>\n      }\n    },\n    \"t_shirts\": {\n      \"value\": 128.33333333333334 <3>\n    }\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[s/\\.\\.\\./\"took\": $body.took,\"timed_out\": false,\"_shards\": $body._shards,\"hits\": $body.hits,/]\n\n<1> The number of documents that were aggregated (in our case, all documents\nwithin the search context)\n<2> The average price of all products in the index\n<3> The average price of all t-shirts\n"
}