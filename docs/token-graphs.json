{
    "meta": {
        "timestamp": "2024-11-01T02:49:26.678068",
        "size": 3820,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/token-graphs.html",
        "type": "documentation",
        "role": [],
        "has_code": false,
        "title": "token-graphs",
        "version": "8.15"
    },
    "doc": "[[token-graphs]]\n=== Token graphs\n\nWhen a <<analyzer-anatomy-tokenizer,tokenizer>> converts a text into a stream of\ntokens, it also records the following:\n\n* The `position` of each token in the stream\n* The `positionLength`, the number of positions that a token spans\n\nUsing these, you can create a\n{wikipedia}/Directed_acyclic_graph[directed acyclic graph],\ncalled a _token graph_, for a stream. In a token graph, each position represents\na node. Each token represents an edge or arc, pointing to the next position.\n\nimage::images/analysis/token-graph-qbf-ex.svg[align=\"center\"]\n\n[[token-graphs-synonyms]]\n==== Synonyms\n\nSome <<analyzer-anatomy-token-filters,token filters>> can add new tokens, like\nsynonyms, to an existing token stream. These synonyms often span the same\npositions as existing tokens.\n\nIn the following graph, `quick` and its synonym `fast` both have a position of\n`0`. They span the same positions.\n\nimage::images/analysis/token-graph-qbf-synonym-ex.svg[align=\"center\"]\n\n[[token-graphs-multi-position-tokens]]\n==== Multi-position tokens\n\nSome token filters can add tokens that span multiple positions. These can\ninclude tokens for multi-word synonyms, such as using \"atm\" as a synonym for\n\"automatic teller machine.\"\n\nHowever, only some token filters, known as _graph token filters_, accurately\nrecord the `positionLength` for multi-position tokens. These filters include:\n\n* <<analysis-synonym-graph-tokenfilter,`synonym_graph`>>\n* <<analysis-word-delimiter-graph-tokenfilter,`word_delimiter_graph`>>\n\nSome tokenizers, such as the\n{plugins}/analysis-nori-tokenizer.html[`nori_tokenizer`], also accurately\ndecompose compound tokens into multi-position tokens.\n\nIn the following graph, `domain name system` and its synonym, `dns`, both have a\nposition of `0`. However, `dns` has a `positionLength` of `3`. Other tokens in\nthe graph have a default `positionLength` of `1`.\n\nimage::images/analysis/token-graph-dns-synonym-ex.svg[align=\"center\"]\n\n[[token-graphs-token-graphs-search]]\n===== Using token graphs for search \n\n<<analysis-index-search-time,Indexing>> ignores the `positionLength` attribute\nand does not support token graphs containing multi-position tokens.\n\nHowever, queries, such as the <<query-dsl-match-query,`match`>> or\n<<query-dsl-match-query-phrase,`match_phrase`>> query, can use these graphs to\ngenerate multiple sub-queries from a single query string.\n\n.*Example*\n[%collapsible]\n====\n\nA user runs a search for the following phrase using the `match_phrase` query:\n\n`domain name system is fragile`\n\nDuring <<analysis-index-search-time,search analysis>>, `dns`, a synonym for\n`domain name system`, is added to the query string's token stream. The `dns`\ntoken has a `positionLength` of `3`.\n\nimage::images/analysis/token-graph-dns-synonym-ex.svg[align=\"center\"]\n\nThe `match_phrase` query uses this graph to generate sub-queries for the\nfollowing phrases:\n\n[source,text]\n------\ndns is fragile\ndomain name system is fragile\n------\n\nThis means the query matches documents containing either `dns is fragile` _or_\n`domain name system is fragile`.\n====\n\n[[token-graphs-invalid-token-graphs]]\n===== Invalid token graphs\n\nThe following token filters can add tokens that span multiple positions but\nonly record a default `positionLength` of `1`:\n\n* <<analysis-synonym-tokenfilter,`synonym`>>\n* <<analysis-word-delimiter-tokenfilter,`word_delimiter`>>\n\nThis means these filters will produce invalid token graphs for streams\ncontaining such tokens.\n\nIn the following graph, `dns` is a multi-position synonym for `domain name\nsystem`. However, `dns` has the default `positionLength` value of `1`, resulting\nin an invalid graph.\n\nimage::images/analysis/token-graph-dns-invalid-ex.svg[align=\"center\"]\n\nAvoid using invalid token graphs for search. Invalid graphs can cause unexpected\nsearch results.\n"
}