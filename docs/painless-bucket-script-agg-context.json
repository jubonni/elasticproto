{
    "meta": {
        "timestamp": "2024-11-01T02:49:25.822067",
        "size": 2427,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/painless-bucket-script-agg-context.html",
        "type": "documentation",
        "role": [],
        "has_code": true,
        "title": "painless-bucket-script-agg-context",
        "version": "8.15"
    },
    "doc": "[[painless-bucket-script-agg-context]]\n=== Bucket script aggregation context\n\nUse a Painless script in an\n{ref}/search-aggregations-pipeline-bucket-script-aggregation.html[`bucket_script` pipeline aggregation]\nto calculate a value as a result in a bucket.\n\n==== Variables\n\n`params` (`Map`, read-only)::\n        User-defined parameters passed in as part of the query. The parameters\n        include values defined as part of the `buckets_path`.\n\n==== Return\n\nnumeric::\n        The calculated value as the result.\n\n==== API\n\nThe standard <<painless-api-reference-shared, Painless API>> is available.\n\n==== Example\n\nTo run this example, first follow the steps in <<painless-context-examples, context examples>>.\n\nThe painless context in a `bucket_script` aggregation provides a `params` map. This map contains both\nuser-specified custom values, as well as the values from other aggregations specified in the `buckets_path`\nproperty.\n\nThis example takes the values from a min and max aggregation, calculates the difference,\nand adds the user-specified base_cost to the result:\n\n[source,Painless]\n--------------------------------------------------\n(params.max - params.min) + params.base_cost\n--------------------------------------------------\n\nNote that the values are extracted from the `params` map. In context, the aggregation looks like this:\n\n[source,console]\n--------------------------------------------------\nGET /seats/_search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"theatres\": {\n      \"terms\": {\n        \"field\": \"theatre\",\n        \"size\": 10\n      },\n      \"aggs\": {\n        \"min_cost\": {\n          \"min\": {\n            \"field\": \"cost\"\n          }\n        },\n        \"max_cost\": {\n          \"max\": {\n            \"field\": \"cost\"\n          }\n        },\n        \"spread_plus_base\": {\n          \"bucket_script\": {\n            \"buckets_path\": { <1>\n              \"min\": \"min_cost\",\n              \"max\": \"max_cost\"\n            },\n            \"script\": {\n              \"params\": {\n                \"base_cost\": 5 <2>\n              },\n              \"source\": \"(params.max - params.min) + params.base_cost\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n--------------------------------------------------\n// TEST[setup:seats]\n\n<1> The `buckets_path` points to two aggregations (`min_cost`, `max_cost`) and adds `min`/`max` variables\nto the `params` map\n<2> The user-specified `base_cost` is also added to the script's `params` map"
}