{
    "meta": {
        "timestamp": "2024-11-01T03:02:53.796583",
        "size": 5196,
        "url": "https://www.elastic.co/guide/en/elasticsearch/reference/current/tutorial-manage-existing-data-stream.html",
        "type": "documentation",
        "role": [
            "xpack"
        ],
        "has_code": true,
        "title": "tutorial-manage-existing-data-stream",
        "version": "8.15"
    },
    "doc": "[role=\"xpack\"]\n[[tutorial-manage-existing-data-stream]]\n=== Tutorial: Update existing data stream\n\nTo update the lifecycle of an existing data stream you do the following actions:\n\n. <<set-lifecycle>>\n. <<delete-lifecycle>>\n\n[discrete]\n[[set-lifecycle]]\n==== Set a data stream's lifecycle\n\nTo add or to change the retention period of your data stream you can use the <<data-streams-put-lifecycle, PUT lifecycle API>>.\n\n* You can set infinite retention period, meaning that your data should never be deleted. For example:\n+\n[source,console]\n----\nPUT _data_stream/my-data-stream/_lifecycle\n{ } <1>\n----\n// TEST[setup:my_data_stream]\n<1> An empty payload means that your data stream is still managed but the data will never be deleted. Managing a time\nseries data stream such as logs or metrics enables {es} to better store your data even if you do not use a retention period.\n\n* Or you can set the retention period of your choice. For example:\n+\n[source,console]\n----\nPUT _data_stream/my-data-stream/_lifecycle\n{\n  \"data_retention\": \"30d\" <1>\n}\n----\n// TEST[continued]\n<1> The retention period of this data stream is set to 30 days. This means that {es} is allowed to delete data that is\nolder than 30 days at its own discretion.\n\nThe changes in the lifecycle are applied on all backing indices of the data stream. You can see the effect of the change\nvia the <<data-streams-explain-lifecycle, explain API>>:\n\n[source,console]\n--------------------------------------------------\nGET .ds-my-data-stream-*/_lifecycle/explain\n--------------------------------------------------\n// TEST[continued]\n\nThe response will look like:\n\n[source,console-result]\n--------------------------------------------------\n{\n  \"indices\": {\n    \".ds-my-data-stream-2023.04.19-000002\": {\n      \"index\": \".ds-my-data-stream-2023.04.19-000002\",  <1>\n      \"managed_by_lifecycle\": true,                           <2>\n      \"index_creation_date_millis\": 1681919221417,\n      \"time_since_index_creation\": \"6.85s\",             <3>\n      \"lifecycle\": {\n        \"enabled\": true,\n        \"data_retention\": \"30d\"                         <4>\n      }\n    },\n    \".ds-my-data-stream-2023.04.17-000001\": {\n      \"index\": \".ds-my-data-stream-2023.04.17-000001\",  <5>\n      \"managed_by_lifecycle\": true,                           <6>\n      \"index_creation_date_millis\": 1681745209501,\n      \"time_since_index_creation\": \"48d\",               <7>\n      \"rollover_date_millis\": 1681919221419,\n      \"time_since_rollover\": \"6.84s\",                   <8>\n      \"generation_time\": \"6.84s\",                       <9>\n      \"lifecycle\": {\n        \"enabled\": true,\n        \"data_retention\": \"30d\"                         <10>\n      }\n    }\n  }\n}\n--------------------------------------------------\n// TEST[continued]\n// TESTRESPONSE[skip:the result is for illustrating purposes only]\n<1> The name of the backing index.\n<2> This index is managed by a data stream lifecycle.\n<3> The time that has passed since this index has been created.\n<4> The data retention for this index is at least 30 days, as it was recently updated.\n<5> The name of the backing index.\n<6> This index is managed by the built-in data stream lifecycle.\n<7> The time that has passed since this index has been created.\n<8> The time that has passed since this index was <<index-rollover,rolled over>>.\n<9> The time that will be used to determine when it's safe to delete this index and all its data.\n<10> The data retention for this index as well is at least 30 days, as it was recently updated.\n\n[discrete]\n[[delete-lifecycle]]\n==== Remove lifecycle for a data stream\n\nTo remove the lifecycle of a data stream you can use the <<data-streams-delete-lifecycle-request,delete lifecycle API>>. As consequence,\nthe maintenance operations that were applied by the lifecycle will no longer be applied to the data stream and all its\nbacking indices. For example:\n\n[source,console]\n--------------------------------------------------\nDELETE _data_stream/my-data-stream/_lifecycle\n--------------------------------------------------\n// TEST[continued]\n\nYou can then use the <<data-streams-explain-lifecycle, explain API>> again to see that the indices are no longer managed.\n\n[source,console]\n--------------------------------------------------\nGET .ds-my-data-stream-*/_lifecycle/explain\n--------------------------------------------------\n// TEST[continued]\n// TEST[teardown:data_stream_cleanup]\n\n[source,console-result]\n--------------------------------------------------\n{\n  \"indices\": {\n    \".ds-my-data-stream-2023.04.19-000002\": {\n      \"index\": \".ds-my-data-stream-2023.04.19-000002\",  <1>\n      \"managed_by_lifecycle\": false                           <2>\n    },\n    \".ds-my-data-stream-2023.04.17-000001\": {\n      \"index\": \".ds-my-data-stream-2023.04.19-000001\",  <3>\n      \"managed_by_lifecycle\": false                           <4>\n    }\n  }\n}\n--------------------------------------------------\n// TESTRESPONSE[skip:the result is for illustrating purposes only]\n<1> The name of the backing index.\n<2> Indication that the index is not managed by the data stream lifecycle.\n<3> The name of another backing index.\n<4> Indication that the index is not managed by the data stream lifecycle.\n"
}